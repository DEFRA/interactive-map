export const __webpack_id__="im-datasets-plugin";export const __webpack_ids__=["im-datasets-plugin"];export const __webpack_modules__={"./plugins/datasets/src/manifest.js":(t,e,r)=>{function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function i(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return o(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function a(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function l(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?a(Object(r),!0).forEach(function(e){s(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function s(t,e,r){return(e=u(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function u(t){var e=function(t){if("object"!=n(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=n(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==n(e)?e:e+""}r.r(e),r.d(e,{manifest:()=>F});var c={SET_DATASETS:function(t,e){var r=e.datasets,n=e.datasetDefaults;return l(l({},t),{},{datasets:r.map(function(t){return l(l({},n),t)})})},ADD_DATASET:function(t,e){var r=e.dataset,n=e.datasetDefaults;return l(l({},t),{},{datasets:[].concat(i(t.datasets||[]),[l(l({},n),r)])})},REMOVE_DATASET:function(t,e){var r,n=e.id;return l(l({},t),{},{datasets:(null===(r=t.datasets)||void 0===r?void 0:r.filter(function(t){return t.id!==n}))||[]})},SET_DATASET_VISIBILITY:function(t,e){var r,n=e.id,i=e.visibility;return l(l({},t),{},{datasets:null===(r=t.datasets)||void 0===r?void 0:r.map(function(t){return t.id===n?l(l({},t),{},{visibility:i}):t})})},HIDE_FEATURES:function(t,e){var r=e.layerId,n=e.idProperty,o=e.featureIds,a=t.hiddenFeatures[r],u=(null==a?void 0:a.ids)||[],c=i(new Set([].concat(i(u),i(o))));return l(l({},t),{},{hiddenFeatures:l(l({},t.hiddenFeatures),{},s({},r,{idProperty:n,ids:c}))})},SHOW_FEATURES:function(t,e){var r=e.layerId,n=e.featureIds,i=t.hiddenFeatures[r];if(!i)return t;var o=i.ids.filter(function(t){return!n.includes(t)});if(0===o.length){var a=t.hiddenFeatures,c=(a[r],function(t,e){if(null==t)return{};var r,n,i=function(t,e){if(null==t)return{};var r={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(-1!==e.indexOf(n))continue;r[n]=t[n]}return r}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(n=0;n<o.length;n++)r=o[n],-1===e.indexOf(r)&&{}.propertyIsEnumerable.call(t,r)&&(i[r]=t[r])}return i}(a,[r].map(u)));return l(l({},t),{},{hiddenFeatures:c})}return l(l({},t),{},{hiddenFeatures:l(l({},t.hiddenFeatures),{},s({},r,l(l({},i),{},{ids:o})))})}},d=r("react"),f={stroke:"#d4351c",strokeWidth:2,fill:"transparent",symbolDescription:"red outline",minZoom:6,maxZoom:24,showInKey:!1,showInLayers:!1,visibility:"visible"};function y(t){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},y(t)}var p=function(t,e){if(!t)return null;if("string"==typeof t)return t.trim();if("object"===y(t)){if(e&&t[e])return t[e];var r=Object.values(t)[0];return null!=r?r:null}return null};function v(t){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},v(t)}function m(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function b(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?m(Object(r),!0).forEach(function(e){h(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function h(t,e,r){return(e=function(t){var e=function(t){if("object"!=v(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=v(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==v(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var g=function(t){for(var e=0,r=0;r<t.length;r++)e=(e<<5)-e+t.charCodeAt(r),e&=e;return Math.abs(e).toString(36)},S=function(t){if(t.tiles){var e=Array.isArray(t.tiles)?t.tiles.join(","):t.tiles;return"tiles-".concat(g(e))}return t.data?"string"==typeof t.data?"geojson-".concat(g(t.data)):"geojson-".concat(t.id):"source-".concat(t.id)},j=function(t,e,r){var n=S(r);t.getSource(n)||(r.tiles?t.addSource(n,{type:"vector",tiles:r.tiles,minzoom:r.minZoom||0,maxzoom:r.maxZoom||22}):r.data&&t.addSource(n,{type:"geojson",data:r.data}));var i=!!r.fill,o=!!r.stroke,a=i?r.id:null,l=o?i?"".concat(r.id,"-stroke"):r.id:null,s="hidden"===r.visibility?"none":"visible";if(i&&!t.getLayer(a)){var u=p(r.fill,e);t.addLayer(b({id:a,type:"fill",source:n,"source-layer":r.sourceLayer,layout:{visibility:s},paint:{"fill-color":u,"fill-opacity":r.opacity||1}},r.filter?{filter:r.filter}:{}))}if(o&&!t.getLayer(l)){var c=p(r.stroke,e);t.addLayer(b({id:l,type:"line",source:n,"source-layer":r.sourceLayer,layout:{visibility:s},paint:b({"line-color":c,"line-width":r.strokeWidth||1,"line-opacity":r.opacity||1},r.strokeDashArray?{"line-dasharray":r.strokeDashArray}:{})},r.filter?{filter:r.filter}:{}))}},k=function(t,e,r,n,i){if(t.getLayer(e)){var o=function(t,e,r){if(!r||0===r.length)return t;var n=["!",["in",["to-string",["get",e]],["literal",r.map(function(t){return String(t)})]]];return t?["all",t,n]:n}(r,n,i);t.setFilter(e,o)}};function O(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}var w=function(t){var e=t.pluginConfig,r=t.pluginStateRef,n=t.mapStyleId,i=t.mapProvider,o=t.events,a=t.eventBus,l=i.map,s=e.datasets,u=function(){return r.current.datasets||s};s.forEach(function(t){j(l,n,t)}),l.once("idle",function(){a.emit("datasets:ready")});var c=function(t){var e=t.map,r=t.events,n=t.getDatasets,i=t.getHiddenFeatures,o=function(t){e.once("idle",function(){var r=t.id,o=n(),a=i();o.forEach(function(t){j(e,r,t)}),Object.entries(a).forEach(function(t){var r=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,o,a,l=[],s=!0,u=!1;try{if(o=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=o.call(r)).done)&&(l.push(n.value),l.length!==e);s=!0);}catch(t){u=!0,i=t}finally{try{if(!s&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw i}}return l}}(t,e)||function(t,e){if(t){if("string"==typeof t)return O(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?O(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t,2),n=r[0],i=r[1],a=i.idProperty,l=i.ids,s=o.find(function(t){return t.id===n});if(s){var u=s.filter||null,c=!!s.fill,d=!!s.stroke,f=c?n:null,y=d?c?"".concat(n,"-stroke"):n:null;f&&k(e,f,u,a,l),y&&k(e,y,u,a,l)}})})};return t.eventBus.on(r.MAP_SET_STYLE,o),o}({map:l,events:o,eventBus:a,getDatasets:u,getHiddenFeatures:function(){return r.current.hiddenFeatures||{}}});return{remove:function(){a.off(o.MAP_SET_STYLE,c);var t=u(),e=new Set;t.forEach(function(t){var r=S(t),n=t.fill?t.id:null,i=t.stroke?t.fill?"".concat(t.id,"-stroke"):t.id:null;i&&l.getLayer(i)&&l.removeLayer(i),n&&l.getLayer(n)&&l.removeLayer(n),!e.has(r)&&l.getSource(r)&&(l.removeSource(r),e.add(r))})}}},P=function(t,e){var r=t.mapProvider,n=t.pluginState,i=r.map;i.getLayer(e)&&i.setLayoutProperty(e,"visibility","visible"),i.getLayer("".concat(e,"-stroke"))&&i.setLayoutProperty("".concat(e,"-stroke"),"visibility","visible"),n.dispatch({type:"SET_DATASET_VISIBILITY",payload:{id:e,visibility:"visible"}})},A=function(t,e){var r=t.mapProvider,n=t.pluginState,i=r.map;i.getLayer(e)&&i.setLayoutProperty(e,"visibility","none"),i.getLayer("".concat(e,"-stroke"))&&i.setLayoutProperty("".concat(e,"-stroke"),"visibility","none"),n.dispatch({type:"SET_DATASET_VISIBILITY",payload:{id:e,visibility:"hidden"}})},E=r("react/jsx-runtime");function I(t){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},I(t)}function _(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function x(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?_(Object(r),!0).forEach(function(e){L(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function L(t,e,r){return(e=function(t){var e=function(t){if("object"!=I(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=I(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==I(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function D(t){return function(t){if(Array.isArray(t))return T(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return T(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?T(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}var F={InitComponent:function(t){var e,r=t.pluginConfig,n=t.pluginState,i=t.appState,o=t.mapState,a=t.mapProvider,l=t.services,s=n.dispatch,u=l.events,c=l.eventBus,y=!(null===(e=a.map)||void 0===e||!e.getStyle()),p=(0,d.useRef)(n);p.current=n;var v=(0,d.useRef)(null);return(0,d.useEffect)(function(){var t,e,l,d,m=null===(t=null===(e=r.includeModes)||void 0===e?void 0:e.includes(i.mode))||void 0===t||t,b=null!==(l=null===(d=r.excludeModes)||void 0===d?void 0:d.includes(i.mode))&&void 0!==l&&l;y&&m&&!b&&(v.current||(n.datasets||s({type:"SET_DATASETS",payload:{datasets:r.datasets,datasetDefaults:f}}),v.current=w({mapStyleId:o.mapStyle.id,pluginConfig:r,pluginStateRef:p,mapProvider:a,events:u,eventBus:c})))},[y,i.mode]),(0,d.useEffect)(function(){return function(){v.current&&(v.current.remove(),v.current=null)}},[]),null},reducer:{initialState:{datasets:null,hiddenFeatures:{}},actions:c},panels:[{id:"datasetsLayers",label:"Layers",mobile:{slot:"bottom",modal:!0,dismissable:!0},tablet:{slot:"inset",dismissable:!0,exclusive:!0,width:"300px"},desktop:{slot:"inset",modal:!1,dismissable:!0,exclusive:!0,width:"320px"},render:function(t){var e=t.pluginState,r=t.mapProvider,n=function(t){var n=t.target,i=n.value;n.checked?P({mapProvider:r,pluginState:e},i):A({mapProvider:r,pluginState:e},i)};return(0,E.jsx)("div",{className:"im-c-datasets-layers",children:(0,E.jsx)("div",{className:"govuk-form-group",children:(0,E.jsxs)("fieldset",{className:"govuk-fieldset",children:[(0,E.jsx)("legend",{className:"govuk-visually-hidden",children:"Layers"}),(0,E.jsx)("div",{className:"govuk-checkboxes govuk-checkboxes--small","data-module":"govuk-checkboxes",children:(e.datasets||[]).filter(function(t){return t.showInLayers}).map(function(t){return(0,E.jsx)("div",{className:"im-c-datasets-layers__item",children:(0,E.jsxs)("div",{className:"govuk-checkboxes__item",children:[(0,E.jsx)("input",{className:"govuk-checkboxes__input",id:t.id,name:"layers",type:"checkbox",value:t.id,checked:"hidden"!==t.visibility,onChange:n}),(0,E.jsx)("label",{className:"im-c-datasets-layers__item-label govuk-label govuk-checkboxes__label",htmlFor:t.id,children:t.label})]})},t.id)})})]})})})}},{id:"datasetsKey",label:"Key",mobile:{slot:"bottom",modal:!0},tablet:{slot:"inset",width:"300px"},desktop:{slot:"inset",width:"320px"},render:function(t){var e=t.mapState,r=t.pluginState,n=e.mapStyle,i=function(t){return(0,E.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 20 20","aria-hidden":"true",focusable:"false",children:"line"===t.keySymbolShape?(0,E.jsx)("line",{x1:t.strokeWidth/2,y1:"10",x2:20-t.strokeWidth/2,y2:"10",stroke:p(t.stroke,n.id),strokeWidth:t.strokeWidth,strokeLinecap:"round"}):(0,E.jsx)("rect",{x:t.strokeWidth/2,y:t.strokeWidth/2,width:20-t.strokeWidth,height:20-t.strokeWidth,rx:t.strokeWidth,ry:t.strokeWidth,fill:p(t.fill,n.id),stroke:p(t.stroke,n.id),strokeWidth:t.strokeWidth,strokeLinejoin:"round"})})};return(0,E.jsx)("div",{className:"im-c-datasets-key",children:(r.datasets||[]).filter(function(t){return t.showInKey&&"hidden"!==t.visibility}).map(function(t){return(0,E.jsx)("div",{className:"im-c-datasets-key__item",children:(0,E.jsxs)("div",{className:"im-c-datasets-key__item-label",children:[i(t),t.label,t.symbolDescription&&(0,E.jsxs)("span",{className:"govuk-visually-hidden",children:["(",p(t.symbolDescription,n.id),")"]})]})},t.id)})})}}],buttons:[{id:"datasetsLayers",label:"Layers",panelId:"datasetsLayers",iconId:"layers",excludeWhen:function(t){return!t.pluginConfig.datasets.find(function(t){return t.showInLayers})},mobile:{slot:"top-left",showLabel:!0},tablet:{slot:"top-left",showLabel:!0},desktop:{slot:"top-left",showLabel:!0}},{id:"datasetsKey",label:"Key",panelId:"datasetsKey",iconId:"key",excludeWhen:function(t){return!t.pluginConfig.datasets.find(function(t){return t.showInKey})},mobile:{slot:"top-left",showLabel:!0},tablet:{slot:"top-left",showLabel:!0},desktop:{slot:"top-left",showLabel:!0}}],icons:[{id:"layers",svgContent:'<path d="M13 13.74a2 2 0 0 1-2 0L2.5 8.87a1 1 0 0 1 0-1.74L11 2.26a2 2 0 0 1 2 0l8.5 4.87a1 1 0 0 1 0 1.74z"></path><path d="m20 14.285 1.5.845a1 1 0 0 1 0 1.74L13 21.74a2 2 0 0 1-2 0l-8.5-4.87a1 1 0 0 1 0-1.74l1.5-.845"></path>'},{id:"key",svgContent:'<path d="M3 5h.01"/><path d="M3 12h.01"/><path d="M3 19h.01"/><path d="M8 5h13"/><path d="M8 12h13"/><path d="M8 19h13"/>'}],api:{showDataset:P,hideDataset:A,addDataset:function(t,e){var r=t.mapProvider,n=t.mapState,i=t.pluginState,o=r.map;j(o,n.mapStyle.id,x(x({},f),e)),i.dispatch({type:"ADD_DATASET",payload:{dataset:e,datasetDefaults:f}})},removeDataset:function(t,e){var r,n,i=t.mapProvider,o=t.pluginState,a=i.map,l=null===(r=o.datasets)||void 0===r?void 0:r.find(function(t){return t.id===e});if(l){var s=S(l),u=!!l.fill,c=!!l.stroke,d=u?e:null,f=null;c&&(f=u?"".concat(e,"-stroke"):e),f&&a.getLayer(f)&&a.removeLayer(f),d&&a.getLayer(d)&&a.removeLayer(d),!(null===(n=o.datasets)||void 0===n?void 0:n.some(function(t){return t.id!==e&&S(t)===s}))&&a.getSource(s)&&a.removeSource(s),o.dispatch({type:"REMOVE_DATASET",payload:{id:e}})}},showFeatures:function(t,e){var r,n=t.mapProvider,i=t.pluginState,o=e.featureIds,a=e.idProperty,l=e.datasetId,s=n.map,u=i.hiddenFeatures[l];if(u){var c=null===(r=i.datasets)||void 0===r?void 0:r.find(function(t){return t.id===l});if(c){var d=c.filter||null,f=!!c.fill,y=!!c.stroke,p=f?l:null,v=null;y&&(v=f?"".concat(l,"-stroke"):l);var m=u.ids.filter(function(t){return!o.includes(t)});i.dispatch({type:"SHOW_FEATURES",payload:{layerId:l,featureIds:o}}),p&&k(s,p,d,a,m),v&&k(s,v,d,a,m)}}},hideFeatures:function(t,e){var r,n=t.mapProvider,i=t.pluginState,o=e.featureIds,a=e.idProperty,l=e.datasetId,s=n.map,u=null===(r=i.datasets)||void 0===r?void 0:r.find(function(t){return t.id===l});if(u){var c=u.filter||null,d=!!u.fill,f=!!u.stroke,y=d?l:null,p=null;f&&(p=d?"".concat(l,"-stroke"):l);var v=i.hiddenFeatures[l],m=v?D(new Set([].concat(D(v.ids),D(o)))):o;i.dispatch({type:"HIDE_FEATURES",payload:{layerId:l,idProperty:a,featureIds:o}}),y&&k(s,y,c,a,m),p&&k(s,p,c,a,m)}}}}}};
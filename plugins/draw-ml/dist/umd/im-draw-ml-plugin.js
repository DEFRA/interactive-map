(this.webpackChunkdefra_DefraMap=this.webpackChunkdefra_DefraMap||[]).push([[966],{17:e=>{"use strict";e.exports=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){if(t.constructor!==r.constructor)return!1;var n,o,i;if(Array.isArray(t)){if((n=t.length)!=r.length)return!1;for(o=n;0!==o--;)if(!e(t[o],r[o]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if((n=(i=Object.keys(t)).length)!==Object.keys(r).length)return!1;for(o=n;0!==o--;)if(!Object.prototype.hasOwnProperty.call(r,i[o]))return!1;for(o=n;0!==o--;){var a=i[o];if(!e(t[a],r[a]))return!1}return!0}return t!=t&&r!=r}},30:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(846);function o(e,t,r){if(null!==e)for(var n,i,a,s,c,u,l,d,p=0,h=0,f=e.type,g="FeatureCollection"===f,y="Feature"===f,m=g?e.features.length:1,v=0;v<m;v++){c=(d=!!(l=g?e.features[v].geometry:y?e.geometry:e)&&"GeometryCollection"===l.type)?l.geometries.length:1;for(var b=0;b<c;b++){var E=0,w=0;if(null!==(s=d?l.geometries[b]:l)){u=s.coordinates;var S=s.type;switch(p=!r||"Polygon"!==S&&"MultiPolygon"!==S?0:1,S){case null:break;case"Point":if(!1===t(u,h,v,E,w))return!1;h++,E++;break;case"LineString":case"MultiPoint":for(n=0;n<u.length;n++){if(!1===t(u[n],h,v,E,w))return!1;h++,"MultiPoint"===S&&E++}"LineString"===S&&E++;break;case"Polygon":case"MultiLineString":for(n=0;n<u.length;n++){for(i=0;i<u[n].length-p;i++){if(!1===t(u[n][i],h,v,E,w))return!1;h++}"MultiLineString"===S&&E++,"Polygon"===S&&w++}"Polygon"===S&&E++;break;case"MultiPolygon":for(n=0;n<u.length;n++){for(w=0,i=0;i<u[n].length;i++){for(a=0;a<u[n][i].length-p;a++){if(!1===t(u[n][i][a],h,v,E,w))return!1;h++}w++}E++}break;case"GeometryCollection":for(n=0;n<s.geometries.length;n++)if(!1===o(s.geometries[n],t,r))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function i(e,t){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&!1!==t(e.features[r].properties,r);r++);break;case"Feature":t(e.properties,0)}}function a(e,t){if("Feature"===e.type)t(e,0);else if("FeatureCollection"===e.type)for(var r=0;r<e.features.length&&!1!==t(e.features[r],r);r++);}function s(e,t){var r,n,o,i,a,s,c,u,l,d,p=0,h="FeatureCollection"===e.type,f="Feature"===e.type,g=h?e.features.length:1;for(r=0;r<g;r++){for(s=h?e.features[r].geometry:f?e.geometry:e,u=h?e.features[r].properties:f?e.properties:{},l=h?e.features[r].bbox:f?e.bbox:void 0,d=h?e.features[r].id:f?e.id:void 0,a=(c=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,o=0;o<a;o++)if(null!==(i=c?s.geometries[o]:s))switch(i.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(i,p,u,l,d))return!1;break;case"GeometryCollection":for(n=0;n<i.geometries.length;n++)if(!1===t(i.geometries[n],p,u,l,d))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,p,u,l,d))return!1;p++}}function c(e,t){s(e,function(e,r,o,i,a){var s,c=null===e?null:e.type;switch(c){case null:case"Point":case"LineString":case"Polygon":return!1!==t(n.feature.call(void 0,e,o,{bbox:i,id:a}),r,0)&&void 0}switch(c){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var u=0;u<e.coordinates.length;u++){var l={type:s,coordinates:e.coordinates[u]};if(!1===t(n.feature.call(void 0,l,o),r,u))return!1}})}function u(e,t){c(e,function(e,r,i){var a=0;if(e.geometry){var s=e.geometry.type;if("Point"!==s&&"MultiPoint"!==s){var c,u=0,l=0,d=0;return!1!==o(e,function(o,s,p,h,f){if(void 0===c||r>u||h>l||f>d)return c=o,u=r,l=h,d=f,void(a=0);var g=n.lineString.call(void 0,[c,o],e.properties);if(!1===t(g,r,i,f,a))return!1;a++,c=o})&&void 0}}})}function l(e,t){if(!e)throw new Error("geojson is required");c(e,function(e,r,o){if(null!==e.geometry){var i=e.geometry.type,a=e.geometry.coordinates;switch(i){case"LineString":if(!1===t(e,r,o,0,0))return!1;break;case"Polygon":for(var s=0;s<a.length;s++)if(!1===t(n.lineString.call(void 0,a[s],e.properties),r,o,s))return!1}}})}t.coordAll=function(e){var t=[];return o(e,function(e){t.push(e)}),t},t.coordEach=o,t.coordReduce=function(e,t,r,n){var i=r;return o(e,function(e,n,o,a,s){i=0===n&&void 0===r?e:t(i,e,n,o,a,s)},n),i},t.featureEach=a,t.featureReduce=function(e,t,r){var n=r;return a(e,function(e,o){n=0===o&&void 0===r?e:t(n,e,o)}),n},t.findPoint=function(e,t){if(t=t||{},!n.isObject.call(void 0,t))throw new Error("options is invalid");var r,o=t.featureIndex||0,i=t.multiFeatureIndex||0,a=t.geometryIndex||0,s=t.coordIndex||0,c=t.properties;switch(e.type){case"FeatureCollection":o<0&&(o=e.features.length+o),c=c||e.features[o].properties,r=e.features[o].geometry;break;case"Feature":c=c||e.properties,r=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":r=e;break;default:throw new Error("geojson is invalid")}if(null===r)return null;var u=r.coordinates;switch(r.type){case"Point":return n.point.call(void 0,u,c,t);case"MultiPoint":return i<0&&(i=u.length+i),n.point.call(void 0,u[i],c,t);case"LineString":return s<0&&(s=u.length+s),n.point.call(void 0,u[s],c,t);case"Polygon":return a<0&&(a=u.length+a),s<0&&(s=u[a].length+s),n.point.call(void 0,u[a][s],c,t);case"MultiLineString":return i<0&&(i=u.length+i),s<0&&(s=u[i].length+s),n.point.call(void 0,u[i][s],c,t);case"MultiPolygon":return i<0&&(i=u.length+i),a<0&&(a=u[i].length+a),s<0&&(s=u[i][a].length-s),n.point.call(void 0,u[i][a][s],c,t)}throw new Error("geojson is invalid")},t.findSegment=function(e,t){if(t=t||{},!n.isObject.call(void 0,t))throw new Error("options is invalid");var r,o=t.featureIndex||0,i=t.multiFeatureIndex||0,a=t.geometryIndex||0,s=t.segmentIndex||0,c=t.properties;switch(e.type){case"FeatureCollection":o<0&&(o=e.features.length+o),c=c||e.features[o].properties,r=e.features[o].geometry;break;case"Feature":c=c||e.properties,r=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":r=e;break;default:throw new Error("geojson is invalid")}if(null===r)return null;var u=r.coordinates;switch(r.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=u.length+s-1),n.lineString.call(void 0,[u[s],u[s+1]],c,t);case"Polygon":return a<0&&(a=u.length+a),s<0&&(s=u[a].length+s-1),n.lineString.call(void 0,[u[a][s],u[a][s+1]],c,t);case"MultiLineString":return i<0&&(i=u.length+i),s<0&&(s=u[i].length+s-1),n.lineString.call(void 0,[u[i][s],u[i][s+1]],c,t);case"MultiPolygon":return i<0&&(i=u.length+i),a<0&&(a=u[i].length+a),s<0&&(s=u[i][a].length-s-1),n.lineString.call(void 0,[u[i][a][s],u[i][a][s+1]],c,t)}throw new Error("geojson is invalid")},t.flattenEach=c,t.flattenReduce=function(e,t,r){var n=r;return c(e,function(e,o,i){n=0===o&&0===i&&void 0===r?e:t(n,e,o,i)}),n},t.geomEach=s,t.geomReduce=function(e,t,r){var n=r;return s(e,function(e,o,i,a,s){n=0===o&&void 0===r?e:t(n,e,o,i,a,s)}),n},t.lineEach=l,t.lineReduce=function(e,t,r){var n=r;return l(e,function(e,o,i,a){n=0===o&&void 0===r?e:t(n,e,o,i,a)}),n},t.propEach=i,t.propReduce=function(e,t,r){var n=r;return i(e,function(e,o){n=0===o&&void 0===r?e:t(n,e,o)}),n},t.segmentEach=u,t.segmentReduce=function(e,t,r){var n=r,o=!1;return u(e,function(e,i,a,s,c){n=!1===o&&void 0===r?e:t(n,e,i,a,s,c),o=!0}),n}},186:e=>{e.exports=function(e){if(!e||!e.type)return null;var r=t[e.type];return r?"geometry"===r?{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:e}]}:"feature"===r?{type:"FeatureCollection",features:[e]}:"featurecollection"===r?e:void 0:null};var t={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"}},339:(e,t)=>{"use strict";function r(e,t,r){void 0===r&&(r={});var n={type:"Feature"};return(0===r.id||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=t||{},n.geometry=e,n}function n(e,t,n){if(void 0===n&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!h(e[0])||!h(e[1]))throw new Error("coordinates must contain numbers");return r({type:"Point",coordinates:e},t,n)}function o(e,t,n){void 0===n&&(n={});for(var o=0,i=e;o<i.length;o++){var a=i[o];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<a[a.length-1].length;s++)if(a[a.length-1][s]!==a[0][s])throw new Error("First and last Position are not equivalent.")}return r({type:"Polygon",coordinates:e},t,n)}function i(e,t,n){if(void 0===n&&(n={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");return r({type:"LineString",coordinates:e},t,n)}function a(e,t){void 0===t&&(t={});var r={type:"FeatureCollection"};return t.id&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.features=e,r}function s(e,t,n){return void 0===n&&(n={}),r({type:"MultiLineString",coordinates:e},t,n)}function c(e,t,n){return void 0===n&&(n={}),r({type:"MultiPoint",coordinates:e},t,n)}function u(e,t,n){return void 0===n&&(n={}),r({type:"MultiPolygon",coordinates:e},t,n)}function l(e,r){void 0===r&&(r="kilometers");var n=t.factors[r];if(!n)throw new Error(r+" units is invalid");return e*n}function d(e,r){void 0===r&&(r="kilometers");var n=t.factors[r];if(!n)throw new Error(r+" units is invalid");return e/n}function p(e){return e%(2*Math.PI)*180/Math.PI}function h(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.earthRadius=6371008.8,t.factors={centimeters:100*t.earthRadius,centimetres:100*t.earthRadius,degrees:t.earthRadius/111325,feet:3.28084*t.earthRadius,inches:39.37*t.earthRadius,kilometers:t.earthRadius/1e3,kilometres:t.earthRadius/1e3,meters:t.earthRadius,metres:t.earthRadius,miles:t.earthRadius/1609.344,millimeters:1e3*t.earthRadius,millimetres:1e3*t.earthRadius,nauticalmiles:t.earthRadius/1852,radians:1,yards:1.0936*t.earthRadius},t.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/t.earthRadius,yards:1.0936133},t.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},t.feature=r,t.geometry=function(e,t,r){switch(void 0===r&&(r={}),e){case"Point":return n(t).geometry;case"LineString":return i(t).geometry;case"Polygon":return o(t).geometry;case"MultiPoint":return c(t).geometry;case"MultiLineString":return s(t).geometry;case"MultiPolygon":return u(t).geometry;default:throw new Error(e+" is invalid")}},t.point=n,t.points=function(e,t,r){return void 0===r&&(r={}),a(e.map(function(e){return n(e,t)}),r)},t.polygon=o,t.polygons=function(e,t,r){return void 0===r&&(r={}),a(e.map(function(e){return o(e,t)}),r)},t.lineString=i,t.lineStrings=function(e,t,r){return void 0===r&&(r={}),a(e.map(function(e){return i(e,t)}),r)},t.featureCollection=a,t.multiLineString=s,t.multiPoint=c,t.multiPolygon=u,t.geometryCollection=function(e,t,n){return void 0===n&&(n={}),r({type:"GeometryCollection",geometries:e},t,n)},t.round=function(e,t){if(void 0===t&&(t=0),t&&!(t>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,t||0);return Math.round(e*r)/r},t.radiansToLength=l,t.lengthToRadians=d,t.lengthToDegrees=function(e,t){return p(d(e,t))},t.bearingToAzimuth=function(e){var t=e%360;return t<0&&(t+=360),t},t.radiansToDegrees=p,t.degreesToRadians=function(e){return e%360*Math.PI/180},t.convertLength=function(e,t,r){if(void 0===t&&(t="kilometers"),void 0===r&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return l(d(e,t),r)},t.convertArea=function(e,r,n){if(void 0===r&&(r="meters"),void 0===n&&(n="kilometers"),!(e>=0))throw new Error("area must be a positive number");var o=t.areaFactors[r];if(!o)throw new Error("invalid original units");var i=t.areaFactors[n];if(!i)throw new Error("invalid final units");return e/o*i},t.isNumber=h,t.isObject=function(e){return!!e&&e.constructor===Object},t.validateBBox=function(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(4!==e.length&&6!==e.length)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(e){if(!h(e))throw new Error("bbox must only contain numbers")})},t.validateId=function(e){if(!e)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof e))throw new Error("id must be a number or a string")}},341:function(e){e.exports=function(){"use strict";function e(e,n,o,i,a){!function e(r,n,o,i,a){for(;i>o;){if(i-o>600){var s=i-o+1,c=n-o+1,u=Math.log(s),l=.5*Math.exp(2*u/3),d=.5*Math.sqrt(u*l*(s-l)/s)*(c-s/2<0?-1:1);e(r,n,Math.max(o,Math.floor(n-c*l/s+d)),Math.min(i,Math.floor(n+(s-c)*l/s+d)),a)}var p=r[n],h=o,f=i;for(t(r,o,n),a(r[i],p)>0&&t(r,o,i);h<f;){for(t(r,h,f),h++,f--;a(r[h],p)<0;)h++;for(;a(r[f],p)>0;)f--}0===a(r[o],p)?t(r,o,f):t(r,++f,i),f<=n&&(o=f+1),n<=f&&(i=f-1)}}(e,n,o||0,i||e.length-1,a||r)}function t(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function r(e,t){return e<t?-1:e>t?1:0}var n=function(e){void 0===e&&(e=9),this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function o(e,t,r){if(!r)return t.indexOf(e);for(var n=0;n<t.length;n++)if(r(e,t[n]))return n;return-1}function i(e,t){a(e,0,e.children.length,t,e)}function a(e,t,r,n,o){o||(o=f(null)),o.minX=1/0,o.minY=1/0,o.maxX=-1/0,o.maxY=-1/0;for(var i=t;i<r;i++){var a=e.children[i];s(o,e.leaf?n(a):a)}return o}function s(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function c(e,t){return e.minX-t.minX}function u(e,t){return e.minY-t.minY}function l(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function d(e){return e.maxX-e.minX+(e.maxY-e.minY)}function p(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function h(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function f(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function g(t,r,n,o,i){for(var a=[r,n];a.length;)if(!((n=a.pop())-(r=a.pop())<=o)){var s=r+Math.ceil((n-r)/o/2)*o;e(t,s,r,n,i),a.push(r,s,s,n)}}return n.prototype.all=function(){return this._all(this.data,[])},n.prototype.search=function(e){var t=this.data,r=[];if(!h(e,t))return r;for(var n=this.toBBox,o=[];t;){for(var i=0;i<t.children.length;i++){var a=t.children[i],s=t.leaf?n(a):a;h(e,s)&&(t.leaf?r.push(a):p(e,s)?this._all(a,r):o.push(a))}t=o.pop()}return r},n.prototype.collides=function(e){var t=this.data;if(!h(e,t))return!1;for(var r=[];t;){for(var n=0;n<t.children.length;n++){var o=t.children[n],i=t.leaf?this.toBBox(o):o;if(h(e,i)){if(t.leaf||p(e,i))return!0;r.push(o)}}t=r.pop()}return!1},n.prototype.load=function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0;t<e.length;t++)this.insert(e[t]);return this}var r=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var n=this.data;this.data=r,r=n}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},n.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},n.prototype.clear=function(){return this.data=f([]),this},n.prototype.remove=function(e,t){if(!e)return this;for(var r,n,i,a=this.data,s=this.toBBox(e),c=[],u=[];a||c.length;){if(a||(a=c.pop(),n=c[c.length-1],r=u.pop(),i=!0),a.leaf){var l=o(e,a.children,t);if(-1!==l)return a.children.splice(l,1),c.push(a),this._condense(c),this}i||a.leaf||!p(a,s)?n?(r++,a=n.children[r],i=!1):a=null:(c.push(a),u.push(r),r=0,n=a,a=a.children[0])}return this},n.prototype.toBBox=function(e){return e},n.prototype.compareMinX=function(e,t){return e.minX-t.minX},n.prototype.compareMinY=function(e,t){return e.minY-t.minY},n.prototype.toJSON=function(){return this.data},n.prototype.fromJSON=function(e){return this.data=e,this},n.prototype._all=function(e,t){for(var r=[];e;)e.leaf?t.push.apply(t,e.children):r.push.apply(r,e.children),e=r.pop();return t},n.prototype._build=function(e,t,r,n){var o,a=r-t+1,s=this._maxEntries;if(a<=s)return i(o=f(e.slice(t,r+1)),this.toBBox),o;n||(n=Math.ceil(Math.log(a)/Math.log(s)),s=Math.ceil(a/Math.pow(s,n-1))),(o=f([])).leaf=!1,o.height=n;var c=Math.ceil(a/s),u=c*Math.ceil(Math.sqrt(s));g(e,t,r,u,this.compareMinX);for(var l=t;l<=r;l+=u){var d=Math.min(l+u-1,r);g(e,l,d,c,this.compareMinY);for(var p=l;p<=d;p+=c){var h=Math.min(p+c-1,d);o.children.push(this._build(e,p,h,n-1))}}return i(o,this.toBBox),o},n.prototype._chooseSubtree=function(e,t,r,n){for(;n.push(t),!t.leaf&&n.length-1!==r;){for(var o=1/0,i=1/0,a=void 0,s=0;s<t.children.length;s++){var c=t.children[s],u=l(c),d=(p=e,h=c,(Math.max(h.maxX,p.maxX)-Math.min(h.minX,p.minX))*(Math.max(h.maxY,p.maxY)-Math.min(h.minY,p.minY))-u);d<i?(i=d,o=u<o?u:o,a=c):d===i&&u<o&&(o=u,a=c)}t=a||t.children[0]}var p,h;return t},n.prototype._insert=function(e,t,r){var n=r?e:this.toBBox(e),o=[],i=this._chooseSubtree(n,this.data,t,o);for(i.children.push(e),s(i,n);t>=0&&o[t].children.length>this._maxEntries;)this._split(o,t),t--;this._adjustParentBBoxes(n,o,t)},n.prototype._split=function(e,t){var r=e[t],n=r.children.length,o=this._minEntries;this._chooseSplitAxis(r,o,n);var a=this._chooseSplitIndex(r,o,n),s=f(r.children.splice(a,r.children.length-a));s.height=r.height,s.leaf=r.leaf,i(r,this.toBBox),i(s,this.toBBox),t?e[t-1].children.push(s):this._splitRoot(r,s)},n.prototype._splitRoot=function(e,t){this.data=f([e,t]),this.data.height=e.height+1,this.data.leaf=!1,i(this.data,this.toBBox)},n.prototype._chooseSplitIndex=function(e,t,r){for(var n,o,i,s,c,u,d,p=1/0,h=1/0,f=t;f<=r-t;f++){var g=a(e,0,f,this.toBBox),y=a(e,f,r,this.toBBox),m=(o=g,i=y,void 0,void 0,void 0,void 0,s=Math.max(o.minX,i.minX),c=Math.max(o.minY,i.minY),u=Math.min(o.maxX,i.maxX),d=Math.min(o.maxY,i.maxY),Math.max(0,u-s)*Math.max(0,d-c)),v=l(g)+l(y);m<p?(p=m,n=f,h=v<h?v:h):m===p&&v<h&&(h=v,n=f)}return n||r-t},n.prototype._chooseSplitAxis=function(e,t,r){var n=e.leaf?this.compareMinX:c,o=e.leaf?this.compareMinY:u;this._allDistMargin(e,t,r,n)<this._allDistMargin(e,t,r,o)&&e.children.sort(n)},n.prototype._allDistMargin=function(e,t,r,n){e.children.sort(n);for(var o=this.toBBox,i=a(e,0,t,o),c=a(e,r-t,r,o),u=d(i)+d(c),l=t;l<r-t;l++){var p=e.children[l];s(i,e.leaf?o(p):p),u+=d(i)}for(var h=r-t-1;h>=t;h--){var f=e.children[h];s(c,e.leaf?o(f):f),u+=d(c)}return u},n.prototype._adjustParentBBoxes=function(e,t,r){for(var n=r;n>=0;n--)s(t[n],e)},n.prototype._condense=function(e){for(var t=e.length-1,r=void 0;t>=0;t--)0===e[t].children.length?t>0?(r=e[t-1].children).splice(r.indexOf(e[t]),1):this.clear():i(e[t],this.toBBox)},n}()},368:(e,t,r)=>{"use strict";var n=r(30);var o=function(e,t={}){if(null!=e.bbox&&!0!==t.recompute)return e.bbox;const r=[1/0,1/0,-1/0,-1/0];return n.coordEach.call(void 0,e,e=>{r[0]>e[0]&&(r[0]=e[0]),r[1]>e[1]&&(r[1]=e[1]),r[2]<e[0]&&(r[2]=e[0]),r[3]<e[1]&&(r[3]=e[1])}),r};t.Ay=o},426:(e,t,r)=>{"use strict";r.r(t),r.d(t,{manifest:()=>Co});var n={};r.r(n),r.d(n,{LAT_MAX:()=>V,LAT_MIN:()=>R,LAT_RENDERED_MAX:()=>j,LAT_RENDERED_MIN:()=>D,LNG_MAX:()=>B,LNG_MIN:()=>U,activeStates:()=>k,classes:()=>P,cursors:()=>T,events:()=>L,geojsonTypes:()=>O,interactions:()=>N,meta:()=>F,modes:()=>_,sources:()=>I,types:()=>C,updateActions:()=>A});var o={};r.r(o),r.d(o,{isActiveFeature:()=>Re,isEnterKey:()=>Ye,isEscapeKey:()=>Ge,isFeature:()=>je,isInactiveFeature:()=>De,isOfMetaType:()=>ke,isShiftDown:()=>Be,isShiftMousedown:()=>Ne,isTrue:()=>Xe,isVertex:()=>Ue,noTarget:()=>Ve});var i={};function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function s(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?s(Object(r),!0).forEach(function(t){u(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function u(e,t,r){return(t=function(e){var t=function(e){if("object"!=a(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=a(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==a(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r.r(i),r.d(i,{CommonSelectors:()=>o,ModeHandler:()=>x,StringSet:()=>$,constrainFeatureMovement:()=>nt,createMidPoint:()=>He,createSupplementaryPoints:()=>We,createVertex:()=>$e,doubleClickZoom:()=>Ke,euclideanDistance:()=>z,featuresAt:()=>W,getFeatureAtAndSetCursors:()=>Z,isClick:()=>re,isEventAtCoordinates:()=>ht,isTap:()=>ie,mapEventToBoundingBox:()=>q,moveFeatures:()=>ot,sortFeatures:()=>X,stringSetsAreEqual:()=>Mt,theme:()=>Fe,toDenseArray:()=>Me});var l={SET_MODE:function(e,t){return c(c({},e),{},{mode:t})},SET_FEATURE:function(e,t){return c(c({},e),{},{feature:void 0===t.feature?e.feature:t.feature,tempFeature:void 0===t.tempFeature?e.tempFeature:t.tempFeature})},SET_SELECTED_VERTEX_INDEX:function(e,t){return c(c({},e),{},{selectedVertexIndex:t.index,numVertecies:t.numVertecies})},TOGGLE_SNAP:function(e){return c(c({},e),{},{snap:!e.snap})}},d=r(738);function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach(function(t){g(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function g(e,t,r){return(t=function(e){var t=function(e){if("object"!=p(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=p(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==p(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function y(e){var t;return null!==(t=null==e?void 0:e._snapInstance)&&void 0!==t?t:null}function m(e){var t;return!!(null!=e&&e.status&&null!=e&&e.snapStatus&&(null===(t=e.snapCoords)||void 0===t?void 0:t.length)>=2)}function v(e){return m(e)?{lng:e.snapCoords[0],lat:e.snapCoords[1]}:null}function b(e,t,r){if(!e||!t||!e.status)return!1;var n=t.unproject(r);return e.snapToClosestPoint({point:r,lngLat:n}),!0}function E(e,t){if(e&&(e.snapStatus=!1,e.snapCoords=null,e.snappedFeatures&&(e.snappedFeatures=[]),e.closeFeatures&&(e.closeFeatures=[]),e.lines&&(e.lines=[]),"function"==typeof e.setMapData&&e.setMapData({type:"FeatureCollection",features:[]})),t){t.getLayer("snap-helper-circle")&&t.setLayoutProperty("snap-helper-circle","visibility","none");var r=t.getSource("snap-helper-circle");r&&r.setData({type:"FeatureCollection",features:[]})}}function w(e){e&&(e.snapStatus=!1,e.snapCoords=null,e.snappedFeatures&&(e.snappedFeatures=[]),e.closeFeatures&&(e.closeFeatures=[]),e.lines&&(e.lines=[]))}function S(e){return"function"==typeof(null==e?void 0:e.getSnapEnabled)&&!0===e.getSnapEnabled()}const x=function(e,t){const r={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},n={on(e,t,n){if(void 0===r[e])throw new Error(`Invalid event type: ${e}`);r[e].push({selector:t,fn:n})},render(e){t.store.featureChanged(e)}},o=function(e,o){const i=r[e];let a=i.length;for(;a--;){const e=i[a];if(e.selector(o)){e.fn.call(n,o)||t.store.render(),t.ui.updateMapClasses();break}}};return e.start.call(n),{render:e.render,stop(){e.stop&&e.stop()},trash(){e.trash&&(e.trash(),t.store.render())},combineFeatures(){e.combineFeatures&&e.combineFeatures()},uncombineFeatures(){e.uncombineFeatures&&e.uncombineFeatures()},drag(e){o("drag",e)},click(e){o("click",e)},mousemove(e){o("mousemove",e)},mousedown(e){o("mousedown",e)},mouseup(e){o("mouseup",e)},mouseout(e){o("mouseout",e)},keydown(e){o("keydown",e)},keyup(e){o("keyup",e)},touchstart(e){o("touchstart",e)},touchmove(e){o("touchmove",e)},touchend(e){o("touchend",e)},tap(e){o("tap",e)}}};var M=r(778);const P={CANVAS:"mapboxgl-canvas",CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},I={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},T={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},C={POLYGON:"polygon",LINE:"line_string",POINT:"point"},O={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},_={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select"},L={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},A={MOVE:"move",CHANGE_PROPERTIES:"change_properties",CHANGE_COORDINATES:"change_coordinates"},F={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},k={ACTIVE:"true",INACTIVE:"false"},N=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],R=-90,D=-85,V=90,j=85,U=-270,B=270,G={Point:0,LineString:1,MultiLineString:1,Polygon:2};function Y(e,t){const r=G[e.geometry.type]-G[t.geometry.type];return 0===r&&e.geometry.type===O.POLYGON?e.area-t.area:r}const X=function(e){return e.map(e=>(e.geometry.type===O.POLYGON&&(e.area=M.geometry({type:O.FEATURE,property:{},geometry:e.geometry})),e)).sort(Y).map(e=>(delete e.area,e))},q=function(e,t=0){return[[e.point.x-t,e.point.y-t],[e.point.x+t,e.point.y+t]]};function J(e){if(this._items={},this._nums={},this._length=e?e.length:0,e)for(let t=0,r=e.length;t<r;t++)this.add(e[t]),void 0!==e[t]&&("string"==typeof e[t]?this._items[e[t]]=t:this._nums[e[t]]=t)}J.prototype.add=function(e){return this.has(e)||(this._length++,"string"==typeof e?this._items[e]=this._length:this._nums[e]=this._length),this},J.prototype.delete=function(e){return!1===this.has(e)||(this._length--,delete this._items[e],delete this._nums[e]),this},J.prototype.has=function(e){return!("string"!=typeof e&&"number"!=typeof e||void 0===this._items[e]&&void 0===this._nums[e])},J.prototype.values=function(){const e=[];return Object.keys(this._items).forEach(t=>{e.push({k:t,v:this._items[t]})}),Object.keys(this._nums).forEach(t=>{e.push({k:JSON.parse(t),v:this._nums[t]})}),e.sort((e,t)=>e.v-t.v).map(e=>e.k)},J.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};const $=J,H=[F.FEATURE,F.MIDPOINT,F.VERTEX],W={click:function(e,t,r){return K(e,t,r,r.options.clickBuffer)},touch:function(e,t,r){return K(e,t,r,r.options.touchBuffer)}};function K(e,t,r,n){if(null===r.map)return[];const o=e?q(e,n):t,i={};r.options.styles&&(i.layers=r.options.styles.map(e=>e.id).filter(e=>null!=r.map.getLayer(e)));const a=r.map.queryRenderedFeatures(o,i).filter(e=>-1!==H.indexOf(e.properties.meta)),s=new $,c=[];return a.forEach(e=>{const t=e.properties.id;s.has(t)||(s.add(t),c.push(e))}),X(c)}function Z(e,t){const r=W.click(e,null,t),n={mouse:T.NONE};return r[0]&&(n.mouse=r[0].properties.active===k.ACTIVE?T.MOVE:T.POINTER,n.feature=r[0].properties.meta),-1!==t.events.currentModeName().indexOf("draw")&&(n.mouse=T.ADD),t.ui.queueMapClasses(n),t.ui.updateMapClasses(),r[0]}function z(e,t){const r=e.x-t.x,n=e.y-t.y;return Math.sqrt(r*r+n*n)}const Q=4,ee=12,te=500;function re(e,t,r={}){const n=null!=r.fineTolerance?r.fineTolerance:Q,o=null!=r.grossTolerance?r.grossTolerance:ee,i=null!=r.interval?r.interval:te;e.point=e.point||t.point,e.time=e.time||t.time;const a=z(e.point,t.point);return a<n||a<o&&t.time-e.time<i}const ne=25,oe=250;function ie(e,t,r={}){const n=null!=r.tolerance?r.tolerance:ne,o=null!=r.interval?r.interval:oe;return e.point=e.point||t.point,e.time=e.time||t.time,z(e.point,t.point)<n&&t.time-e.time<o}const ae=((e,t=21)=>(r=t)=>{let n="",o=0|r;for(;o--;)n+=e[Math.random()*e.length|0];return n})("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",32);function se(){return ae()}const ce=function(e,t){this.ctx=e,this.properties=t.properties||{},this.coordinates=t.geometry.coordinates,this.id=t.id||se(),this.type=t.geometry.type};ce.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},ce.prototype.incomingCoords=function(e){this.setCoordinates(e)},ce.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()},ce.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},ce.prototype.setProperty=function(e,t){this.properties[e]=t},ce.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:O.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},ce.prototype.internal=function(e){const t={id:this.id,meta:F.FEATURE,"meta:type":this.type,active:k.INACTIVE,mode:e};if(this.ctx.options.userProperties)for(const e in this.properties)t[`user_${e}`]=this.properties[e];return{type:O.FEATURE,properties:t,geometry:{coordinates:this.getCoordinates(),type:this.type}}};const ue=ce,le=function(e,t){ue.call(this,e,t)};(le.prototype=Object.create(ue.prototype)).isValid=function(){return"number"==typeof this.coordinates[0]&&"number"==typeof this.coordinates[1]},le.prototype.updateCoordinate=function(e,t,r){this.coordinates=3===arguments.length?[t,r]:[e,t],this.changed()},le.prototype.getCoordinate=function(){return this.getCoordinates()};const de=le,pe=function(e,t){ue.call(this,e,t)};(pe.prototype=Object.create(ue.prototype)).isValid=function(){return this.coordinates.length>1},pe.prototype.addCoordinate=function(e,t,r){this.changed();const n=parseInt(e,10);this.coordinates.splice(n,0,[t,r])},pe.prototype.getCoordinate=function(e){const t=parseInt(e,10);return JSON.parse(JSON.stringify(this.coordinates[t]))},pe.prototype.removeCoordinate=function(e){this.changed(),this.coordinates.splice(parseInt(e,10),1)},pe.prototype.updateCoordinate=function(e,t,r){const n=parseInt(e,10);this.coordinates[n]=[t,r],this.changed()};const he=pe,fe=function(e,t){ue.call(this,e,t),this.coordinates=this.coordinates.map(e=>e.slice(0,-1))};(fe.prototype=Object.create(ue.prototype)).isValid=function(){return 0!==this.coordinates.length&&this.coordinates.every(e=>e.length>2)},fe.prototype.incomingCoords=function(e){this.coordinates=e.map(e=>e.slice(0,-1)),this.changed()},fe.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()},fe.prototype.addCoordinate=function(e,t,r){this.changed();const n=e.split(".").map(e=>parseInt(e,10));this.coordinates[n[0]].splice(n[1],0,[t,r])},fe.prototype.removeCoordinate=function(e){this.changed();const t=e.split(".").map(e=>parseInt(e,10)),r=this.coordinates[t[0]];r&&(r.splice(t[1],1),r.length<3&&this.coordinates.splice(t[0],1))},fe.prototype.getCoordinate=function(e){const t=e.split(".").map(e=>parseInt(e,10)),r=this.coordinates[t[0]];return JSON.parse(JSON.stringify(r[t[1]]))},fe.prototype.getCoordinates=function(){return this.coordinates.map(e=>e.concat([e[0]]))},fe.prototype.updateCoordinate=function(e,t,r){this.changed();const n=e.split("."),o=parseInt(n[0],10),i=parseInt(n[1],10);void 0===this.coordinates[o]&&(this.coordinates[o]=[]),this.coordinates[o][i]=[t,r]};const ge=fe,ye={MultiPoint:de,MultiLineString:he,MultiPolygon:ge},me=(e,t,r,n,o)=>{const i=r.split("."),a=parseInt(i[0],10),s=i[1]?i.slice(1).join("."):null;return e[a][t](s,n,o)},ve=function(e,t){if(ue.call(this,e,t),delete this.coordinates,this.model=ye[t.geometry.type],void 0===this.model)throw new TypeError(`${t.geometry.type} is not a valid type`);this.features=this._coordinatesToFeatures(t.geometry.coordinates)};(ve.prototype=Object.create(ue.prototype))._coordinatesToFeatures=function(e){const t=this.model.bind(this);return e.map(e=>new t(this.ctx,{id:se(),type:O.FEATURE,properties:{},geometry:{coordinates:e,type:this.type.replace("Multi","")}}))},ve.prototype.isValid=function(){return this.features.every(e=>e.isValid())},ve.prototype.setCoordinates=function(e){this.features=this._coordinatesToFeatures(e),this.changed()},ve.prototype.getCoordinate=function(e){return me(this.features,"getCoordinate",e)},ve.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(e=>e.type===O.POLYGON?e.getCoordinates():e.coordinates)))},ve.prototype.updateCoordinate=function(e,t,r){me(this.features,"updateCoordinate",e,t,r),this.changed()},ve.prototype.addCoordinate=function(e,t,r){me(this.features,"addCoordinate",e,t,r),this.changed()},ve.prototype.removeCoordinate=function(e){me(this.features,"removeCoordinate",e),this.changed()},ve.prototype.getFeatures=function(){return this.features};const be=ve;function Ee(e){this.map=e.map,this.drawConfig=JSON.parse(JSON.stringify(e.options||{})),this._ctx=e}Ee.prototype.setSelected=function(e){return this._ctx.store.setSelected(e)},Ee.prototype.setSelectedCoordinates=function(e){this._ctx.store.setSelectedCoordinates(e),e.reduce((e,t)=>(void 0===e[t.feature_id]&&(e[t.feature_id]=!0,this._ctx.store.get(t.feature_id).changed()),e),{})},Ee.prototype.getSelected=function(){return this._ctx.store.getSelected()},Ee.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},Ee.prototype.isSelected=function(e){return this._ctx.store.isSelected(e)},Ee.prototype.getFeature=function(e){return this._ctx.store.get(e)},Ee.prototype.select=function(e){return this._ctx.store.select(e)},Ee.prototype.deselect=function(e){return this._ctx.store.deselect(e)},Ee.prototype.deleteFeature=function(e,t={}){return this._ctx.store.delete(e,t)},Ee.prototype.addFeature=function(e,t={}){return this._ctx.store.add(e,t)},Ee.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},Ee.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},Ee.prototype.setActionableState=function(e={}){const t={trash:e.trash||!1,combineFeatures:e.combineFeatures||!1,uncombineFeatures:e.uncombineFeatures||!1};return this._ctx.events.actionable(t)},Ee.prototype.changeMode=function(e,t={},r={}){return this._ctx.events.changeMode(e,t,r)},Ee.prototype.fire=function(e,t){return this._ctx.events.fire(e,t)},Ee.prototype.updateUIClasses=function(e){return this._ctx.ui.queueMapClasses(e)},Ee.prototype.activateUIButton=function(e){return this._ctx.ui.setActiveButton(e)},Ee.prototype.featuresAt=function(e,t,r="click"){if("click"!==r&&"touch"!==r)throw new Error("invalid buffer type");return W[r](e,t,this._ctx)},Ee.prototype.newFeature=function(e){const t=e.geometry.type;return t===O.POINT?new de(this._ctx,e):t===O.LINE_STRING?new he(this._ctx,e):t===O.POLYGON?new ge(this._ctx,e):new be(this._ctx,e)},Ee.prototype.isInstanceOf=function(e,t){if(e===O.POINT)return t instanceof de;if(e===O.LINE_STRING)return t instanceof he;if(e===O.POLYGON)return t instanceof ge;if("MultiFeature"===e)return t instanceof be;throw new Error(`Unknown feature class: ${e}`)},Ee.prototype.doRender=function(e){return this._ctx.store.featureChanged(e)};const we=Ee;Ee.prototype.onSetup=function(){},Ee.prototype.onDrag=function(){},Ee.prototype.onClick=function(){},Ee.prototype.onMouseMove=function(){},Ee.prototype.onMouseDown=function(){},Ee.prototype.onMouseUp=function(){},Ee.prototype.onMouseOut=function(){},Ee.prototype.onKeyUp=function(){},Ee.prototype.onKeyDown=function(){},Ee.prototype.onTouchStart=function(){},Ee.prototype.onTouchMove=function(){},Ee.prototype.onTouchEnd=function(){},Ee.prototype.onTap=function(){},Ee.prototype.onStop=function(){},Ee.prototype.onTrash=function(){},Ee.prototype.onCombineFeature=function(){},Ee.prototype.onUncombineFeature=function(){},Ee.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};const Se={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},xe=Object.keys(Se);const Me=function(e){return[].concat(e).filter(e=>void 0!==e)};function Pe(){const e=this;if(!e.ctx.map||void 0===e.ctx.map.getSource(I.HOT))return s();const t=e.ctx.events.currentModeName();e.ctx.ui.queueMapClasses({mode:t});let r=[],n=[];e.isDirty?n=e.getAllIds():(r=e.getChangedIds().filter(t=>void 0!==e.get(t)),n=e.sources.hot.filter(t=>t.properties.id&&-1===r.indexOf(t.properties.id)&&void 0!==e.get(t.properties.id)).map(e=>e.properties.id)),e.sources.hot=[];const o=e.sources.cold.length;e.sources.cold=e.isDirty?[]:e.sources.cold.filter(e=>{const t=e.properties.id||e.properties.parent;return-1===r.indexOf(t)});const i=o!==e.sources.cold.length||n.length>0;function a(r,n){const o=e.get(r).internal(t);e.ctx.events.currentModeRender(o,r=>{r.properties.mode=t,e.sources[n].push(r)})}function s(){e.isDirty=!1,e.clearChangedIds()}r.forEach(e=>a(e,"hot")),n.forEach(e=>a(e,"cold")),i&&e.ctx.map.getSource(I.COLD).setData({type:O.FEATURE_COLLECTION,features:e.sources.cold}),e.ctx.map.getSource(I.HOT).setData({type:O.FEATURE_COLLECTION,features:e.sources.hot}),s()}function Ie(e){let t;this._features={},this._featureIds=new $,this._selectedFeatureIds=new $,this._selectedCoordinates=[],this._changedFeatureIds=new $,this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=e,this.sources={hot:[],cold:[]},this.render=()=>{t||(t=requestAnimationFrame(()=>{t=null,Pe.call(this),this._emitSelectionChange&&(this.ctx.events.fire(L.SELECTION_CHANGE,{features:this.getSelected().map(e=>e.toGeoJSON()),points:this.getSelectedCoordinates().map(e=>({type:O.FEATURE,properties:{},geometry:{type:O.POINT,coordinates:e.coordinates}}))}),this._emitSelectionChange=!1),this.ctx.events.fire(L.RENDER,{})}))},this.isDirty=!1}function Te(e,t={}){const r=e._selectedCoordinates.filter(t=>e._selectedFeatureIds.has(t.feature_id));e._selectedCoordinates.length===r.length||t.silent||(e._emitSelectionChange=!0),e._selectedCoordinates=r}Ie.prototype.createRenderBatch=function(){const e=this.render;let t=0;return this.render=function(){t++},()=>{this.render=e,t>0&&this.render()}},Ie.prototype.setDirty=function(){return this.isDirty=!0,this},Ie.prototype.featureCreated=function(e,t={}){if(this._changedFeatureIds.add(e),!0!==(null!=t.silent?t.silent:this.ctx.options.suppressAPIEvents)){const t=this.get(e);this.ctx.events.fire(L.CREATE,{features:[t.toGeoJSON()]})}return this},Ie.prototype.featureChanged=function(e,t={}){return this._changedFeatureIds.add(e),!0!==(null!=t.silent?t.silent:this.ctx.options.suppressAPIEvents)&&this.ctx.events.fire(L.UPDATE,{action:t.action?t.action:A.CHANGE_COORDINATES,features:[this.get(e).toGeoJSON()]}),this},Ie.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},Ie.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},Ie.prototype.getAllIds=function(){return this._featureIds.values()},Ie.prototype.add=function(e,t={}){return this._features[e.id]=e,this._featureIds.add(e.id),this.featureCreated(e.id,{silent:t.silent}),this},Ie.prototype.delete=function(e,t={}){const r=[];return Me(e).forEach(e=>{this._featureIds.has(e)&&(this._featureIds.delete(e),this._selectedFeatureIds.delete(e),t.silent||-1===r.indexOf(this._features[e])&&r.push(this._features[e].toGeoJSON()),delete this._features[e],this.isDirty=!0)}),r.length&&this.ctx.events.fire(L.DELETE,{features:r}),Te(this,t),this},Ie.prototype.get=function(e){return this._features[e]},Ie.prototype.getAll=function(){return Object.keys(this._features).map(e=>this._features[e])},Ie.prototype.select=function(e,t={}){return Me(e).forEach(e=>{this._selectedFeatureIds.has(e)||(this._selectedFeatureIds.add(e),this._changedFeatureIds.add(e),t.silent||(this._emitSelectionChange=!0))}),this},Ie.prototype.deselect=function(e,t={}){return Me(e).forEach(e=>{this._selectedFeatureIds.has(e)&&(this._selectedFeatureIds.delete(e),this._changedFeatureIds.add(e),t.silent||(this._emitSelectionChange=!0))}),Te(this,t),this},Ie.prototype.clearSelected=function(e={}){return this.deselect(this._selectedFeatureIds.values(),{silent:e.silent}),this},Ie.prototype.setSelected=function(e,t={}){return e=Me(e),this.deselect(this._selectedFeatureIds.values().filter(t=>-1===e.indexOf(t)),{silent:t.silent}),this.select(e.filter(e=>!this._selectedFeatureIds.has(e)),{silent:t.silent}),this},Ie.prototype.setSelectedCoordinates=function(e){return this._selectedCoordinates=e,this._emitSelectionChange=!0,this},Ie.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},Ie.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},Ie.prototype.getSelected=function(){return this.getSelectedIds().map(e=>this.get(e))},Ie.prototype.getSelectedCoordinates=function(){return this._selectedCoordinates.map(e=>({coordinates:this.get(e.feature_id).getCoordinate(e.coord_path)}))},Ie.prototype.isSelected=function(e){return this._selectedFeatureIds.has(e)},Ie.prototype.setFeatureProperty=function(e,t,r,n={}){this.get(e).setProperty(t,r),this.featureChanged(e,{silent:n.silent,action:A.CHANGE_PROPERTIES})},Ie.prototype.storeMapConfig=function(){N.forEach(e=>{this.ctx.map[e]&&(this._mapInitialConfig[e]=this.ctx.map[e].isEnabled())})},Ie.prototype.restoreMapConfig=function(){Object.keys(this._mapInitialConfig).forEach(e=>{this._mapInitialConfig[e]?this.ctx.map[e].enable():this.ctx.map[e].disable()})},Ie.prototype.getInitialConfigValue=function(e){return void 0===this._mapInitialConfig[e]||this._mapInitialConfig[e]};const Ce=["mode","feature","mouse"];function Oe(e){let t=null,r=null;const n={onRemove(){return e.map.off("load",n.connect),clearInterval(r),n.removeLayers(),e.store.restoreMapConfig(),e.ui.removeButtons(),e.events.removeEventListeners(),e.ui.clearMapClasses(),e.boxZoomInitial&&e.map.boxZoom.enable(),e.map=null,e.container=null,e.store=null,t&&t.parentNode&&t.parentNode.removeChild(t),t=null,this},connect(){e.map.off("load",n.connect),clearInterval(r),n.addLayers(),e.store.storeMapConfig(),e.events.addEventListeners()},onAdd(o){if(e.map=o,e.events=function(e){const t=Object.keys(e.options.modes).reduce((t,r)=>(t[r]=function(e){const t=Object.keys(e);return function(r,n={}){let o={};const i=t.reduce((t,r)=>(t[r]=e[r],t),new we(r));return{start(){o=i.onSetup(n),xe.forEach(t=>{const r=Se[t];let n=()=>!1;var a;e[r]&&(n=()=>!0),this.on(t,n,(a=r,e=>i[a](o,e)))})},stop(){i.onStop(o)},trash(){i.onTrash(o)},combineFeatures(){i.onCombineFeatures(o)},uncombineFeatures(){i.onUncombineFeatures(o)},render(e,t){i.toDisplayFeatures(o,e,t)}}}}(e.options.modes[r]),t),{});let r={},n={};const o={};let i=null,a=null;o.drag=function(t,r){r({point:t.point,time:(new Date).getTime()})?(e.ui.queueMapClasses({mouse:T.DRAG}),a.drag(t)):t.originalEvent.stopPropagation()},o.mousedrag=function(e){o.drag(e,e=>!re(r,e))},o.touchdrag=function(e){o.drag(e,e=>!ie(n,e))},o.mousemove=function(t){if(1===(void 0!==t.originalEvent.buttons?t.originalEvent.buttons:t.originalEvent.which))return o.mousedrag(t);const r=Z(t,e);t.featureTarget=r,a.mousemove(t)},o.mousedown=function(t){r={time:(new Date).getTime(),point:t.point};const n=Z(t,e);t.featureTarget=n,a.mousedown(t)},o.mouseup=function(t){const n=Z(t,e);t.featureTarget=n,re(r,{point:t.point,time:(new Date).getTime()})?a.click(t):a.mouseup(t)},o.mouseout=function(e){a.mouseout(e)},o.touchstart=function(t){if(!e.options.touchEnabled)return;n={time:(new Date).getTime(),point:t.point};const r=W.touch(t,null,e)[0];t.featureTarget=r,a.touchstart(t)},o.touchmove=function(t){if(e.options.touchEnabled)return a.touchmove(t),o.touchdrag(t)},o.touchend=function(t){if(t.originalEvent.preventDefault(),!e.options.touchEnabled)return;const r=W.touch(t,null,e)[0];t.featureTarget=r,ie(n,{time:(new Date).getTime(),point:t.point})?a.tap(t):a.touchend(t)};const s=e=>!(8===e||46===e||e>=48&&e<=57);function c(r,n,o={}){a.stop();const s=t[r];if(void 0===s)throw new Error(`${r} is not valid`);i=r;const c=s(e,n);a=x(c,e),o.silent||e.map.fire(L.MODE_CHANGE,{mode:r}),e.store.setDirty(),e.store.render()}o.keydown=function(t){(t.srcElement||t.target).classList.contains(P.CANVAS)&&(8!==t.keyCode&&46!==t.keyCode||!e.options.controls.trash?s(t.keyCode)?a.keydown(t):49===t.keyCode&&e.options.controls.point?c(_.DRAW_POINT):50===t.keyCode&&e.options.controls.line_string?c(_.DRAW_LINE_STRING):51===t.keyCode&&e.options.controls.polygon&&c(_.DRAW_POLYGON):(t.preventDefault(),a.trash()))},o.keyup=function(e){s(e.keyCode)&&a.keyup(e)},o.zoomend=function(){e.store.changeZoom()},o.data=function(t){if("style"===t.dataType){const{setup:t,map:r,options:n,store:o}=e;n.styles.some(e=>r.getLayer(e.id))||(t.addLayers(),o.setDirty(),o.render())}};const u={trash:!1,combineFeatures:!1,uncombineFeatures:!1},l={start(){i=e.options.defaultMode,a=x(t[i](e),e)},changeMode:c,actionable:function(t){let r=!1;Object.keys(t).forEach(e=>{if(void 0===u[e])throw new Error("Invalid action type");u[e]!==t[e]&&(r=!0),u[e]=t[e]}),r&&e.map.fire(L.ACTIONABLE,{actions:u})},currentModeName:()=>i,currentModeRender:(e,t)=>a.render(e,t),fire(t,r){e.map&&e.map.fire(t,r)},addEventListeners(){e.map.on("mousemove",o.mousemove),e.map.on("mousedown",o.mousedown),e.map.on("mouseup",o.mouseup),e.map.on("data",o.data),e.map.on("touchmove",o.touchmove),e.map.on("touchstart",o.touchstart),e.map.on("touchend",o.touchend),e.container.addEventListener("mouseout",o.mouseout),e.options.keybindings&&(e.container.addEventListener("keydown",o.keydown),e.container.addEventListener("keyup",o.keyup))},removeEventListeners(){e.map.off("mousemove",o.mousemove),e.map.off("mousedown",o.mousedown),e.map.off("mouseup",o.mouseup),e.map.off("data",o.data),e.map.off("touchmove",o.touchmove),e.map.off("touchstart",o.touchstart),e.map.off("touchend",o.touchend),e.container.removeEventListener("mouseout",o.mouseout),e.options.keybindings&&(e.container.removeEventListener("keydown",o.keydown),e.container.removeEventListener("keyup",o.keyup))},trash(e){a.trash(e)},combineFeatures(){a.combineFeatures()},uncombineFeatures(){a.uncombineFeatures()},getMode:()=>i};return l}(e),e.ui=function(e){const t={};let r=null,n={mode:null,feature:null,mouse:null},o={mode:null,feature:null,mouse:null};function i(e){o=Object.assign(o,e)}function a(){if(!e.container)return;const t=[],r=[];Ce.forEach(e=>{o[e]!==n[e]&&(t.push(`${e}-${n[e]}`),null!==o[e]&&r.push(`${e}-${o[e]}`))}),t.length>0&&e.container.classList.remove(...t),r.length>0&&e.container.classList.add(...r),n=Object.assign(n,o)}function s(e,t={}){const n=document.createElement("button");return n.className=`${P.CONTROL_BUTTON} ${t.className}`,n.setAttribute("title",t.title),t.container.appendChild(n),n.addEventListener("click",n=>{if(n.preventDefault(),n.stopPropagation(),n.target===r)return c(),void t.onDeactivate();u(e),t.onActivate()},!0),n}function c(){r&&(r.classList.remove(P.ACTIVE_BUTTON),r=null)}function u(e){c();const n=t[e];n&&n&&"trash"!==e&&(n.classList.add(P.ACTIVE_BUTTON),r=n)}return{setActiveButton:u,queueMapClasses:i,updateMapClasses:a,clearMapClasses:function(){i({mode:null,feature:null,mouse:null}),a()},addButtons:function(){const r=e.options.controls,n=document.createElement("div");return n.className=`${P.CONTROL_GROUP} ${P.CONTROL_BASE}`,r?(r[C.LINE]&&(t[C.LINE]=s(C.LINE,{container:n,className:P.CONTROL_BUTTON_LINE,title:"LineString tool "+(e.options.keybindings?"(l)":""),onActivate:()=>e.events.changeMode(_.DRAW_LINE_STRING),onDeactivate:()=>e.events.trash()})),r[C.POLYGON]&&(t[C.POLYGON]=s(C.POLYGON,{container:n,className:P.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(e.options.keybindings?"(p)":""),onActivate:()=>e.events.changeMode(_.DRAW_POLYGON),onDeactivate:()=>e.events.trash()})),r[C.POINT]&&(t[C.POINT]=s(C.POINT,{container:n,className:P.CONTROL_BUTTON_POINT,title:"Marker tool "+(e.options.keybindings?"(m)":""),onActivate:()=>e.events.changeMode(_.DRAW_POINT),onDeactivate:()=>e.events.trash()})),r.trash&&(t.trash=s("trash",{container:n,className:P.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:()=>{e.events.trash()}})),r.combine_features&&(t.combine_features=s("combineFeatures",{container:n,className:P.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:()=>{e.events.combineFeatures()}})),r.uncombine_features&&(t.uncombine_features=s("uncombineFeatures",{container:n,className:P.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:()=>{e.events.uncombineFeatures()}})),n):n},removeButtons:function(){Object.keys(t).forEach(e=>{const r=t[e];r.parentNode&&r.parentNode.removeChild(r),delete t[e]})}}}(e),e.container=o.getContainer(),e.store=new Ie(e),t=e.ui.addButtons(),e.options.boxSelect){e.boxZoomInitial=o.boxZoom.isEnabled(),o.boxZoom.disable();const t=o.dragPan.isEnabled();o.dragPan.disable(),o.dragPan.enable(),t||o.dragPan.disable()}return o.loaded()?n.connect():(o.on("load",n.connect),r=setInterval(()=>{o.loaded()&&n.connect()},16)),e.events.start(),t},addLayers(){e.map.addSource(I.COLD,{data:{type:O.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.map.addSource(I.HOT,{data:{type:O.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.options.styles.forEach(t=>{e.map.addLayer(t)}),e.store.setDirty(!0),e.store.render()},removeLayers(){e.options.styles.forEach(t=>{e.map.getLayer(t.id)&&e.map.removeLayer(t.id)}),e.map.getSource(I.COLD)&&e.map.removeSource(I.COLD),e.map.getSource(I.HOT)&&e.map.removeSource(I.HOT)}};return e.setup=n,n}const _e="#3bb2d0",Le="#fbb03b",Ae="#fff",Fe=[{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"]],paint:{"fill-color":["case",["==",["get","active"],"true"],Le,_e],"fill-opacity":.1}},{id:"gl-draw-lines",type:"line",filter:["any",["==","$type","LineString"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["case",["==",["get","active"],"true"],Le,_e],"line-dasharray":["case",["==",["get","active"],"true"],[.2,2],[2,0]],"line-width":2}},{id:"gl-draw-point-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":Ae}},{id:"gl-draw-point-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":["case",["==",["get","active"],"true"],Le,_e]}},{id:"gl-draw-vertex-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":Ae}},{id:"gl-draw-vertex-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":Le}},{id:"gl-draw-midpoint",type:"circle",filter:["all",["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":Le}}];function ke(e){return function(t){const r=t.featureTarget;return!!r&&!!r.properties&&r.properties.meta===e}}function Ne(e){return!!e.originalEvent&&!!e.originalEvent.shiftKey&&0===e.originalEvent.button}function Re(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.active===k.ACTIVE&&e.featureTarget.properties.meta===F.FEATURE}function De(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.active===k.INACTIVE&&e.featureTarget.properties.meta===F.FEATURE}function Ve(e){return void 0===e.featureTarget}function je(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.meta===F.FEATURE}function Ue(e){const t=e.featureTarget;return!!t&&!!t.properties&&t.properties.meta===F.VERTEX}function Be(e){return!!e.originalEvent&&!0===e.originalEvent.shiftKey}function Ge(e){return 27===e.keyCode}function Ye(e){return 13===e.keyCode}function Xe(){return!0}function qe(e,t){this.x=e,this.y=t}qe.prototype={clone(){return new qe(this.x,this.y)},add(e){return this.clone()._add(e)},sub(e){return this.clone()._sub(e)},multByPoint(e){return this.clone()._multByPoint(e)},divByPoint(e){return this.clone()._divByPoint(e)},mult(e){return this.clone()._mult(e)},div(e){return this.clone()._div(e)},rotate(e){return this.clone()._rotate(e)},rotateAround(e,t){return this.clone()._rotateAround(e,t)},matMult(e){return this.clone()._matMult(e)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(e){return this.x===e.x&&this.y===e.y},dist(e){return Math.sqrt(this.distSqr(e))},distSqr(e){const t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle(){return Math.atan2(this.y,this.x)},angleTo(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith(e){return this.angleWithSep(e.x,e.y)},angleWithSep(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult(e){const t=e[0]*this.x+e[1]*this.y,r=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=r,this},_add(e){return this.x+=e.x,this.y+=e.y,this},_sub(e){return this.x-=e.x,this.y-=e.y,this},_mult(e){return this.x*=e,this.y*=e,this},_div(e){return this.x/=e,this.y/=e,this},_multByPoint(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint(e){return this.x/=e.x,this.y/=e.y,this},_unit(){return this._div(this.mag()),this},_perp(){const e=this.y;return this.y=this.x,this.x=-e,this},_rotate(e){const t=Math.cos(e),r=Math.sin(e),n=t*this.x-r*this.y,o=r*this.x+t*this.y;return this.x=n,this.y=o,this},_rotateAround(e,t){const r=Math.cos(e),n=Math.sin(e),o=t.x+r*(this.x-t.x)-n*(this.y-t.y),i=t.y+n*(this.x-t.x)+r*(this.y-t.y);return this.x=o,this.y=i,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:qe},qe.convert=function(e){if(e instanceof qe)return e;if(Array.isArray(e))return new qe(+e[0],+e[1]);if(void 0!==e.x&&void 0!==e.y)return new qe(+e.x,+e.y);throw new Error("Expected [x, y] or {x, y} point format")};const Je=function(e,t){const r=t.getBoundingClientRect();return new qe(e.clientX-r.left-(t.clientLeft||0),e.clientY-r.top-(t.clientTop||0))};function $e(e,t,r,n){return{type:O.FEATURE,properties:{meta:F.VERTEX,parent:e,coord_path:r,active:n?k.ACTIVE:k.INACTIVE},geometry:{type:O.POINT,coordinates:t}}}function He(e,t,r){const n=t.geometry.coordinates,o=r.geometry.coordinates;if(n[1]>j||n[1]<D||o[1]>j||o[1]<D)return null;const i={lng:(n[0]+o[0])/2,lat:(n[1]+o[1])/2};return{type:O.FEATURE,properties:{meta:F.MIDPOINT,parent:e,lng:i.lng,lat:i.lat,coord_path:r.properties.coord_path},geometry:{type:O.POINT,coordinates:[i.lng,i.lat]}}}const We=function e(t,r={},n=null){const{type:o,coordinates:i}=t.geometry,a=t.properties&&t.properties.id;let s=[];function c(e,t){let n="",o=null;e.forEach((e,i)=>{const c=null!=t?`${t}.${i}`:String(i),l=$e(a,e,c,u(c));if(r.midpoints&&o){const e=He(a,o,l);e&&s.push(e)}o=l;const d=JSON.stringify(e);n!==d&&s.push(l),0===i&&(n=d)})}function u(e){return!!r.selectedPaths&&-1!==r.selectedPaths.indexOf(e)}return o===O.POINT?s.push($e(a,i,n,u(n))):o===O.POLYGON?i.forEach((e,t)=>{c(e,null!==n?`${n}.${t}`:String(t))}):o===O.LINE_STRING?c(i,n):0===o.indexOf(O.MULTI_PREFIX)&&function(){const n=o.replace(O.MULTI_PREFIX,"");i.forEach((o,i)=>{const a={type:O.FEATURE,properties:t.properties,geometry:{type:n,coordinates:o}};s=s.concat(e(a,r,i))})}(),s},Ke={enable(e){setTimeout(()=>{e.map&&e.map.doubleClickZoom&&e._ctx&&e._ctx.store&&e._ctx.store.getInitialConfigValue&&e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()},0)},disable(e){setTimeout(()=>{e.map&&e.map.doubleClickZoom&&e.map.doubleClickZoom.disable()},0)}},{LAT_MIN:Ze,LAT_MAX:ze,LAT_RENDERED_MIN:Qe,LAT_RENDERED_MAX:et,LNG_MIN:tt,LNG_MAX:rt}=n;function nt(e,t){let r=Ze,n=ze,o=Ze,i=ze,a=rt,s=tt;e.forEach(e=>{const t=function(e){const t={Point:0,LineString:1,Polygon:2,MultiPoint:1,MultiLineString:2,MultiPolygon:3}[e.geometry.type],r=[e.geometry.coordinates].flat(t),n=r.map(e=>e[0]),o=r.map(e=>e[1]),i=e=>Math.min.apply(null,e),a=e=>Math.max.apply(null,e);return[i(n),i(o),a(n),a(o)]}(e),c=t[1],u=t[3],l=t[0],d=t[2];c>r&&(r=c),u<n&&(n=u),u>o&&(o=u),c<i&&(i=c),l<a&&(a=l),d>s&&(s=d)});const c=t;return r+c.lat>et&&(c.lat=et-r),o+c.lat>ze&&(c.lat=ze-o),n+c.lat<Qe&&(c.lat=Qe-n),i+c.lat<Ze&&(c.lat=Ze-i),a+c.lng<=tt&&(c.lng+=360*Math.ceil(Math.abs(c.lng)/360)),s+c.lng>=rt&&(c.lng-=360*Math.ceil(Math.abs(c.lng)/360)),c}function ot(e,t){const r=nt(e.map(e=>e.toGeoJSON()),t);e.forEach(e=>{const t=e.getCoordinates(),n=e=>{const t={lng:e[0]+r.lng,lat:e[1]+r.lat};return[t.lng,t.lat]},o=e=>e.map(e=>n(e));let i;e.type===O.POINT?i=n(t):e.type===O.LINE_STRING||e.type===O.MULTI_POINT?i=t.map(n):e.type===O.POLYGON||e.type===O.MULTI_LINE_STRING?i=t.map(o):e.type===O.MULTI_POLYGON&&(i=t.map(e=>e.map(e=>o(e)))),e.incomingCoords(i)})}const it={onSetup:function(e){const t={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initialDragPanState:this.map.dragPan.isEnabled(),initiallySelectedFeatureIds:e.featureIds||[]};return this.setSelected(t.initiallySelectedFeatureIds.filter(e=>void 0!==this.getFeature(e))),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),t},fireUpdate:function(){this.fire(L.UPDATE,{action:A.MOVE,features:this.getSelected().map(e=>e.toGeoJSON())})},fireActionable:function(){const e=this.getSelected(),t=e.filter(e=>this.isInstanceOf("MultiFeature",e));let r=!1;if(e.length>1){r=!0;const t=e[0].type.replace("Multi","");e.forEach(e=>{e.type.replace("Multi","")!==t&&(r=!1)})}const n=t.length>0,o=e.length>0;this.setActionableState({combineFeatures:r,uncombineFeatures:n,trash:o})},getUniqueIds:function(e){return e.length?e.map(e=>e.properties.id).filter(e=>void 0!==e).reduce((e,t)=>(e.add(t),e),new $).values():[]},stopExtendedInteractions:function(e){e.boxSelectElement&&(e.boxSelectElement.parentNode&&e.boxSelectElement.parentNode.removeChild(e.boxSelectElement),e.boxSelectElement=null),(e.canDragMove||e.canBoxSelect)&&!0===e.initialDragPanState&&this.map.dragPan.enable(),e.boxSelecting=!1,e.canBoxSelect=!1,e.dragMoving=!1,e.canDragMove=!1},onStop:function(){Ke.enable(this)},onMouseMove:function(e,t){return je(t)&&e.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(e),!0},onMouseOut:function(e){return!e.dragMoving||this.fireUpdate()}};it.onTap=it.onClick=function(e,t){return Ve(t)?this.clickAnywhere(e,t):ke(F.VERTEX)(t)?this.clickOnVertex(e,t):je(t)?this.clickOnFeature(e,t):void 0},it.clickAnywhere=function(e){const t=this.getSelectedIds();t.length&&(this.clearSelectedFeatures(),t.forEach(e=>this.doRender(e))),Ke.enable(this),this.stopExtendedInteractions(e)},it.clickOnVertex=function(e,t){this.changeMode(_.DIRECT_SELECT,{featureId:t.featureTarget.properties.parent,coordPath:t.featureTarget.properties.coord_path,startPos:t.lngLat}),this.updateUIClasses({mouse:T.MOVE})},it.startOnActiveFeature=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),this.doRender(t.featureTarget.properties.id),e.canDragMove=!0,e.dragMoveLocation=t.lngLat},it.clickOnFeature=function(e,t){Ke.disable(this),this.stopExtendedInteractions(e);const r=Be(t),n=this.getSelectedIds(),o=t.featureTarget.properties.id,i=this.isSelected(o);if(!r&&i&&this.getFeature(o).type!==O.POINT)return this.changeMode(_.DIRECT_SELECT,{featureId:o});i&&r?(this.deselect(o),this.updateUIClasses({mouse:T.POINTER}),1===n.length&&Ke.enable(this)):!i&&r?(this.select(o),this.updateUIClasses({mouse:T.MOVE})):i||r||(n.forEach(e=>this.doRender(e)),this.setSelected(o),this.updateUIClasses({mouse:T.MOVE})),this.doRender(o)},it.onMouseDown=function(e,t){return e.initialDragPanState=this.map.dragPan.isEnabled(),Re(t)?this.startOnActiveFeature(e,t):this.drawConfig.boxSelect&&Ne(t)?this.startBoxSelect(e,t):void 0},it.startBoxSelect=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),e.boxSelectStartLocation=Je(t.originalEvent,this.map.getContainer()),e.canBoxSelect=!0},it.onTouchStart=function(e,t){if(Re(t))return this.startOnActiveFeature(e,t)},it.onDrag=function(e,t){return e.canDragMove?this.dragMove(e,t):this.drawConfig.boxSelect&&e.canBoxSelect?this.whileBoxSelect(e,t):void 0},it.whileBoxSelect=function(e,t){e.boxSelecting=!0,this.updateUIClasses({mouse:T.ADD}),e.boxSelectElement||(e.boxSelectElement=document.createElement("div"),e.boxSelectElement.classList.add(P.BOX_SELECT),this.map.getContainer().appendChild(e.boxSelectElement));const r=Je(t.originalEvent,this.map.getContainer()),n=Math.min(e.boxSelectStartLocation.x,r.x),o=Math.max(e.boxSelectStartLocation.x,r.x),i=Math.min(e.boxSelectStartLocation.y,r.y),a=Math.max(e.boxSelectStartLocation.y,r.y),s=`translate(${n}px, ${i}px)`;e.boxSelectElement.style.transform=s,e.boxSelectElement.style.WebkitTransform=s,e.boxSelectElement.style.width=o-n+"px",e.boxSelectElement.style.height=a-i+"px"},it.dragMove=function(e,t){e.dragMoving=!0,t.originalEvent.stopPropagation();const r={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};ot(this.getSelected(),r),e.dragMoveLocation=t.lngLat},it.onTouchEnd=it.onMouseUp=function(e,t){if(e.dragMoving)this.fireUpdate();else if(e.boxSelecting){const r=[e.boxSelectStartLocation,Je(t.originalEvent,this.map.getContainer())],n=this.featuresAt(null,r,"click"),o=this.getUniqueIds(n).filter(e=>!this.isSelected(e));o.length&&(this.select(o),o.forEach(e=>this.doRender(e)),this.updateUIClasses({mouse:T.MOVE}))}this.stopExtendedInteractions(e)},it.toDisplayFeatures=function(e,t,r){t.properties.active=this.isSelected(t.properties.id)?k.ACTIVE:k.INACTIVE,r(t),this.fireActionable(),t.properties.active===k.ACTIVE&&t.geometry.type!==O.POINT&&We(t).forEach(r)},it.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},it.onCombineFeatures=function(){const e=this.getSelected();if(0===e.length||e.length<2)return;const t=[],r=[],n=e[0].type.replace("Multi","");for(let o=0;o<e.length;o++){const i=e[o];if(i.type.replace("Multi","")!==n)return;i.type.includes("Multi")?i.getCoordinates().forEach(e=>{t.push(e)}):t.push(i.getCoordinates()),r.push(i.toGeoJSON())}if(r.length>1){const e=this.newFeature({type:O.FEATURE,properties:r[0].properties,geometry:{type:`Multi${n}`,coordinates:t}});this.addFeature(e),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([e.id]),this.fire(L.COMBINE_FEATURES,{createdFeatures:[e.toGeoJSON()],deletedFeatures:r})}this.fireActionable()},it.onUncombineFeatures=function(){const e=this.getSelected();if(0===e.length)return;const t=[],r=[];for(let n=0;n<e.length;n++){const o=e[n];this.isInstanceOf("MultiFeature",o)&&(o.getFeatures().forEach(e=>{this.addFeature(e),e.properties=o.properties,t.push(e.toGeoJSON()),this.select([e.id])}),this.deleteFeature(o.id,{silent:!0}),r.push(o.toGeoJSON()))}t.length>1&&this.fire(L.UNCOMBINE_FEATURES,{createdFeatures:t,deletedFeatures:r}),this.fireActionable()};const at=it,st=ke(F.VERTEX),ct=ke(F.MIDPOINT),ut={fireUpdate:function(){this.fire(L.UPDATE,{action:A.CHANGE_COORDINATES,features:this.getSelected().map(e=>e.toGeoJSON())})},fireActionable:function(e){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:e.selectedCoordPaths.length>0})},startDragging:function(e,t){e.initialDragPanState=this.map.dragPan.isEnabled(),this.map.dragPan.disable(),e.canDragMove=!0,e.dragMoveLocation=t.lngLat},stopDragging:function(e){e.canDragMove&&!0===e.initialDragPanState&&this.map.dragPan.enable(),e.dragMoving=!1,e.canDragMove=!1,e.dragMoveLocation=null},onVertex:function(e,t){this.startDragging(e,t);const r=t.featureTarget.properties,n=e.selectedCoordPaths.indexOf(r.coord_path);Be(t)||-1!==n?Be(t)&&-1===n&&e.selectedCoordPaths.push(r.coord_path):e.selectedCoordPaths=[r.coord_path];const o=this.pathsToCoordinates(e.featureId,e.selectedCoordPaths);this.setSelectedCoordinates(o)},onMidpoint:function(e,t){this.startDragging(e,t);const r=t.featureTarget.properties;e.feature.addCoordinate(r.coord_path,r.lng,r.lat),this.fireUpdate(),e.selectedCoordPaths=[r.coord_path]},pathsToCoordinates:function(e,t){return t.map(t=>({feature_id:e,coord_path:t}))},onFeature:function(e,t){0===e.selectedCoordPaths.length?this.startDragging(e,t):this.stopDragging(e)},dragFeature:function(e,t,r){ot(this.getSelected(),r),e.dragMoveLocation=t.lngLat},dragVertex:function(e,t,r){const n=e.selectedCoordPaths.map(t=>e.feature.getCoordinate(t)),o=nt(n.map(e=>({type:O.FEATURE,properties:{},geometry:{type:O.POINT,coordinates:e}})),r);for(let t=0;t<n.length;t++){const r=n[t];e.feature.updateCoordinate(e.selectedCoordPaths[t],r[0]+o.lng,r[1]+o.lat)}},clickNoTarget:function(){this.changeMode(_.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(_.SIMPLE_SELECT)},clickActiveFeature:function(e){e.selectedCoordPaths=[],this.clearSelectedCoordinates(),e.feature.changed()},onSetup:function(e){const t=e.featureId,r=this.getFeature(t);if(!r)throw new Error("You must provide a featureId to enter direct_select mode");if(r.type===O.POINT)throw new TypeError("direct_select mode doesn't handle point features");const n={featureId:t,feature:r,dragMoveLocation:e.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:e.coordPath?[e.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(t,n.selectedCoordPaths)),this.setSelected(t),Ke.disable(this),this.setActionableState({trash:!0}),n},onStop:function(){Ke.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(e,t,r){e.featureId===t.properties.id?(t.properties.active=k.ACTIVE,r(t),We(t,{map:this.map,midpoints:!0,selectedPaths:e.selectedCoordPaths}).forEach(r)):(t.properties.active=k.INACTIVE,r(t)),this.fireActionable(e)},onTrash:function(e){e.selectedCoordPaths.sort((e,t)=>t.localeCompare(e,"en",{numeric:!0})).forEach(t=>e.feature.removeCoordinate(t)),this.fireUpdate(),e.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(e),!1===e.feature.isValid()&&(this.deleteFeature([e.featureId]),this.changeMode(_.SIMPLE_SELECT,{}))},onMouseMove:function(e,t){const r=Re(t),n=st(t),o=ct(t),i=0===e.selectedCoordPaths.length;return r&&i||n&&!i?this.updateUIClasses({mouse:T.MOVE}):this.updateUIClasses({mouse:T.NONE}),(n||r||o)&&e.dragMoving&&this.fireUpdate(),this.stopDragging(e),!0},onMouseOut:function(e){return e.dragMoving&&this.fireUpdate(),!0}};ut.onTouchStart=ut.onMouseDown=function(e,t){return st(t)?this.onVertex(e,t):Re(t)?this.onFeature(e,t):ct(t)?this.onMidpoint(e,t):void 0},ut.onDrag=function(e,t){if(!0!==e.canDragMove)return;e.dragMoving=!0,t.originalEvent.stopPropagation();const r={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};e.selectedCoordPaths.length>0?this.dragVertex(e,t,r):this.dragFeature(e,t,r),e.dragMoveLocation=t.lngLat},ut.onClick=function(e,t){return Ve(t)?this.clickNoTarget(e,t):Re(t)?this.clickActiveFeature(e,t):De(t)?this.clickInactive(e,t):void this.stopDragging(e)},ut.onTap=function(e,t){return Ve(t)?this.clickNoTarget(e,t):Re(t)?this.clickActiveFeature(e,t):De(t)?this.clickInactive(e,t):void 0},ut.onTouchEnd=ut.onMouseUp=function(e){e.dragMoving&&this.fireUpdate(),this.stopDragging(e)};const lt=ut,dt={onSetup:function(){const e=this.newFeature({type:O.FEATURE,properties:{},geometry:{type:O.POINT,coordinates:[]}});return this.addFeature(e),this.clearSelectedFeatures(),this.updateUIClasses({mouse:T.ADD}),this.activateUIButton(C.POINT),this.setActionableState({trash:!0}),{point:e}},stopDrawingAndRemove:function(e){this.deleteFeature([e.point.id],{silent:!0}),this.changeMode(_.SIMPLE_SELECT)}};dt.onTap=dt.onClick=function(e,t){this.updateUIClasses({mouse:T.MOVE}),e.point.updateCoordinate("",t.lngLat.lng,t.lngLat.lat),this.fire(L.CREATE,{features:[e.point.toGeoJSON()]}),this.changeMode(_.SIMPLE_SELECT,{featureIds:[e.point.id]})},dt.onStop=function(e){this.activateUIButton(),e.point.getCoordinate().length||this.deleteFeature([e.point.id],{silent:!0})},dt.toDisplayFeatures=function(e,t,r){const n=t.properties.id===e.point.id;if(t.properties.active=n?k.ACTIVE:k.INACTIVE,!n)return r(t)},dt.onTrash=dt.stopDrawingAndRemove,dt.onKeyUp=function(e,t){if(Ge(t)||Ye(t))return this.stopDrawingAndRemove(e,t)};const pt=dt,ht=function(e,t){return!!e.lngLat&&e.lngLat.lng===t[0]&&e.lngLat.lat===t[1]},ft={onSetup:function(){const e=this.newFeature({type:O.FEATURE,properties:{},geometry:{type:O.POLYGON,coordinates:[[]]}});return this.addFeature(e),this.clearSelectedFeatures(),Ke.disable(this),this.updateUIClasses({mouse:T.ADD}),this.activateUIButton(C.POLYGON),this.setActionableState({trash:!0}),{polygon:e,currentVertexPosition:0}},clickAnywhere:function(e,t){if(e.currentVertexPosition>0&&ht(t,e.polygon.coordinates[0][e.currentVertexPosition-1]))return this.changeMode(_.SIMPLE_SELECT,{featureIds:[e.polygon.id]});this.updateUIClasses({mouse:T.ADD}),e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat),e.currentVertexPosition++,e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat)},clickOnVertex:function(e){return this.changeMode(_.SIMPLE_SELECT,{featureIds:[e.polygon.id]})},onMouseMove:function(e,t){e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat),Ue(t)&&this.updateUIClasses({mouse:T.POINTER})}};ft.onTap=ft.onClick=function(e,t){return Ue(t)?this.clickOnVertex(e,t):this.clickAnywhere(e,t)},ft.onKeyUp=function(e,t){Ge(t)?(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(_.SIMPLE_SELECT)):Ye(t)&&this.changeMode(_.SIMPLE_SELECT,{featureIds:[e.polygon.id]})},ft.onStop=function(e){this.updateUIClasses({mouse:T.NONE}),Ke.enable(this),this.activateUIButton(),void 0!==this.getFeature(e.polygon.id)&&(e.polygon.removeCoordinate(`0.${e.currentVertexPosition}`),e.polygon.isValid()?this.fire(L.CREATE,{features:[e.polygon.toGeoJSON()]}):(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(_.SIMPLE_SELECT,{},{silent:!0})))},ft.toDisplayFeatures=function(e,t,r){const n=t.properties.id===e.polygon.id;if(t.properties.active=n?k.ACTIVE:k.INACTIVE,!n)return r(t);if(0===t.geometry.coordinates.length)return;const o=t.geometry.coordinates[0].length;if(!(o<3)){if(t.properties.meta=F.FEATURE,r($e(e.polygon.id,t.geometry.coordinates[0][0],"0.0",!1)),o>3){const n=t.geometry.coordinates[0].length-3;r($e(e.polygon.id,t.geometry.coordinates[0][n],`0.${n}`,!1))}if(o<=4){const e=[[t.geometry.coordinates[0][0][0],t.geometry.coordinates[0][0][1]],[t.geometry.coordinates[0][1][0],t.geometry.coordinates[0][1][1]]];if(r({type:O.FEATURE,properties:t.properties,geometry:{coordinates:e,type:O.LINE_STRING}}),3===o)return}return r(t)}},ft.onTrash=function(e){this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(_.SIMPLE_SELECT)};const gt=ft,yt={onSetup:function(e){const t=(e=e||{}).featureId;let r,n,o="forward";if(t){if(r=this.getFeature(t),!r)throw new Error("Could not find a feature with the provided featureId");let i=e.from;if(i&&"Feature"===i.type&&i.geometry&&"Point"===i.geometry.type&&(i=i.geometry),i&&"Point"===i.type&&i.coordinates&&2===i.coordinates.length&&(i=i.coordinates),!i||!Array.isArray(i))throw new Error("Please use the `from` property to indicate which point to continue the line from");const a=r.coordinates.length-1;if(r.coordinates[a][0]===i[0]&&r.coordinates[a][1]===i[1])n=a+1,r.addCoordinate(n,...r.coordinates[a]);else{if(r.coordinates[0][0]!==i[0]||r.coordinates[0][1]!==i[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");o="backwards",n=0,r.addCoordinate(n,...r.coordinates[0])}}else r=this.newFeature({type:O.FEATURE,properties:{},geometry:{type:O.LINE_STRING,coordinates:[]}}),n=0,this.addFeature(r);return this.clearSelectedFeatures(),Ke.disable(this),this.updateUIClasses({mouse:T.ADD}),this.activateUIButton(C.LINE),this.setActionableState({trash:!0}),{line:r,currentVertexPosition:n,direction:o}},clickAnywhere:function(e,t){if(e.currentVertexPosition>0&&ht(t,e.line.coordinates[e.currentVertexPosition-1])||"backwards"===e.direction&&ht(t,e.line.coordinates[e.currentVertexPosition+1]))return this.changeMode(_.SIMPLE_SELECT,{featureIds:[e.line.id]});this.updateUIClasses({mouse:T.ADD}),e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),"forward"===e.direction?(e.currentVertexPosition++,e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)):e.line.addCoordinate(0,t.lngLat.lng,t.lngLat.lat)},clickOnVertex:function(e){return this.changeMode(_.SIMPLE_SELECT,{featureIds:[e.line.id]})},onMouseMove:function(e,t){e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),Ue(t)&&this.updateUIClasses({mouse:T.POINTER})}};yt.onTap=yt.onClick=function(e,t){if(Ue(t))return this.clickOnVertex(e,t);this.clickAnywhere(e,t)},yt.onKeyUp=function(e,t){Ye(t)?this.changeMode(_.SIMPLE_SELECT,{featureIds:[e.line.id]}):Ge(t)&&(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(_.SIMPLE_SELECT))},yt.onStop=function(e){Ke.enable(this),this.activateUIButton(),void 0!==this.getFeature(e.line.id)&&(e.line.removeCoordinate(`${e.currentVertexPosition}`),e.line.isValid()?this.fire(L.CREATE,{features:[e.line.toGeoJSON()]}):(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(_.SIMPLE_SELECT,{},{silent:!0})))},yt.onTrash=function(e){this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(_.SIMPLE_SELECT)},yt.toDisplayFeatures=function(e,t,r){const n=t.properties.id===e.line.id;if(t.properties.active=n?k.ACTIVE:k.INACTIVE,!n)return r(t);t.geometry.coordinates.length<2||(t.properties.meta=F.FEATURE,r($e(e.line.id,t.geometry.coordinates["forward"===e.direction?t.geometry.coordinates.length-2:1],""+("forward"===e.direction?t.geometry.coordinates.length-2:1),!1)),r(t))};const mt={simple_select:at,direct_select:lt,draw_point:pt,draw_polygon:gt,draw_line_string:yt},vt={defaultMode:_.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:Fe,modes:mt,controls:{},userProperties:!1,suppressAPIEvents:!0},bt={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},Et={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function wt(e,t){return e.map(e=>e.source?e:Object.assign({},e,{id:`${e.id}.${t}`,source:"hot"===t?I.HOT:I.COLD}))}var St=r(17),xt=r(186);function Mt(e,t){return e.length===t.length&&JSON.stringify(e.map(e=>e).sort())===JSON.stringify(t.map(e=>e).sort())}const Pt={Polygon:ge,LineString:he,Point:de,MultiPolygon:be,MultiLineString:be,MultiPoint:be};function It(e){!function(e,t){const r={options:e=function(e={}){let t=Object.assign({},e);return e.controls||(t.controls={}),!1===e.displayControlsDefault?t.controls=Object.assign({},Et,e.controls):t.controls=Object.assign({},bt,e.controls),t=Object.assign({},vt,t),t.styles=wt(t.styles,"cold").concat(wt(t.styles,"hot")),t}(e)};t=function(e,t){t.modes=_;const r=void 0===e.options.suppressAPIEvents||!!e.options.suppressAPIEvents;return t.getFeatureIdsAt=function(t){return W.click({point:t},null,e).map(e=>e.properties.id)},t.getSelectedIds=function(){return e.store.getSelectedIds()},t.getSelected=function(){return{type:O.FEATURE_COLLECTION,features:e.store.getSelectedIds().map(t=>e.store.get(t)).map(e=>e.toGeoJSON())}},t.getSelectedPoints=function(){return{type:O.FEATURE_COLLECTION,features:e.store.getSelectedCoordinates().map(e=>({type:O.FEATURE,properties:{},geometry:{type:O.POINT,coordinates:e.coordinates}}))}},t.set=function(r){if(void 0===r.type||r.type!==O.FEATURE_COLLECTION||!Array.isArray(r.features))throw new Error("Invalid FeatureCollection");const n=e.store.createRenderBatch();let o=e.store.getAllIds().slice();const i=t.add(r),a=new $(i);return o=o.filter(e=>!a.has(e)),o.length&&t.delete(o),n(),i},t.add=function(t){const n=JSON.parse(JSON.stringify(xt(t))).features.map(t=>{if(t.id=t.id||se(),null===t.geometry)throw new Error("Invalid geometry: null");if(void 0===e.store.get(t.id)||e.store.get(t.id).type!==t.geometry.type){const n=Pt[t.geometry.type];if(void 0===n)throw new Error(`Invalid geometry type: ${t.geometry.type}.`);const o=new n(e,t);e.store.add(o,{silent:r})}else{const n=e.store.get(t.id),o=n.properties;n.properties=t.properties,St(o,t.properties)||e.store.featureChanged(n.id,{silent:r}),St(n.getCoordinates(),t.geometry.coordinates)||n.incomingCoords(t.geometry.coordinates)}return t.id});return e.store.render(),n},t.get=function(t){const r=e.store.get(t);if(r)return r.toGeoJSON()},t.getAll=function(){return{type:O.FEATURE_COLLECTION,features:e.store.getAll().map(e=>e.toGeoJSON())}},t.delete=function(n){return e.store.delete(n,{silent:r}),t.getMode()!==_.DIRECT_SELECT||e.store.getSelectedIds().length?e.store.render():e.events.changeMode(_.SIMPLE_SELECT,void 0,{silent:r}),t},t.deleteAll=function(){return e.store.delete(e.store.getAllIds(),{silent:r}),t.getMode()===_.DIRECT_SELECT?e.events.changeMode(_.SIMPLE_SELECT,void 0,{silent:r}):e.store.render(),t},t.changeMode=function(n,o={}){return n===_.SIMPLE_SELECT&&t.getMode()===_.SIMPLE_SELECT?(Mt(o.featureIds||[],e.store.getSelectedIds())||(e.store.setSelected(o.featureIds,{silent:r}),e.store.render()),t):(n===_.DIRECT_SELECT&&t.getMode()===_.DIRECT_SELECT&&o.featureId===e.store.getSelectedIds()[0]||e.events.changeMode(n,o,{silent:r}),t)},t.getMode=function(){return e.events.getMode()},t.trash=function(){return e.events.trash({silent:r}),t},t.combineFeatures=function(){return e.events.combineFeatures({silent:r}),t},t.uncombineFeatures=function(){return e.events.uncombineFeatures({silent:r}),t},t.setFeatureProperty=function(n,o,i){return e.store.setFeatureProperty(n,o,i,{silent:r}),t},t}(r,t),r.api=t;const n=Oe(r);t.onAdd=n.onAdd,t.onRemove=n.onRemove,t.types=C,t.options=e}(e,this)}It.modes=mt,It.constants=n,It.lib=i;const Tt=It;var Ct={onSetup:function(){return{}},onClick:function(){return!1},onKeyUp:function(){return!1},onDrag:function(){return!1},toDisplayFeatures:function(e,t,r){t.properties.active="false",r(t)}};function Ot(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return[...e.geometry.coordinates];if("Point"===e.type)return[...e.coordinates]}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return[...e];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function _t(e){return"Feature"===e.type?e.geometry:e}function Lt(e,t,r={}){const n={type:"Feature"};return(0===r.id||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=t||{},n.geometry=e,n}function At(e,t,r={}){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Rt(e[0])||!Rt(e[1]))throw new Error("coordinates must contain numbers");return Lt({type:"Point",coordinates:e},t,r)}function Ft(e,t,r={}){for(const t of e){if(t.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(t[t.length-1].length!==t[0].length)throw new Error("First and last Position are not equivalent.");for(let e=0;e<t[t.length-1].length;e++)if(t[t.length-1][e]!==t[0][e])throw new Error("First and last Position are not equivalent.")}return Lt({type:"Polygon",coordinates:e},t,r)}function kt(e,t,r={}){if(e.length<2)throw new Error("coordinates must be an array of two or more positions");return Lt({type:"LineString",coordinates:e},t,r)}function Nt(e,t={}){const r={type:"FeatureCollection"};return t.id&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.features=e,r}function Rt(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}Math.PI;const Dt=11102230246251565e-32,Vt=134217729,jt=(3+8*Dt)*Dt;function Ut(e,t,r,n,o){let i,a,s,c,u=t[0],l=n[0],d=0,p=0;l>u==l>-u?(i=u,u=t[++d]):(i=l,l=n[++p]);let h=0;if(d<e&&p<r)for(l>u==l>-u?(a=u+i,s=i-(a-u),u=t[++d]):(a=l+i,s=i-(a-l),l=n[++p]),i=a,0!==s&&(o[h++]=s);d<e&&p<r;)l>u==l>-u?(a=i+u,c=a-i,s=i-(a-c)+(u-c),u=t[++d]):(a=i+l,c=a-i,s=i-(a-c)+(l-c),l=n[++p]),i=a,0!==s&&(o[h++]=s);for(;d<e;)a=i+u,c=a-i,s=i-(a-c)+(u-c),u=t[++d],i=a,0!==s&&(o[h++]=s);for(;p<r;)a=i+l,c=a-i,s=i-(a-c)+(l-c),l=n[++p],i=a,0!==s&&(o[h++]=s);return 0===i&&0!==h||(o[h++]=i),h}function Bt(e){return new Float64Array(e)}const Gt=Bt(4),Yt=Bt(8),Xt=Bt(12),qt=Bt(16),Jt=Bt(4);function $t(e,t,r,n,o,i){const a=(t-i)*(r-o),s=(e-o)*(n-i),c=a-s,u=Math.abs(a+s);return Math.abs(c)>=33306690738754716e-32*u?c:-function(e,t,r,n,o,i,a){let s,c,u,l,d,p,h,f,g,y,m,v,b,E,w,S,x,M;const P=e-o,I=r-o,T=t-i,C=n-i;E=P*C,p=Vt*P,h=p-(p-P),f=P-h,p=Vt*C,g=p-(p-C),y=C-g,w=f*y-(E-h*g-f*g-h*y),S=T*I,p=Vt*T,h=p-(p-T),f=T-h,p=Vt*I,g=p-(p-I),y=I-g,x=f*y-(S-h*g-f*g-h*y),m=w-x,d=w-m,Gt[0]=w-(m+d)+(d-x),v=E+m,d=v-E,b=E-(v-d)+(m-d),m=b-S,d=b-m,Gt[1]=b-(m+d)+(d-S),M=v+m,d=M-v,Gt[2]=v-(M-d)+(m-d),Gt[3]=M;let O=function(e,t){let r=t[0];for(let e=1;e<4;e++)r+=t[e];return r}(0,Gt),_=22204460492503146e-32*a;if(O>=_||-O>=_)return O;if(d=e-P,s=e-(P+d)+(d-o),d=r-I,u=r-(I+d)+(d-o),d=t-T,c=t-(T+d)+(d-i),d=n-C,l=n-(C+d)+(d-i),0===s&&0===c&&0===u&&0===l)return O;if(_=11093356479670487e-47*a+jt*Math.abs(O),O+=P*l+C*s-(T*u+I*c),O>=_||-O>=_)return O;E=s*C,p=Vt*s,h=p-(p-s),f=s-h,p=Vt*C,g=p-(p-C),y=C-g,w=f*y-(E-h*g-f*g-h*y),S=c*I,p=Vt*c,h=p-(p-c),f=c-h,p=Vt*I,g=p-(p-I),y=I-g,x=f*y-(S-h*g-f*g-h*y),m=w-x,d=w-m,Jt[0]=w-(m+d)+(d-x),v=E+m,d=v-E,b=E-(v-d)+(m-d),m=b-S,d=b-m,Jt[1]=b-(m+d)+(d-S),M=v+m,d=M-v,Jt[2]=v-(M-d)+(m-d),Jt[3]=M;const L=Ut(4,Gt,4,Jt,Yt);E=P*l,p=Vt*P,h=p-(p-P),f=P-h,p=Vt*l,g=p-(p-l),y=l-g,w=f*y-(E-h*g-f*g-h*y),S=T*u,p=Vt*T,h=p-(p-T),f=T-h,p=Vt*u,g=p-(p-u),y=u-g,x=f*y-(S-h*g-f*g-h*y),m=w-x,d=w-m,Jt[0]=w-(m+d)+(d-x),v=E+m,d=v-E,b=E-(v-d)+(m-d),m=b-S,d=b-m,Jt[1]=b-(m+d)+(d-S),M=v+m,d=M-v,Jt[2]=v-(M-d)+(m-d),Jt[3]=M;const A=Ut(L,Yt,4,Jt,Xt);E=s*l,p=Vt*s,h=p-(p-s),f=s-h,p=Vt*l,g=p-(p-l),y=l-g,w=f*y-(E-h*g-f*g-h*y),S=c*u,p=Vt*c,h=p-(p-c),f=c-h,p=Vt*u,g=p-(p-u),y=u-g,x=f*y-(S-h*g-f*g-h*y),m=w-x,d=w-m,Jt[0]=w-(m+d)+(d-x),v=E+m,d=v-E,b=E-(v-d)+(m-d),m=b-S,d=b-m,Jt[1]=b-(m+d)+(d-S),M=v+m,d=M-v,Jt[2]=v-(M-d)+(m-d),Jt[3]=M;const F=Ut(A,Xt,4,Jt,qt);return qt[F-1]}(e,t,r,n,o,i,u)}function Ht(e,t){var r,n,o,i,a,s,c,u,l,d=0,p=e[0],h=e[1],f=t.length;for(r=0;r<f;r++){n=0;var g=t[r],y=g.length-1;if((u=g[0])[0]!==g[y][0]&&u[1]!==g[y][1])throw new Error("First and last coordinates in a ring must be the same");for(i=u[0]-p,a=u[1]-h;n<y;n++){if(s=(l=g[n+1])[0]-p,c=l[1]-h,0===a&&0===c){if(s<=0&&i>=0||i<=0&&s>=0)return 0}else if(c>=0&&a<=0||c<=0&&a>=0){if(0===(o=$t(i,s,a,c,0,0)))return 0;(o>0&&c>0&&a<=0||o<0&&c<=0&&a>0)&&d++}u=l,a=c,i=s}}return d%2!=0}function Wt(e,t,r={}){if(!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");const n=Ot(e),o=_t(t),i=o.type,a=t.bbox;let s=o.coordinates;if(a&&!1===function(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}(n,a))return!1;"Polygon"===i&&(s=[s]);let c=!1;for(var u=0;u<s.length;++u){const e=Ht(n,s[u]);if(0===e)return!r.ignoreBoundary;e&&(c=!0)}return c}Bt(4),Bt(4),Bt(4),Bt(4),Bt(4),Bt(4),Bt(4),Bt(4),Bt(4),Bt(8),Bt(8),Bt(8),Bt(4),Bt(8),Bt(8),Bt(8),Bt(12),Bt(192),Bt(192),Bt(4),Bt(4),Bt(4),Bt(4),Bt(4),Bt(4),Bt(4),Bt(4),Bt(8),Bt(8),Bt(8),Bt(8),Bt(8),Bt(8),Bt(8),Bt(8),Bt(8),Bt(4),Bt(4),Bt(4),Bt(8),Bt(16),Bt(16),Bt(16),Bt(32),Bt(32),Bt(48),Bt(64),Bt(1152),Bt(1152),Bt(4),Bt(4),Bt(4),Bt(4),Bt(4),Bt(4),Bt(4),Bt(4),Bt(4),Bt(4),Bt(24),Bt(24),Bt(24),Bt(24),Bt(24),Bt(24),Bt(24),Bt(24),Bt(24),Bt(24),Bt(1152),Bt(1152),Bt(1152),Bt(1152),Bt(1152),Bt(2304),Bt(2304),Bt(3456),Bt(5760),Bt(8),Bt(8),Bt(8),Bt(16),Bt(24),Bt(48),Bt(48),Bt(96),Bt(192),Bt(384),Bt(384),Bt(384),Bt(768),Bt(96),Bt(96),Bt(96),Bt(1152);class Kt{constructor(e=[],t=Zt){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:r}=this,n=t[e];for(;e>0;){const o=e-1>>1,i=t[o];if(r(n,i)>=0)break;t[e]=i,e=o}t[e]=n}_down(e){const{data:t,compare:r}=this,n=this.length>>1,o=t[e];for(;e<n;){let n=1+(e<<1),i=t[n];const a=n+1;if(a<this.length&&r(t[a],i)<0&&(n=a,i=t[a]),r(i,o)>=0)break;t[e]=i,e=n}t[e]=o}}function Zt(e,t){return e<t?-1:e>t?1:0}function zt(e,t){return e.p.x>t.p.x?1:e.p.x<t.p.x?-1:e.p.y!==t.p.y?e.p.y>t.p.y?1:-1:1}function Qt(e,t){return e.rightSweepEvent.p.x>t.rightSweepEvent.p.x?1:e.rightSweepEvent.p.x<t.rightSweepEvent.p.x?-1:e.rightSweepEvent.p.y!==t.rightSweepEvent.p.y?e.rightSweepEvent.p.y<t.rightSweepEvent.p.y?1:-1:1}class er{constructor(e,t,r,n){this.p={x:e[0],y:e[1]},this.featureId=t,this.ringId=r,this.eventId=n,this.otherEvent=null,this.isLeftEndpoint=null}isSamePoint(e){return this.p.x===e.p.x&&this.p.y===e.p.y}}let tr=0,rr=0,nr=0;function or(e,t){const r="Feature"===e.type?e.geometry:e;let n=r.coordinates;"Polygon"!==r.type&&"MultiLineString"!==r.type||(n=[n]),"LineString"===r.type&&(n=[[n]]);for(let e=0;e<n.length;e++)for(let r=0;r<n[e].length;r++){let o=n[e][r][0],i=null;rr+=1;for(let a=0;a<n[e][r].length-1;a++){i=n[e][r][a+1];const s=new er(o,tr,rr,nr),c=new er(i,tr,rr,nr+1);s.otherEvent=c,c.otherEvent=s,zt(s,c)>0?(c.isLeftEndpoint=!0,s.isLeftEndpoint=!1):(s.isLeftEndpoint=!0,c.isLeftEndpoint=!1),t.push(s),t.push(c),o=i,nr+=1}}tr+=1}class ir{constructor(e){this.leftSweepEvent=e,this.rightSweepEvent=e.otherEvent}}function ar(e,t){if(null===e||null===t)return!1;if(e.leftSweepEvent.ringId===t.leftSweepEvent.ringId&&(e.rightSweepEvent.isSamePoint(t.leftSweepEvent)||e.rightSweepEvent.isSamePoint(t.leftSweepEvent)||e.rightSweepEvent.isSamePoint(t.rightSweepEvent)||e.leftSweepEvent.isSamePoint(t.leftSweepEvent)||e.leftSweepEvent.isSamePoint(t.rightSweepEvent)))return!1;const r=e.leftSweepEvent.p.x,n=e.leftSweepEvent.p.y,o=e.rightSweepEvent.p.x,i=e.rightSweepEvent.p.y,a=t.leftSweepEvent.p.x,s=t.leftSweepEvent.p.y,c=t.rightSweepEvent.p.x,u=t.rightSweepEvent.p.y,l=(u-s)*(o-r)-(c-a)*(i-n);if(0===l)return!1;const d=((c-a)*(n-s)-(u-s)*(r-a))/l,p=((o-r)*(n-s)-(i-n)*(r-a))/l;return d>=0&&d<=1&&p>=0&&p<=1&&[r+d*(o-r),n+d*(i-n)]}function sr(e,t,r={}){const{removeDuplicates:n=!0,ignoreSelfIntersections:o=!0}=r;let i=[];"FeatureCollection"===e.type?i=i.concat(e.features):"Feature"===e.type?i.push(e):"LineString"!==e.type&&"Polygon"!==e.type&&"MultiLineString"!==e.type&&"MultiPolygon"!==e.type||i.push(Lt(e)),"FeatureCollection"===t.type?i=i.concat(t.features):"Feature"===t.type?i.push(t):"LineString"!==t.type&&"Polygon"!==t.type&&"MultiLineString"!==t.type&&"MultiPolygon"!==t.type||i.push(Lt(t));const a=function(e,t){const r=new Kt([],zt);return function(e,t){if("FeatureCollection"===e.type){const r=e.features;for(let e=0;e<r.length;e++)or(r[e],t)}else or(e,t)}(e,r),function(e,t){t=t||!1;const r=[],n=new Kt([],Qt);for(;e.length;){const o=e.pop();if(o.isLeftEndpoint){const e=new ir(o);for(let i=0;i<n.data.length;i++){const a=n.data[i];if(t&&a.leftSweepEvent.featureId===o.featureId)continue;const s=ar(e,a);!1!==s&&r.push(s)}n.push(e)}else!1===o.isLeftEndpoint&&n.pop()}return r}(r,t)}(Nt(i),o);let s=[];if(n){const e={};a.forEach(t=>{const r=t.join(",");e[r]||(e[r]=!0,s.push(t))})}else s=a;return Nt(s.map(e=>At(e)))}function cr(e,t){var r,n,o,i,a,s,c,u,l,d,p=0,h="FeatureCollection"===e.type,f="Feature"===e.type,g=h?e.features.length:1;for(r=0;r<g;r++){for(s=h?e.features[r].geometry:f?e.geometry:e,u=h?e.features[r].properties:f?e.properties:{},l=h?e.features[r].bbox:f?e.bbox:void 0,d=h?e.features[r].id:f?e.id:void 0,a=(c=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,o=0;o<a;o++)if(null!==(i=c?s.geometries[o]:s))switch(i.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(i,p,u,l,d))return!1;break;case"GeometryCollection":for(n=0;n<i.geometries.length;n++)if(!1===t(i.geometries[n],p,u,l,d))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,p,u,l,d))return!1;p++}}function ur(e,t){cr(e,function(e,r,n,o,i){var a,s=null===e?null:e.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return!1!==t(Lt(e,n,{bbox:o,id:i}),r,0)&&void 0}switch(s){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon"}for(var c=0;c<e.coordinates.length;c++){var u=e.coordinates[c];if(!1===t(Lt({type:a,coordinates:u},n),r,c))return!1}})}function lr(e,t={}){const r=_t(e);switch(t.properties||"Feature"!==e.type||(t.properties=e.properties),r.type){case"Polygon":return function(e,t={}){return dr(_t(e).coordinates,t.properties?t.properties:"Feature"===e.type?e.properties:{})}(r,t);case"MultiPolygon":return function(e,t={}){const r=_t(e).coordinates,n=t.properties?t.properties:"Feature"===e.type?e.properties:{},o=[];return r.forEach(e=>{o.push(dr(e,n))}),Nt(o)}(r,t);default:throw new Error("invalid poly")}}function dr(e,t){return e.length>1?function(e,t,r={}){return Lt({type:"MultiLineString",coordinates:e},t,r)}(e,t):kt(e[0],t)}function pr(e,t,{ignoreSelfIntersections:r=!0}={ignoreSelfIntersections:!0}){let n=!0;return ur(e,e=>{ur(t,t=>{if(!1===n)return!1;n=function(e,t,r){switch(e.type){case"Point":switch(t.type){case"Point":return n=e.coordinates,o=t.coordinates,!(n[0]===o[0]&&n[1]===o[1]);case"LineString":return!hr(t,e);case"Polygon":return!Wt(e,t)}break;case"LineString":switch(t.type){case"Point":return!hr(e,t);case"LineString":return!function(e,t,r){return sr(e,t,{ignoreSelfIntersections:r}).features.length>0}(e,t,r);case"Polygon":return!fr(t,e,r)}break;case"Polygon":switch(t.type){case"Point":return!Wt(t,e);case"LineString":return!fr(e,t,r);case"Polygon":return!function(e,t,r){for(const r of e.coordinates[0])if(Wt(r,t))return!0;for(const r of t.coordinates[0])if(Wt(r,e))return!0;return sr(lr(e),lr(t),{ignoreSelfIntersections:r}).features.length>0}(t,e,r)}}var n,o;return!1}(e.geometry,t.geometry,r)})}),n}function hr(e,t){for(let r=0;r<e.coordinates.length-1;r++)if(gr(e.coordinates[r],e.coordinates[r+1],t.coordinates))return!0;return!1}function fr(e,t,r){for(const r of t.coordinates)if(Wt(r,e))return!0;return sr(t,lr(e),{ignoreSelfIntersections:r}).features.length>0}function gr(e,t,r){const n=r[0]-e[0],o=r[1]-e[1],i=t[0]-e[0],a=t[1]-e[1];return 0===n*a-o*i&&(Math.abs(i)>=Math.abs(a)?i>0?e[0]<=r[0]&&r[0]<=t[0]:t[0]<=r[0]&&r[0]<=e[0]:a>0?e[1]<=r[1]&&r[1]<=t[1]:t[1]<=r[1]&&r[1]<=e[1])}function yr(e,t){var r=_t(e),n=_t(t),o=r.type,i=n.type;switch(o){case"MultiPoint":switch(i){case"LineString":return mr(r,n);case"Polygon":return br(r,n);default:throw new Error("feature2 "+i+" geometry not supported")}case"LineString":switch(i){case"MultiPoint":return mr(n,r);case"LineString":return function(e,t){if(sr(e,t).features.length>0)for(var r=0;r<e.coordinates.length-1;r++)for(var n=0;n<t.coordinates.length-1;n++){var o=!0;if(0!==n&&n!==t.coordinates.length-2||(o=!1),Er(e.coordinates[r],e.coordinates[r+1],t.coordinates[n],o))return!0}return!1}(r,n);case"Polygon":return vr(r,n);default:throw new Error("feature2 "+i+" geometry not supported")}case"Polygon":switch(i){case"MultiPoint":return br(n,r);case"LineString":return vr(n,r);default:throw new Error("feature2 "+i+" geometry not supported")}default:throw new Error("feature1 "+o+" geometry not supported")}}function mr(e,t){for(var r=!1,n=!1,o=e.coordinates.length,i=0;i<o&&!r&&!n;){for(var a=0;a<t.coordinates.length-1;a++){var s=!0;0!==a&&a!==t.coordinates.length-2||(s=!1),Er(t.coordinates[a],t.coordinates[a+1],e.coordinates[i],s)?r=!0:n=!0}i++}return r&&n}function vr(e,t){return sr(e,lr(t)).features.length>0}function br(e,t){var r=!1,n=!1,o=e.coordinates.length;for(let i=0;i<o&&(!r||!n);i++)Wt(At(e.coordinates[i]),t)?r=!0:n=!0;return n&&r}function Er(e,t,r,n){var o=r[0]-e[0],i=r[1]-e[1],a=t[0]-e[0],s=t[1]-e[1];return 0===o*s-i*a&&(n?Math.abs(a)>=Math.abs(s)?a>0?e[0]<=r[0]&&r[0]<=t[0]:t[0]<=r[0]&&r[0]<=e[0]:s>0?e[1]<=r[1]&&r[1]<=t[1]:t[1]<=r[1]&&r[1]<=e[1]:Math.abs(a)>=Math.abs(s)?a>0?e[0]<r[0]&&r[0]<t[0]:t[0]<r[0]&&r[0]<e[0]:s>0?e[1]<r[1]&&r[1]<t[1]:t[1]<r[1]&&r[1]<e[1])}function wr(e,t,r={}){const n=Ot(e),o=function(e){if(Array.isArray(e))return e;if("Feature"===e.type){if(null!==e.geometry)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}(t);for(let e=0;e<o.length-1;e++){let t=!1;if(r.ignoreEndVertices&&(0===e&&(t="start"),e===o.length-2&&(t="end"),0===e&&e+1===o.length-1&&(t="both")),Sr(o[e],o[e+1],n,t,void 0===r.epsilon?null:r.epsilon))return!0}return!1}function Sr(e,t,r,n,o){const i=r[0],a=r[1],s=e[0],c=e[1],u=t[0],l=t[1],d=u-s,p=l-c,h=(r[0]-s)*p-(r[1]-c)*d;if(null!==o){if(Math.abs(h)>o)return!1}else if(0!==h)return!1;return Math.abs(d)===Math.abs(p)&&0===Math.abs(d)?!n&&r[0]===e[0]&&r[1]===e[1]:n?"start"===n?Math.abs(d)>=Math.abs(p)?d>0?s<i&&i<=u:u<=i&&i<s:p>0?c<a&&a<=l:l<=a&&a<c:"end"===n?Math.abs(d)>=Math.abs(p)?d>0?s<=i&&i<u:u<i&&i<=s:p>0?c<=a&&a<l:l<a&&a<=c:"both"===n&&(Math.abs(d)>=Math.abs(p)?d>0?s<i&&i<u:u<i&&i<s:p>0?c<a&&a<l:l<a&&a<c):Math.abs(d)>=Math.abs(p)?d>0?s<=i&&i<=u:u<=i&&i<=s:p>0?c<=a&&a<=l:l<=a&&a<=c}function xr(e){return e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]}function Mr(e){for(var t=0;t<e.length-1;t++)for(var r=e[t],n=t+1;n<e.length-2;n++)if(wr(r,kt([e[n],e[n+1]])))return!0;return!1}function Pr(e,t,r){for(var n=Ft(e),o=r+1;o<t.length;o++)if(!pr(n,Ft(t[o]))&&yr(n,kt(t[o][0])))return!1;return!0}function Ir(e){let t=0;if(e&&e.length>0){t+=Math.abs(Or(e[0]));for(let r=1;r<e.length;r++)t-=Math.abs(Or(e[r]))}return t}var Tr=20294876564838.72,Cr=Math.PI/180;function Or(e){const t=e.length-1;if(t<=2)return 0;let r=0,n=0;for(;n<t;){const o=e[n],i=e[n+1===t?0:n+1],a=e[n+2>=t?(n+2)%t:n+2],s=o[0]*Cr,c=i[1]*Cr;r+=(a[0]*Cr-s)*Math.sin(c),n++}return r*Tr}var _r=function(e){return function(e){var t=0;return cr(e,function(e,r,n,o,i){t=t+function(e){let t,r=0;switch(e.type){case"Polygon":return Ir(e.coordinates);case"MultiPolygon":for(t=0;t<e.coordinates.length;t++)r+=Ir(e.coordinates[t]);return r;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}(e)}),t}(e)};function Lr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,s=[],c=!0,u=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||Ar(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ar(e,t){if(e){if("string"==typeof e)return Fr(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Fr(e,t):void 0}}function Fr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var kr=function(e,t){var r=Lr(e,2),n=r[0],o=r[1],i=Lr(t,2),a=i[0],s=i[1],c=function(e){return e*Math.PI/180},u=c(s-o),l=c(a-n),d=Math.pow(Math.sin(u/2),2)+Math.cos(c(o))*Math.cos(c(s))*Math.pow(Math.sin(l/2),2);return 12742e3*Math.atan2(Math.sqrt(d),Math.sqrt(1-d))},Nr=function(e){if(e[0].length<=1||function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01;if(e[0].length<=1)return!0;if(e[0].length<=3)for(var r=0;r<e[0].length;r++)for(var n=r+1;n<e[0].length;n++)if(kr(e[0][r],e[0][n])<t)return!1;return!0}(e))return!0;if(!Array.isArray(e)||e.length<4)return!1;var t=e[0],r=e[e.length-1];if(t[0]!==r[0]||t[1]!==r[1])return!1;var n=Ft([e]);return!(!function(e){if(!e.type)return!1;const t=_t(e),r=t.type,n=t.coordinates;switch(r){case"Point":return n.length>1;case"MultiPoint":for(var o=0;o<n.length;o++)if(n[o].length<2)return!1;return!0;case"LineString":if(n.length<2)return!1;for(o=0;o<n.length;o++)if(n[o].length<2)return!1;return!0;case"MultiLineString":if(n.length<2)return!1;for(o=0;o<n.length;o++)if(n[o].length<2)return!1;return!0;case"Polygon":for(o=0;o<t.coordinates.length;o++){if(n[o].length<4)return!1;if(!xr(n[o]))return!1;if(Mr(n[o]))return!1;if(o>0&&sr(Ft([n[0]]),Ft([n[o]])).features.length>1)return!1}return!0;case"MultiPolygon":for(o=0;o<t.coordinates.length;o++)for(var i=t.coordinates[o],a=0;a<i.length;a++){if(i[a].length<4)return!1;if(!xr(i[a]))return!1;if(Mr(i[a]))return!1;if(0===a&&!Pr(i,t.coordinates,o))return!1;if(a>0&&sr(Ft([i[0]]),Ft([i[a]])).features.length>1)return!1}return!0;default:return!1}}(n)||_r(n)<=0)},Rr=function(e,t,r){var n=t.filter(function(t,n){var o=Math.abs(t[0]-e[0]),i=Math.abs(t[1]-e[1]);return("ArrowUp"===r?t[1]<=e[1]&&i>=o:"ArrowDown"===r?t[1]>e[1]&&i>=o:"ArrowLeft"===r?t[0]<=e[0]&&i<o:"ArrowRight"!==r||t[0]>e[0]&&i<o)&&JSON.stringify(t)!==JSON.stringify(e)});n.length||n.push(e);var o,i=n.map(function(t){return r=Math.abs(e[0]-t[0]),n=Math.abs(e[1]-t[1]),Math.sqrt(Math.pow(r,2)+Math.pow(n,2));var r,n}),a=n[i.indexOf(Math.min.apply(Math,(o=i,function(e){if(Array.isArray(e))return Fr(e)}(o)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(o)||Ar(o)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())))];return t.findIndex(function(e){return JSON.stringify(e)===JSON.stringify(a)})};function Dr(e){return Dr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Dr(e)}function Vr(e){return function(e){if(Array.isArray(e))return Br(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Ur(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function jr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,s=[],c=!0,u=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||Ur(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ur(e,t){if(e){if("string"==typeof e)return Br(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Br(e,t):void 0}}function Br(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function Gr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Yr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Gr(Object(r),!0).forEach(function(t){Xr(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Gr(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function Xr(e,t,r){return(t=function(e){var t=function(e){if("object"!=Dr(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=Dr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Dr(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var qr=["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"],Jr=function(e,t){return Object.keys(e).reduce(function(r,n){return r[n]=e[n]*t,r},{})},$r=Yr(Yr({},lt),{},{onSetup:function(e){var t=lt.onSetup.call(this,e),r=e.container,n=e.featureId,o=e.selectedVertexIndex,i=e.selectedVertexType,a=e.isPanEnabled,s=e.getSnapEnabled,c=e.deleteVertexButtonId,u=e.interfaceType,l=e.scale;return Object.assign(t,{container:r,interfaceType:u,deleteVertexButtonId:c,isPanEnabled:a,getSnapEnabled:s,featureId:t.featureId||n,selectedVertexIndex:null!=o?o:-1,selectedVertexType:i,scale:l}),t.vertecies=this.getVerticies(t.featureId),t.midpoints=this.getMidpoints(t.featureId),this.setupEventListeners(t),"midpoint"===i&&this.updateMidpoint(t.midpoints[o-t.vertecies.length]),this.addTouchVertexTarget(t),t},setupEventListeners:function(e){var t=this,r=function(r){return function(n){return r.call(t,e,n)}};this.handlers={keydown:r(this.onKeydown),keyup:r(this.onKeyup),pointerdown:r(this.onPointerevent),pointermove:r(this.onPointerevent),pointerup:r(this.onPointerevent),click:r(this.onVertexButtonClick),touchstart:r(this.onTouchstart),touchmove:r(this.onTouchmove),touchend:r(this.onTouchend),selectionchange:r(this.onSelectionChange),scalechange:r(this.onScaleChange),update:r(this.onUpdate),move:r(this.onMove)};var n=this.handlers;window.addEventListener("keydown",n.keydown,{capture:!0}),window.addEventListener("keyup",n.keyup,{capture:!0}),window.addEventListener("click",n.click),e.container.addEventListener("pointerdown",n.pointerdown),e.container.addEventListener("pointermove",n.pointermove),e.container.addEventListener("pointerup",n.pointerup),e.container.addEventListener("touchstart",n.touchstart,{passive:!1}),e.container.addEventListener("touchmove",n.touchmove,{passive:!1}),e.container.addEventListener("touchend",n.touchend,{passive:!1}),this.map.on("draw.selectionchange",n.selectionchange),this.map.on("draw.scalechange",n.scalechange),this.map.on("draw.update",n.update),this.map.on("move",n.move)},onSelectionChange:function(e,t){var r,n,o=e.interfaceType,i=null===(r=t.points[t.points.length-1])||void 0===r?void 0:r.geometry.coordinates,a=t.features[0].geometry.coordinates.flat(1).findIndex(function(e){return i&&e[0]===i[0]&&e[1]===i[1]});e.selectedVertexIndex="keyboard"===o?e.selectedVertexIndex:a,null!==(n=e.selectedVertexType)&&void 0!==n||(e.selectedVertexType=a>=0?"vertex":null),this.map.fire("draw.vertexselection",{index:"vertex"===e.selectedVertexType?e.selectedVertexIndex:-1,numVertecies:e.vertecies.length});var s=i?Jr(this.map.project(i),e.scale):null;this.updateTouchVertexTarget(e,s)},onScaleChange:function(e,t){e.scale=t.scale},onUpdate:function(e,t){var r,n=e.vertecies.length,o=new Set(e.vertecies.map(function(e){return JSON.stringify(e)}));n!==e.vertecies.length&&(e.selectedVertexIndex=e.vertecies.findIndex(function(e){return!o.has(JSON.stringify(e))}),null!==(r=e.selectedVertexType)&&void 0!==r||(e.selectedVertexType=e.selectedVertexIndex>=0?"vertex":null))},onKeydown:function(e,t){if(e.interfaceType="keyboard",this.hideTouchVertexIndicator(e)," "===t.key&&e.selectedVertexIndex<0)return e.isPanEnabled=!1,this.updateVertex(e);if(!t.altKey&&qr.includes(t.key)&&e.selectedVertexIndex>=0){if(t.preventDefault(),t.stopPropagation(),"midpoint"===e.selectedVertexType)return this.insertVertex(e,t);var r=y(this.map),n=this.getFeature(e.featureId).coordinates.flat(1)[e.selectedVertexIndex];if(S(e)&&e._isSnapped&&r){var o=function(e){var t,r;return null!==(t=null==e||null===(r=e.options)||void 0===r?void 0:r.radius)&&void 0!==t?t:15}(r),i=this.map.project(n),a=o+1,s=jr({ArrowUp:[0,-a],ArrowDown:[0,a],ArrowLeft:[-a,0],ArrowRight:[a,0]}[t.key],2),c=s[0],u=s[1],l=this.map.unproject({x:i.x+c,y:i.y+u});return e._isSnapped=!1,E(r,this.map),this.moveVertex(e,l)}var d=this.getNewCoord(e,t);if(S(e)&&r){var p=this.map.project(d);if(b(r,this.map,p),m(r))return e._isSnapped=!0,this.moveVertex(e,v(r))}return e._isSnapped=!1,this.moveVertex(e,d)}if(t.altKey&&qr.includes(t.key)&&e.selectedVertexIndex>=0)return this.updateVertex(e,t.key);"Escape"===t.key&&this.changeMode(e,{isPanEnabled:!0,selectedVertexIndex:-1,selectedVertexType:null})},onKeyup:function(e,t){e.interfaceType="keyboard",qr.includes(t.key)&&e.selectedVertexIndex>=0&&t.stopPropagation(),"Delete"===t.key&&this.deleteVertex(e)},onMouseDown:function(e,t){var r,n,o;w(y(this.map)),["vertex","midpoint"].includes(null===(r=t.featureTarget)||void 0===r?void 0:r.properties.meta)&&(e.dragMoveLocation=t.lngLat,e.dragMoving=!1,lt.onMouseDown.call(this,e,t)),"midpoint"===(null===(n=t.featureTarget)||void 0===n?void 0:n.properties.meta)&&(e.selectedVertexIndex=this.getVertexIndexFromMidpoint(e.vertecies,null===(o=t.featureTarget)||void 0===o?void 0:o.properties.coord_path),e.selectedVertexType="vertex",this.map.fire("draw.vertexselection",{index:e.selectedVertexIndex,numVertecies:e.vertecies.length}))},onMouseUp:function(e,t){w(y(this.map)),e.dragMoving&&(e.vertecies=this.getVerticies(e.featureId),e.midpoints=this.getMidpoints(e.featureId)),lt.onMouseUp.call(this,e,t)},onPointerevent:function(e,t){e.interfaceType="touch"===t.pointerType?"touch":"pointer",e.isPanEnabled=!0;var r=t.target.parentNode,n=r instanceof window.SVGElement||r.ownerSVGElement;"touch"!==t.pointerType||"pointermove"!==t.type||n||this.changeMode(e,{selectedVertexIndex:-1,selectedVertexType:null,coordPath:null})},onTouchStart:function(e,t){},onTouchMove:function(e,t){},onTouchEnd:function(e,t){},onTouchend:function(e){w(y(this.map)),null!=e&&e.featureId&&(e.vertecies=this.getVerticies(e.featureId),e.midpoints=this.getMidpoints(e.featureId))},clickNoTarget:function(e,t){this.changeMode(e,{selectedVertexIndex:-1,selectedVertexType:null,isPanEnabled:!0})},onTap:function(e,t){var r,n,o=null===(r=t.featureTarget)||void 0===r?void 0:r.properties.meta,i=null===(n=t.featureTarget)||void 0===n?void 0:n.properties.coord_path;if("vertex"===o){var a=parseInt(i.split(".")[1],10);this.changeMode(e,{selectedVertexIndex:a,selectedVertexType:"vertex",coordPath:i})}else if("midpoint"===o){var s=this.getVertexIndexFromMidpoint(e.vertecies,i);this.insertVertex(Yr(Yr({},e),{},{selectedVertexIndex:s,selectedVertexType:"midpoint"}))}else this.clickNoTarget(e,t)},onTouchstart:function(e,t){w(y(this.map));var r=t.target.parentNode,n=r instanceof window.SVGElement||r.ownerSVGElement;if(!(e.selectedVertexIndex<0)&&n){var o=t.touches[0].clientX,i=t.touches[0].clientY,a=window.getComputedStyle(e.touchVertexTarget);e.deltaTarget={x:o-parseFloat(a.left),y:i-parseFloat(a.top)};var s=this.map.project(e.vertecies[e.selectedVertexIndex]);e.deltaVertex={x:o/e.scale-s.x,y:i/e.scale-s.y}}},onTouchmove:function(e,t){var r=t.target.parentNode,n=r instanceof window.SVGElement||r.ownerSVGElement;if(!(e.selectedVertexIndex<0)&&n){var o=t.touches[0].clientX,i=t.touches[0].clientY,a={x:o/e.scale-e.deltaVertex.x,y:i/e.scale-e.deltaVertex.y},s=this.map.unproject(a);if(S(e)){var c=y(this.map);b(c,this.map,a);var u=v(c);u&&(s=u)}this.moveVertex(e,s),this.updateTouchVertexTarget(e,{x:o-e.deltaTarget.x,y:i-e.deltaTarget.y})}},onDrag:function(e,t){var r;if("touch"!==e.interfaceType){var n=S(e),o=y(this.map);if(o&&(o.snapStatus=!1,o.snapCoords=null),n&&null!=o&&o.status)if((null===(r=e.selectedCoordPaths)||void 0===r?void 0:r.length)>0){b(o,this.map,t.point);var i=v(o);i?(e.dragMoving=!0,t.originalEvent.stopPropagation(),e.feature.updateCoordinate(e.selectedCoordPaths[0],i.lng,i.lat),e.dragMoveLocation=i):lt.onDrag.call(this,e,t)}else lt.onDrag.call(this,e,t);else lt.onDrag.call(this,e,t)}},onMove:function(e,t){var r=e.vertecies[e.selectedVertexIndex];if(r){var n=Jr(this.map.project(r),e.scale);this.updateTouchVertexTarget(e,n)}},onVertexButtonClick:function(e,t){t.target.closest("#".concat(e.deleteVertexButtonId))&&"vertex"===e.selectedVertexType&&this.deleteVertex(e)},getVerticies:function(e){var t;return(null===(t=this.getFeature(e))||void 0===t||null===(t=t.coordinates)||void 0===t?void 0:t.flat(1))||[]},getMidpoints:function(e){var t=this.getFeature(e);if(!t)return[];var r=t.coordinates.flat(1);return r.map(function(e,t){var n=r[(t+1)%r.length];return[(e[0]+n[0])/2,(e[1]+n[1])/2]})},getVertexOrMidpoint:function(e,t){var r=this,n=function(e){return Object.values(r.map.project(e))},o=[].concat(Vr(e.vertecies.map(n)),Vr(e.midpoints.map(n))),i=o[e.selectedVertexIndex]||Object.values(this.map.project(this.map.getCenter())),a=Rr(i,o,t);return[a,a<e.vertecies.length?"vertex":"midpoint"]},getVertexIndexFromMidpoint:function(e,t){var r=parseInt(t.split(".")[1],10),n=e.length;return n+(r-1+n)%n},addTouchVertexTarget:function(e){var t=e.container.querySelector("[data-touch-vertex-target]");t||(e.container.insertAdjacentHTML("beforeend","\n  <svg width='48' height='48' viewBox='0 0 48 48' fill-rule='evenodd' style='display:none;position:absolute;top:50%;left:50%;margin:24px 0 0 -24px' class='touch-vertex-target' data-touch-vertex-target>\n    <circle cx='24' cy='24' r='24' fill='currentColor'/>\n    <path d=\"M37.543 25H34a1 1 0 1 1 0-2h3.629l-.836-.837a1 1 0 0 1 1.414-1.414l2.5 2.501A1 1 0 0 1 41 24a1 1 0 0 1-.487.858l-2.306 2.306a1 1 0 0 1-1.414-1.414l.75-.75zM23 10.414l-.793.793a1 1 0 0 1-1.414-1.414l2.5-2.5C23.481 7.105 23.734 7 24 7s.519.105.707.293l2.5 2.5a1 1 0 0 1-1.414 1.414L25 10.414V14a1 1 0 1 1-2 0v-3.586zM7 24a1 1 0 0 1 .293-.75l2.5-2.501a1 1 0 0 1 1.414 1.414l-.836.837H14a1 1 0 1 1 0 2h-3.543l.75.75a1 1 0 0 1-1.414 1.414l-2.306-2.306A1 1 0 0 1 7 24zm16.293 16.707l-2.5-2.5a1 1 0 0 1 1.414-1.414l.793.793V34a1 1 0 1 1 2 0v3.586l.793-.793a1 1 0 0 1 1.414 1.414l-2.5 2.5c-.188.188-.441.293-.707.293s-.519-.105-.707-.293zM24 20c2.208 0 4 1.792 4 4s-1.792 4-4 4-4-1.792-4-4 1.792-4 4-4z\" fill=\"#fff\"/>\n  </svg>\n"),t=e.container.querySelector("[data-touch-vertex-target]")),e.touchVertexTarget=t},updateTouchVertexTarget:function(e,t){t&&"touch"===e.interfaceType&&e.selectedVertexIndex>=0?this.showTouchVertexIndicator(e,t):this.hideTouchVertexIndicator(e)},updateMidpoint:function(e){var t=this;setTimeout(function(){t.map.getSource("mapbox-gl-draw-hot").setData({type:"Feature",properties:{meta:"midpoint",active:"true",id:"active-midpoint"},geometry:{type:"Point",coordinates:e}})},0)},updateVertex:function(e,t){var r=jr(this.getVertexOrMidpoint(e,t),2),n=r[0],o=r[1];this.changeMode(e,Yr({selectedVertexIndex:n,selectedVertexType:o},"vertex"===o&&{coordPath:"0.".concat(n)}))},getOffset:function(e,t){var r=this.map.project(e),n=null!=t&&t.shiftKey?1:5,o=jr(t?{ArrowUp:[0,-n],ArrowDown:[0,n],ArrowLeft:[-n,0],ArrowRight:[n,0]}[t.key]:[0,0],2),i=o[0],a=o[1];return this.map.unproject({x:r.x+i,y:r.y+a})},insertVertex:function(e,t){var r=this.getFeature(e.featureId),n=e.selectedVertexIndex-e.vertecies.length,o=this.getOffset(e.midpoints[n],t),i=r.toGeoJSON();("Polygon"===i.geometry.type?i.geometry.coordinates[0]:i.geometry.coordinates).splice(n+1,0,[o.lng,o.lat]),this._ctx.api.add(i),this.changeMode(e,{selectedVertexIndex:n+1,selectedVertexType:"vertex",coordPath:"0.".concat(n+1)})},getNewCoord:function(e,t){return this.getOffset(this.getFeature(e.featureId).coordinates.flat(1)[e.selectedVertexIndex],t)},moveVertex:function(e,t){if((arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).checkSnap&&!1!==e.enableSnap){var r,n=this.map._snapInstance;null!=n&&n.snapStatus&&(null===(r=n.snapCoords)||void 0===r?void 0:r.length)>=2&&(t={lng:n.snapCoords[0],lat:n.snapCoords[1]})}var o=this.getFeature(e.featureId).toGeoJSON();"Polygon"===o.geometry.type&&(o.geometry.coordinates[0][e.selectedVertexIndex]=[t.lng,t.lat]),this._ctx.api.add(o),e.vertecies=this.getVerticies(e.featureId)},deleteVertex:function(e){var t="Polygon"===this.getFeature(e.featureId).type?3:2;if(!(e.vertecies.length<=t)){var r=e.selectedVertexIndex>=e.vertecies.length-1?0:e.selectedVertexIndex;this._ctx.api.trash(),this.changeMode(e,{selectedVertexIndex:r,selectedVertexType:"vertex",coordPath:"0.".concat(r)})}},changeMode:function(e,t){this._ctx.api.changeMode("edit_vertex",Yr(Yr({},e),t))},showTouchVertexIndicator:function(e,t){Object.assign(e.touchVertexTarget.style,{display:"block",top:"".concat(t.y,"px"),left:"".concat(t.x,"px")})},hideTouchVertexIndicator:function(e){e.touchVertexTarget.style.display="none"},onStop:function(e){var t=this.handlers;e.container.removeEventListener("pointerdown",t.pointerdown),e.container.removeEventListener("pointermove",t.pointermove),e.container.removeEventListener("pointerup",t.pointerup),e.container.removeEventListener("touchstart",t.touchstart),e.container.removeEventListener("touchmove",t.touchmove),e.container.removeEventListener("touchend",t.touchend),this.map.off("draw.selectionchange",t.selectionchange),this.map.off("draw.scalechange",t.scalechange),this.map.off("draw.update",t.update),this.map.off("move",t.move),this.map.dragPan.enable(),window.removeEventListener("click",t.click),window.removeEventListener("keydown",t.keydown,{capture:!0}),window.removeEventListener("keyup",t.keyup,{capture:!0}),this.hideTouchVertexIndicator(e)}});function Hr(e){return Hr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Hr(e)}function Wr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,s=[],c=!0,u=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Kr(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Kr(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Kr(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function Zr(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function zr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Zr(Object(r),!0).forEach(function(t){Qr(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Zr(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function Qr(e,t,r){return(t=function(e){var t=function(e){if("object"!=Hr(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=Hr(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Hr(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var en=zr(zr({},gt),{},{onSetup:function(e){var t=this,r=this.map,n=zr(zr({},gt.onSetup.call(this,e)),e),o=n.container,i=n.interfaceType,a=n.vertexMarkerId,s=o.querySelector("#".concat(a));s.style.display=["touch","keyboard"].includes(i)?"block":"none",n.vertexMarker=s;var c={keydownHandler:this.onKeydown,keyupHandler:this.onKeyup,focusHandler:this.onFocus,blurHandler:this.onBlur,createHandler:this.onCreate,moveHandler:this.onMove,pointerdownHandler:this.onPointerdown,pointermoveHandler:this.onPointermove,pointerupHandler:this.onPointerup,vertexButtonClickHandler:this.onVertexButtonClick};return Object.entries(c).forEach(function(e){var r,o,i=Wr(e,2);return r=i[0],o=i[1],t[r]=o.bind(t,n)}),this._listeners=[[window,"keydown",this.keydownHandler],[window,"keyup",this.keyupHandler],[window,"click",this.vertexButtonClickHandler],[o,"focus",this.focusHandler],[o,"blur",this.blurHandler],[o,"pointermove",this.pointermoveHandler],[o,"pointerup",this.pointerupHandler],[r,"pointerdown",this.pointerdownHandler],[r,"draw.create",this.createHandler],[r,"move",this.moveHandler]],this._listeners.forEach(function(e){var t=Wr(e,3),r=t[0],n=t[1],o=t[2];return r.addEventListener?r.addEventListener(n,o):r.on(n,o)}),n},onClick:function(e,t){if(!(t.originalEvent.button>0)){var r=y(this.map);if(S(e)&&m(r))t=function(e,t){var r=v(t);return r?f(f({},e),{},{lngLat:r}):e}(t,r);else{var n=e.polygon.coordinates[0];n.length>0&&(n[n.length-1]=[t.lngLat.lng,t.lngLat.lat])}gt.onClick.call(this,e,t)}},onTap:function(){},doClick:function(e){var t=e.polygon.coordinates;if(this.dispatchVertexChange(t[0]),Nr(t)){var r=y(this.map),n=S(e)&&function(e,t){var r=v(t);if(!r)return null;var n=e.project([r.lng,r.lat]);return{lngLat:r,point:n,originalEvent:new MouseEvent("click",{clientX:n.x,clientY:n.y,bubbles:!0,cancelable:!0})}}(this.map,r);n?(gt.onClick.call(this,e,n),this._ctx.store.render()):this._simulateMouse("click",gt.onClick,e)}},dispatchVertexChange:function(e){this.map.fire("draw.vertexchange",{numVertecies:e.length})},_simulateMouse:function(e,t,r){var n=this.map,o=n.getCenter(),i=n.project(o);t.call(this,r,{lngLat:o,point:i,originalEvent:new MouseEvent(e,{clientX:i.x,clientY:i.y,bubbles:!0,cancelable:!0})}),this._ctx.store.render()},_setInterface:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e.interfaceType=t,r&&(e.vertexMarker.style.display="block")},onCreate:function(e,t){var r=this._ctx.api,n=t.features[0];r.delete(n.id),n.id=e.featureId,r.add(n)},onVertexButtonClick:function(e,t){t.target.closest("#".concat(e.addVertexButtonId))&&this.doClick(e)},onTouchStart:function(e,t){this._setInterface(e,"touch"),this.onMove(e,t)},onTouchEnd:function(e,t){this._setInterface(e,"touch"),this.onMove(e,t)},onKeydown:function(e,t){if(document.activeElement===e.container){if("Escape"===t.key)return t.preventDefault();"Enter"===t.key&&(e.isActive=!0),this._setInterface(e,"keyboard"),this.onMove(e,t)}},onKeyup:function(e,t){"Escape"!==t.key&&(this._setInterface(e,"keyboard"),this.onMove(e,t),"Enter"===t.key&&e.isActive&&this.doClick(e))},onFocus:function(e){var t=e.vertexMarker,r=e.interfaceType;t.style.display=["touch","keyboard"].includes(r)?"block":"none"},onBlur:function(e,t){t.target!==e.container&&(e.vertexMarker.style.display="none")},onMouseMove:function(e,t){if(S(e)){var r=y(this.map);b(r,this.map,t.point);var n=v(r);n&&(t=zr(zr({},t),{},{lngLat:n}))}gt.onMouseMove.call(this,e,t)},onMove:function(e){if(["touch","keyboard"].includes(e.interfaceType)){S(e)&&function(e,t){if(!e||!t||!e.status)return!1;var r=t.getCenter(),n=t.project(r);e.snapToClosestPoint({point:n,lngLat:r})}(y(this.map),this.map);var t=y(this.map),r=S(e)&&v(t);if(r){var n=this.map.project([r.lng,r.lat]);gt.onMouseMove.call(this,e,{lngLat:r,point:n,originalEvent:new MouseEvent("mousemove",{clientX:n.x,clientY:n.y,bubbles:!0,cancelable:!0})}),this._ctx.store.render()}else this._simulateMouse("mousemove",gt.onMouseMove,e)}},onPointerdown:function(e,t){"touch"!==t.pointerType&&this._setInterface(e,"pointer",!1)},onPointermove:function(e,t){"touch"!==t.pointerType&&(e.vertexMarker.style.display="none")},onPointerup:function(e){this.dispatchVertexChange(e.polygon.coordinates[0])},toDisplayFeatures:function(e,t,r){if(gt.toDisplayFeatures.call(this,e,t,r),"Polygon"===t.geometry.type)for(var n=t.geometry.coordinates[0],o=1;o<n.length-2;o++)r($e(t.id,n[o],"0.".concat(o)))},onStop:function(e){gt.onStop.call(this,e),this._listeners.forEach(function(e){var t=Wr(e,3),r=t[0],n=t[1],o=t[2];return r.removeEventListener?r.removeEventListener(n,o):r.off(n,o)}),e.vertexMarker.style.display="none"}});function tn(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var rn="#0b0c0c",nn="#ffffff",on=function(e){return{id:"fill-active",type:"fill",filter:["all",["==","$type","Polygon"],["==","active","true"]],paint:{"fill-color":e,"fill-opacity":.1}}},an=function(e){return{id:"stroke-active",type:"line",filter:["all",["==","$type","Polygon"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":e,"line-width":2,"line-opacity":1}}},sn=function(e){return{id:"stroke-inactive",type:"line",filter:["all",["==","$type","Polygon"],["==","active","false"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":e,"line-width":2,"line-opacity":.8}}},cn=function(e){return{id:"stroke-preview-line",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":e,"line-width":2,"line-dasharray":[.2,2],"line-opacity":1}}},un=function(e){return{id:"vertex",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"]],paint:{"circle-radius":7,"circle-color":e}}},ln=function(e,t){return{id:"vertex-halo",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["==","active","true"]],paint:{"circle-radius":9,"circle-stroke-width":3,"circle-color":e,"circle-stroke-color":t}}},dn=function(e){return{id:"vertex-active",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["==","active","true"]],paint:{"circle-radius":7,"circle-color":e}}},pn=function(e){return{id:"midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":5,"circle-color":e}}},hn=function(e,t){return{id:"midpoint-halo",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":7,"circle-stroke-width":3,"circle-color":e,"circle-stroke-color":t}}},fn=function(e){return{id:"midpoint-active",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":e}}},gn=function(e){return{id:"circle",type:"line",filter:["==","id","circle"],paint:{"line-color":e,"line-width":2,"line-opacity":.8}}},yn=function(e){var t="dark"===e?nn:rn,r="dark"===e?rn:nn,n="dark"===e?nn:rn;return[on(t),an(t),sn(t),cn(t),pn(t),hn(r,n),fn(t),un(t),ln(r,n),dn(t),gn(t),{id:"touch-vertex-indicator",type:"circle",filter:["all",["==","$type","Point"],["==","meta","touch-vertex-indicator"]],paint:{"circle-radius":30,"circle-color":"#3bb2d0","circle-stroke-width":3,"circle-stroke-color":"#ffffff","circle-opacity":.9}}]},mn=6371008.8,vn={centimeters:637100880,centimetres:637100880,degrees:57.22891354143274,feet:20902260.511392,inches:250826616.45599997,kilometers:6371.0088,kilometres:6371.0088,meters:mn,metres:mn,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:3440.069546436285,radians:1,yards:6967335.223679999};function bn(e,t,r){void 0===r&&(r={});var n={type:"Feature"};return(0===r.id||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=t||{},n.geometry=e,n}function En(e,t,r){if(void 0===r&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Pn(e[0])||!Pn(e[1]))throw new Error("coordinates must contain numbers");return bn({type:"Point",coordinates:e},t,r)}function wn(e,t,r){if(void 0===r&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");return bn({type:"LineString",coordinates:e},t,r)}function Sn(e,t){void 0===t&&(t={});var r={type:"FeatureCollection"};return t.id&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.features=e,r}function xn(e){return e%(2*Math.PI)*180/Math.PI}function Mn(e){return e%360*Math.PI/180}function Pn(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function In(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return e.geometry.coordinates;if("Point"===e.type)return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Tn(e){if(Array.isArray(e))return e;if("Feature"===e.type){if(null!==e.geometry)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}const Cn=function(e,t,r){void 0===r&&(r={});var n=In(e),o=In(t),i=Mn(o[1]-n[1]),a=Mn(o[0]-n[0]),s=Mn(n[1]),c=Mn(o[1]),u=Math.pow(Math.sin(i/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(s)*Math.cos(c);return function(e,t){void 0===t&&(t="kilometers");var r=vn[t];if(!r)throw new Error(t+" units is invalid");return e*r}(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),r.units)};var On=6371008.8,_n={centimeters:637100880,centimetres:637100880,degrees:360/(2*Math.PI),feet:20902260.511392,inches:250826616.45599997,kilometers:6371.0088,kilometres:6371.0088,meters:On,metres:On,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:3440.069546436285,radians:1,yards:6967335.223679999};function Ln(e,t,r={}){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!kn(e[0])||!kn(e[1]))throw new Error("coordinates must contain numbers");return function(e,t,r={}){const n={type:"Feature"};return(0===r.id||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=t||{},n.geometry=e,n}({type:"Point",coordinates:e},t,r)}function An(e){return e%(2*Math.PI)*180/Math.PI}function Fn(e){return e%360*Math.PI/180}function kn(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function Nn(e,t,r,n={}){const o=function(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return[...e.geometry.coordinates];if("Point"===e.type)return[...e.coordinates]}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return[...e];throw new Error("coord must be GeoJSON Point or an Array of numbers")}(e),i=Fn(o[0]),a=Fn(o[1]),s=Fn(r),c=function(e,t="kilometers"){const r=_n[t];if(!r)throw new Error(t+" units is invalid");return e/r}(t,n.units),u=Math.asin(Math.sin(a)*Math.cos(c)+Math.cos(a)*Math.sin(c)*Math.cos(s)),l=An(i+Math.atan2(Math.sin(s)*Math.sin(c)*Math.cos(a),Math.cos(c)-Math.sin(a)*Math.sin(u))),d=An(u);return void 0!==o[2]?Ln([l,d,o[2]],n.properties):Ln([l,d],n.properties)}function Rn(e,t,r={}){const n=r.steps||64,o=r.properties?r.properties:!Array.isArray(e)&&"Feature"===e.type&&e.properties?e.properties:{},i=[];for(let o=0;o<n;o++)i.push(Nn(e,t,-360*o/n,r).geometry.coordinates);return i.push(i[0]),function(e,t,r={}){for(const t of e){if(t.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(t[t.length-1].length!==t[0].length)throw new Error("First and last Position are not equivalent.");for(let e=0;e<t[t.length-1].length;e++)if(t[t.length-1][e]!==t[0][e])throw new Error("First and last Position are not equivalent.")}return function(e,t,r={}){const n={type:"Feature"};return(0===r.id||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=t||{},n.geometry=e,n}({type:"Polygon",coordinates:e},t,r)}([i],o)}function Dn(e,t,r){if(null!==e)for(var n,o,i,a,s,c,u,l,d=0,p=0,h=e.type,f="FeatureCollection"===h,g="Feature"===h,y=f?e.features.length:1,m=0;m<y;m++){s=(l=!!(u=f?e.features[m].geometry:g?e.geometry:e)&&"GeometryCollection"===u.type)?u.geometries.length:1;for(var v=0;v<s;v++){var b=0,E=0;if(null!==(a=l?u.geometries[v]:u)){c=a.coordinates;var w=a.type;switch(d=!r||"Polygon"!==w&&"MultiPolygon"!==w?0:1,w){case null:break;case"Point":if(!1===t(c,p,m,b,E))return!1;p++,b++;break;case"LineString":case"MultiPoint":for(n=0;n<c.length;n++){if(!1===t(c[n],p,m,b,E))return!1;p++,"MultiPoint"===w&&b++}"LineString"===w&&b++;break;case"Polygon":case"MultiLineString":for(n=0;n<c.length;n++){for(o=0;o<c[n].length-d;o++){if(!1===t(c[n][o],p,m,b,E))return!1;p++}"MultiLineString"===w&&b++,"Polygon"===w&&E++}"Polygon"===w&&b++;break;case"MultiPolygon":for(n=0;n<c.length;n++){for(E=0,o=0;o<c[n].length;o++){for(i=0;i<c[n][o].length-d;i++){if(!1===t(c[n][o][i],p,m,b,E))return!1;p++}E++}b++}break;case"GeometryCollection":for(n=0;n<a.geometries.length;n++)if(!1===Dn(a.geometries[n],t,r))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Vn(e,t){if("Feature"===e.type)t(e,0);else if("FeatureCollection"===e.type)for(var r=0;r<e.features.length&&!1!==t(e.features[r],r);r++);}function jn(e,t){!function(e,t){var r,n,o,i,a,s,c,u,l,d,p=0,h="FeatureCollection"===e.type,f="Feature"===e.type,g=h?e.features.length:1;for(r=0;r<g;r++){for(s=h?e.features[r].geometry:f?e.geometry:e,u=h?e.features[r].properties:f?e.properties:{},l=h?e.features[r].bbox:f?e.bbox:void 0,d=h?e.features[r].id:f?e.id:void 0,a=(c=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,o=0;o<a;o++)if(null!==(i=c?s.geometries[o]:s))switch(i.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(i,p,u,l,d))return!1;break;case"GeometryCollection":for(n=0;n<i.geometries.length;n++)if(!1===t(i.geometries[n],p,u,l,d))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,p,u,l,d))return!1;p++}}(e,function(e,r,n,o,i){var a,s=null===e?null:e.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return!1!==t(bn(e,n,{bbox:o,id:i}),r,0)&&void 0}switch(s){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon"}for(var c=0;c<e.coordinates.length;c++){var u=e.coordinates[c];if(!1===t(bn({type:a,coordinates:u},n),r,c))return!1}})}function Un(e,t){var r,n,o;return void 0===t&&(t={}),n=("Feature"===(r=e).type?r.geometry:r).coordinates,o=t.properties?t.properties:"Feature"===e.type?e.properties:{},n.length>1?function(e,t,r){return void 0===r&&(r={}),bn({type:"MultiLineString",coordinates:e},t,r)}(n,o):wn(n[0],o)}function Bn(e){return e%360*Math.PI/180}function Gn(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return e.geometry.coordinates;if("Point"===e.type)return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Yn(e,t,r){if(void 0===r&&(r={}),!0===r.final)return function(e,t){var r=Yn(t,e);return(r+180)%360}(e,t);var n=Gn(e),o=Gn(t),i=Bn(n[0]),a=Bn(o[0]),s=Bn(n[1]),c=Bn(o[1]),u=Math.sin(a-i)*Math.cos(c),l=Math.cos(s)*Math.sin(c)-Math.sin(s)*Math.cos(c)*Math.cos(a-i);return Math.atan2(u,l)%(2*Math.PI)*180/Math.PI}function Xn(e,t,r,n){void 0===n&&(n={});var o=In(e),i=Mn(o[0]),a=Mn(o[1]),s=Mn(r),c=function(e,t){void 0===t&&(t="kilometers");var r=vn[t];if(!r)throw new Error(t+" units is invalid");return e/r}(t,n.units),u=Math.asin(Math.sin(a)*Math.cos(c)+Math.cos(a)*Math.sin(c)*Math.cos(s));return En([xn(i+Math.atan2(Math.sin(s)*Math.sin(c)*Math.cos(a),Math.cos(c)-Math.sin(a)*Math.sin(u))),xn(u)],n.properties)}Math.PI;const qn=function(e){if(!e)throw new Error("geojson is required");var t=[];return jn(e,function(e){!function(e,t){var r=[],n=e.geometry;if(null!==n){switch(n.type){case"Polygon":r=Tn(n);break;case"LineString":r=[Tn(n)]}r.forEach(function(r){var n=function(e,t){var r=[];return e.reduce(function(e,n){var o,i,a,s,c,u,l=wn([e,n],t);return l.bbox=(i=n,a=(o=e)[0],s=o[1],[a<(c=i[0])?a:c,s<(u=i[1])?s:u,a>c?a:c,s>u?s:u]),r.push(l),n}),r}(r,e.properties);n.forEach(function(e){e.id=t.length,t.push(e)})})}}(e,t)}),Sn(t)};var Jn=r(945);function $n(e,t){var r=Tn(e),n=Tn(t);if(2!==r.length)throw new Error("<intersects> line1 must only contain 2 coordinates");if(2!==n.length)throw new Error("<intersects> line2 must only contain 2 coordinates");var o=r[0][0],i=r[0][1],a=r[1][0],s=r[1][1],c=n[0][0],u=n[0][1],l=n[1][0],d=n[1][1],p=(d-u)*(a-o)-(l-c)*(s-i);if(0===p)return null;var h=((l-c)*(i-u)-(d-u)*(o-c))/p,f=((a-o)*(i-u)-(s-i)*(o-c))/p;return h>=0&&h<=1&&f>=0&&f<=1?En([o+h*(a-o),i+h*(s-i)]):null}const Hn=function(e,t){var r={},n=[];if("LineString"===e.type&&(e=bn(e)),"LineString"===t.type&&(t=bn(t)),"Feature"===e.type&&"Feature"===t.type&&null!==e.geometry&&null!==t.geometry&&"LineString"===e.geometry.type&&"LineString"===t.geometry.type&&2===e.geometry.coordinates.length&&2===t.geometry.coordinates.length){var o=$n(e,t);return o&&n.push(o),Sn(n)}var i=Jn();return i.load(qn(t)),Vn(qn(e),function(e){Vn(i.search(e),function(t){var o=$n(e,t);if(o){var i=Tn(o).join(",");r[i]||(r[i]=!0,n.push(o))}})}),Sn(n)},Wn=function(e,t,r){void 0===r&&(r={});var n=En([1/0,1/0],{dist:1/0}),o=0;return jn(e,function(e){for(var i=Tn(e),a=0;a<i.length-1;a++){var s=En(i[a]);s.properties.dist=Cn(t,s,r);var c=En(i[a+1]);c.properties.dist=Cn(t,c,r);var u=Cn(s,c,r),l=Math.max(s.properties.dist,c.properties.dist),d=Yn(s,c),p=Xn(t,l,d+90,r),h=Xn(t,l,d-90,r),f=Hn(wn([p.geometry.coordinates,h.geometry.coordinates]),wn([s.geometry.coordinates,c.geometry.coordinates])),g=null;f.features.length>0&&((g=f.features[0]).properties.dist=Cn(t,g,r),g.properties.location=o+Cn(s,g,r)),s.properties.dist<n.properties.dist&&((n=s).properties.index=a,n.properties.location=o),c.properties.dist<n.properties.dist&&((n=c).properties.index=a+1,n.properties.location=o+u),g&&g.properties.dist<n.properties.dist&&((n=g).properties.index=a),o+=u}}),n};var Kn=6371008.8,Zn={centimeters:637100880,centimetres:637100880,degrees:57.22891354143274,feet:20902260.511392,inches:250826616.45599997,kilometers:6371.0088,kilometres:6371.0088,meters:Kn,metres:Kn,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:3440.069546436285,radians:1,yards:6967335.223679999};function zn(e){return e%(2*Math.PI)*180/Math.PI}function Qn(e){return e%360*Math.PI/180}function eo(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function to(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return e.geometry.coordinates;if("Point"===e.type)return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}const ro=function(e,t,r){void 0===r&&(r={});var n=to(e),o=to(t),i=Qn(o[1]-n[1]),a=Qn(o[0]-n[0]),s=Qn(n[1]),c=Qn(o[1]),u=Math.pow(Math.sin(i/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(s)*Math.cos(c);return function(e,t){void 0===t&&(t="kilometers");var r=Zn[t];if(!r)throw new Error(t+" units is invalid");return e*r}(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)),r.units)},no=function(e,t){return function(e,t,r,n){void 0===n&&(n={});var o=to(e),i=Qn(o[0]),a=Qn(o[1]),s=Qn(r),c=function(e,t){void 0===t&&(t="kilometers");var r=Zn[t];if(!r)throw new Error(t+" units is invalid");return e/r}(t,n.units),u=Math.asin(Math.sin(a)*Math.cos(c)+Math.cos(a)*Math.sin(c)*Math.cos(s));return function(e,t,r){if(void 0===r&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!eo(e[0])||!eo(e[1]))throw new Error("coordinates must contain numbers");return function(e,t,r){void 0===r&&(r={});var n={type:"Feature"};return(0===r.id||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=t||{},n.geometry=e,n}({type:"Point",coordinates:e},t,r)}([zn(i+Math.atan2(Math.sin(s)*Math.sin(c)*Math.cos(a),Math.cos(c)-Math.sin(a)*Math.sin(u))),zn(u)],n.properties)}(e,ro(e,t)/2,Yn(e,t))};var oo=function(){return oo=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},oo.apply(this,arguments)},io=function(){function e(e){var t;this.status=null!==(t=e.status)&&void 0!==t&&t,this.map=e.map,this.drawing=e.drawing,this.options=e.options,this.onSnapped=function(t){void 0!==e.onSnapped&&e.onSnapped(t)},this.features={},this.snapStatus=!1,this.snapCoords=[],this.radiusInMeters=0,this.addRadiusCircleLayer(),this.addEvents()}return e.prototype.changeSnappedPoints=function(){for(var e=this.drawing.getAll(),t=[],r=0;r<e.features.length;r++){var n=e.features[r],o=n.id;if(this.features[o]){var i=this.features[o].snapPoints;if(void 0!==this.features.unknow){var a=this.features.unknow.snapPoints;i=oo(oo({},i),a)}var s=this.doSnap(n,i);t.push(s)}else void 0!==this.features.unknow?(a=this.features.unknow.snapPoints,s=this.doSnap(n,a),t.push(s)):t.push(n)}var c={type:"FeatureCollection",features:t};this.drawing.set(c),this.onSnapped&&this.onSnapped(c)},e.prototype.isPointSnapped=function(e,t){return Cn(En(e),En(t),{units:"meters"})<this.radiusInMeters},e.prototype.doSnap=function(e,t){switch(e.geometry.type){case"Point":var r=e.geometry.coordinates;for(var n in t)this.isPointSnapped(r,t[n])&&(e.geometry.coordinates=t[n]);break;case"Polygon":for(var o=e.geometry.coordinates,i=[],a=0;a<o.length;a++){for(var s=o[a],c=[],u=0;u<s.length;u++){var l=s[u],d=!1;for(var n in t)if(this.isPointSnapped(l,t[n])){d=!0,c.push(t[n]);break}0==d&&c.push(l)}i.push(c)}e.geometry.coordinates=i;break;case"LineString":var p=e.geometry.coordinates;for(c=[],u=0;u<p.length;u++){var h=p[u];for(var n in d=!1,t)if(this.isPointSnapped(h,t[n])){d=!0,c.push(t[n]);break}0==d&&c.push(h)}e.geometry.coordinates=c}return e},e.prototype.getMe=function(){return this},e.prototype.setStatus=function(e){this.status=e},e.prototype.setMapData=function(e){var t=this.map.getSource("snap-helper-circle");t&&t.setData(e)},e.prototype.snapToClosestPoint=function(e){if(this.status){var t=e.point,r=this.map.unproject(t),n=[t.x+this.options.radius,t.y],o=this.map.unproject(n),i=Cn(En([r.lng,r.lat]),En([o.lng,o.lat]),{units:"meters"});this.radiusInMeters=i;var a=!1,s=this.getCloseFeatures(e,i);s?(this.snapStatus=!0,this.snapCoords=s.coords,a=Rn(s.coords,i,{steps:64,units:"meters",properties:{color:s.color}})):(this.snapStatus=!1,this.snapCoords=[]);var c=Sn(0==a?[]:[a]);this.setMapData(c)}},e.prototype.addEvents=function(){var e=this;this.map.on("mousemove",function(t){e.snapToClosestPoint(t)}),this.map.on("draw.delete",function(t){setTimeout(function(){e.changeSnappedPoints()},100)}),this.map.on("draw.update",function(t){setTimeout(function(){e.changeSnappedPoints()},100)}),this.map.on("draw.create",function(t){setTimeout(function(){e.changeSnappedPoints()},100)}),this.map.on("draw.selectionchange",function(t){t.features.length>0?e.status=!0:(e.status=!1,e.setMapData(Sn([])))}),this.map.on("draw.modechange",function(t){e.status=!0,"simple_select"==t.mode&&(e.status=!1)}),this.map.on("draw.render",function(t){var r=e.map.getSource("mapbox-gl-draw-hot");if(r){var n=r._data;if(e.snapStatus){var o=[e.snapCoords[0],e.snapCoords[1]];n.features.length>0&&(n.features[0].geometry.coordinates=o)}}}),this.map.on("mouseup",function(){e.drawingSnapCheck()}),this.map.on("click",function(){e.drawingSnapCheck()})},e.prototype.drawingSnapCheck=function(){if(this.snapStatus){var e=this.map.getSource("mapbox-gl-draw-hot"),t=[this.snapCoords[0],this.snapCoords[1]],r=t[0].toFixed(6),n=t[1].toFixed(6),o={};if(o["".concat(r,"_").concat(n)]=t,e){var i=e._data;if(i.features.length>0){var a=i.features.find(function(e){return"feature"==e.properties.meta});if(a){var s=a.properties.id;this.features[s]?this.features[s].snapPoints["".concat(r,"_").concat(n)]=t:this.features[s]={id:s,snapPoints:o}}}else this.features.unknow?this.features.unknow.snapPoints["".concat(r,"_").concat(n)]=t:this.features.unknow={id:s,snapPoints:o}}}},e.prototype.searchInVertex=function(e,t,r){var n,o=(n=[],Dn(e,function(e){n.push(e)}),n),i=[];if(o.map(function(e){var n=Cn(En(e),En([t.lng,t.lat]),{units:"meters"});n<r&&i.push({coords:e,dist:n,color:"#8bc34a"})}),i.length>0)return i.sort(function(e,t){return e.dist-t.dist}),i[0]},e.prototype.getLines=function(e,t,r){var n=[];switch(e.geometry.type){case"LineString":n.push(e);break;case"MultiLineString":e.geometry.coodinates.map(function(e){n.push(wn(e))});break;case"Polygon":var o=Un(e.geometry);n.push(o);break;case"MultiPolygon":Un(e.geometry).coodinates.map(function(e){n.push(wn(e))})}return n},e.prototype.searchInMidPoint=function(e,t,r){var n=this.getLines(e,t,r),o=[];n.map(function(e){o=o.concat(qn(e).features)});var i=[];if(o.map(function(e){var n=no(e.geometry.coordinates[0],e.geometry.coordinates[1]),o=Cn(n,En([t.lng,t.lat]),{units:"meters"});o<r&&i.push({coords:n.geometry.coordinates,dist:o,color:"#03a9f4"})}),i.length>0)return i.sort(function(e,t){return e.dist-t.dist}),i[0]},e.prototype.searchInEdge=function(e,t,r){for(var n=this.getLines(e,t,r),o=[],i=0;i<n.length;i++){var a=Wn(n[i],En([t.lng,t.lat]),{units:"meters"});void 0!==a.properties.dist&&a.properties.dist<r&&o.push({coords:a.geometry.coordinates,dist:a.properties.dist,color:"#ff9800"})}if(o.length>0)return o.sort(function(e,t){return e.dist-t.dist}),o[0]},e.prototype.getCloseFeatures=function(e,t){var r=this.map.queryRenderedFeatures(e.point,{layers:this.options.layers});if(r.length>0){for(var n,o=!1,i=0;i<r.length;i++){var a=r[i],s=this.options.rules,c=e.lngLat;if(o=!1,-1!==s.indexOf("vertex")&&null==n&&(n=this.searchInVertex(a,c,t))){o=!0;break}if(-1!==s.indexOf("midpoint")&&null==n&&(n=this.searchInMidPoint(a,c,t))){o=!0;break}if(-1!==s.indexOf("edge")&&null==n&&(n=this.searchInEdge(a,c,t))){o=!0;break}}return!!o&&n}return!1},e.prototype.addRadiusCircleLayer=function(){this.map.addSource("snap-helper-circle",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),this.map.addLayer({id:"snap-helper-circle",type:"fill",source:"snap-helper-circle",paint:{"fill-color":["get","color"],"fill-opacity":.6}})},e}();const ao=io;function so(e){return so="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},so(e)}function co(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function uo(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?co(Object(r),!0).forEach(function(t){lo(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):co(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function lo(e,t,r){return(t=function(e){var t=function(e){if("object"!=so(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=so(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==so(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var po={vertex:"#f47738",midpoint:"#00703c",edge:"#1d70b8"},ho=Symbol.for("mapboxSnapOriginalMethods"),fo=uo({},po);function go(e,t){!function r(){var n=e();n?t(n):requestAnimationFrame(r)}()}function yo(e){var t;if(e&&(!e._data||!Array.isArray(null===(t=e._data)||void 0===t?void 0:t.features))){var r={type:"FeatureCollection",features:[]};Object.defineProperty(e,"_data",{get:function(){return r},set:function(e){r=e&&"object"===so(e)&&Array.isArray(e.features)?e:{type:"FeatureCollection",features:[]}},configurable:!0})}}function mo(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e._snapInitialized)return e._snapInstance;e._snapInitialized=!0;var n=r.layers,o=void 0===n?[]:n,i=r.radius,a=void 0===i?15:i,s=r.rules,c=void 0===s?["vertex","midpoint","edge"]:s,u=r.status,l=void 0!==u&&u,d=r.onSnapped,p=void 0===d?function(){}:d,h=r.colors;function f(r){yo(r);var n=new ao({map:e,drawing:t,options:{layers:o,radius:a,rules:c},status:l,onSnapped:p}),i=l;return Object.defineProperty(n,"status",{get:function(){return i},set:function(e){},configurable:!0}),n.setSnapStatus=function(e){i=e},e._snapInstance=n,n}(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};fo=uo(uo({},po),e);var t=(globalThis[ho]||ao.prototype.__patchedSnapToClosestPoint||(globalThis[ho]={getLines:ao.prototype.getLines,getCloseFeatures:ao.prototype.getCloseFeatures,searchInVertex:ao.prototype.searchInVertex,searchInMidPoint:ao.prototype.searchInMidPoint,searchInEdge:ao.prototype.searchInEdge,snapToClosestPoint:ao.prototype.snapToClosestPoint,changeSnappedPoints:ao.prototype.changeSnappedPoints}),globalThis[ho]);t&&(ao.prototype.__patchedGetLines||(ao.prototype.getLines=function(e,r,n){return e.geometry?"MultiPolygon"===e.geometry.type?(e.geometry.coordinates||[]).map(function(e){return Ft(e)}):"MultiLineString"===e.geometry.type?(e.geometry.coordinates||[]).map(function(e){return kt(e)}):t.getLines.call(this,e,r,n):[]},ao.prototype.__patchedGetLines=!0),ao.prototype.__patchedGetCloseFeatures||(ao.prototype.getCloseFeatures=function(e,r){var n=this.options.radius||15,o=[[e.point.x-n,e.point.y-n],[e.point.x+n,e.point.y+n]],i=e.point;e.point=o;var a=t.getCloseFeatures.call(this,e,r);return e.point=i,a},ao.prototype.__patchedGetCloseFeatures=!0),ao.prototype.__patchedColors||(ao.prototype.searchInVertex=function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];var o=t.searchInVertex.apply(this,r);return o&&(o.color=fo.vertex),o},ao.prototype.searchInMidPoint=function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];var o=t.searchInMidPoint.apply(this,r);return o&&(o.color=fo.midpoint),o},ao.prototype.searchInEdge=function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];var o=t.searchInEdge.apply(this,r);return o&&(o.color=fo.edge),o},ao.prototype.__patchedColors=!0),ao.prototype.__patchedChangeSnappedPoints||(ao.prototype.changeSnappedPoints=function(){},ao.prototype.__patchedChangeSnappedPoints=!0),ao.prototype.__patchedSnapToClosestPoint||(ao.prototype.snapToClosestPoint=function(e){var r=t.snapToClosestPoint.call(this,e);return this.closeFeatures&&this.closeFeatures.length>100&&(this.closeFeatures=[]),this.lines&&this.lines.length>100&&(this.lines=[]),r},ao.prototype.__patchedSnapToClosestPoint=!0))})(void 0===h?{}:h),e.on("style.load",function(){go(function(){return e.getSource("mapbox-gl-draw-hot")},function(t){yo(t),e.getLayer("snap-helper-circle")&&e.removeLayer("snap-helper-circle"),e.getSource("snap-helper-circle")&&e.removeSource("snap-helper-circle"),e._snapInstance||f(t)})}),e.on("zoomstart",function(){e.getLayer("snap-helper-circle")&&e.setLayoutProperty("snap-helper-circle","visibility","none")}),e.on("zoomend",function(){var t=e._snapInstance;e.getLayer("snap-helper-circle")&&null!=t&&t.status&&e.setLayoutProperty("snap-helper-circle","visibility","visible")}),go(function(){return e.getSource("mapbox-gl-draw-hot")},f)}function vo(e){return vo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vo(e)}function bo(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Eo(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?bo(Object(r),!0).forEach(function(t){wo(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bo(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function wo(e,t,r){return(t=function(e){var t=function(e){if("object"!=vo(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=vo(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==vo(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var So=function(e){var t=e.colorScheme,r=e.mapProvider,n=e.events,o=e.eventBus,i=r.map;Tt.constants.classes.CONTROL_BASE="maplibregl-ctrl",Tt.constants.classes.CONTROL_PREFIX="maplibregl-ctrl-",Tt.constants.classes.CONTROL_GROUP="maplibregl-ctrl-group";var a=Eo(Eo({},Tt.modes),{},{disabled:Ct,edit_vertex:$r,draw_vertex:en}),s=new Tt({modes:a,styles:yn(t),displayControlsDefault:!1,userProperties:!0,defaultMode:"disabled"});i.addControl(s),r.draw=s,r.snapEnabled=!1,mo(i,s,{layers:["OS/TopographicArea_1/Agricultural Land","OS/TopographicLine/Building Outline"],radius:10,rules:["vertex","edge"]});var c=function(e){i.once("idle",function(){!function(e,t){yn(t).forEach(function(t){Object.entries(t.paint).forEach(function(r){var n=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i,a,s=[],c=!0,u=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return tn(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?tn(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(r,2),o=n[0],i=n[1];e.getLayer("".concat(t.id,".cold"))&&e.setPaintProperty("".concat(t.id,".cold"),o,i),e.getLayer("".concat(t.id,".hot"))&&e.setPaintProperty("".concat(t.id,".hot"),o,i)})})}(i,e.mapColorScheme)})};return o.on(n.MAP_SET_STYLE,c),o.on(n.MAP_SET_SIZE,function(e){i.fire("draw.scalechange",{scale:{small:1,medium:1.5,large:2}[e]})}),{draw:s,remove:function(){o.off(n.MAP_SET_STYLE,c),s.deleteAll(),s.changeMode("disabled"),i.removeControl(s)}}};function xo(e){return xo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xo(e)}function Mo(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Po(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Mo(Object(r),!0).forEach(function(t){Io(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Mo(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function Io(e,t,r){return(t=function(e){var t=function(e){if("object"!=xo(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=xo(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==xo(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var To=function(e){return{mobile:{slot:"actions",showLabel:e},tablet:{slot:"actions",showLabel:e},desktop:{slot:"actions",showLabel:e}}},Co={reducer:{initialState:{mode:null,feature:null,tempFeature:null,selectedVertexIndex:-1,numVertecies:null,snap:!1},actions:l},InitComponent:function(e){var t=e.appState,r=e.appConfig,n=e.mapState,o=e.pluginConfig,i=e.pluginState,a=e.services,s=e.mapProvider,c=e.buttonConfig,u=a.events,l=a.eventBus;(0,d.useEffect)(function(){var e,r,i,a,c=null===(e=null===(r=o.includeModes)||void 0===r?void 0:r.includes(t.mode))||void 0===e||e,d=null!==(i=null===(a=o.excludeModes)||void 0===a?void 0:a.includes(t.mode))&&void 0!==i&&i;if(n.isMapReady&&c&&!d){var p=So({colorScheme:n.mapStyle.mapColorScheme,mapProvider:s,events:u,eventBus:l}).remove;return l.emit("draw:ready"),function(){return p()}}},[n.isMapReady,t.mode]),(0,d.useEffect)(function(){if(s.draw){var e=function(e){var t=e.appState,r=e.appConfig,n=e.mapState,o=e.pluginState,i=e.mapProvider,a=e.buttonConfig,s=e.eventBus,c=a.drawDone,u=a.drawAddPoint,l=a.drawUndo,d=a.drawFinish,p=a.drawDeletePoint,h=a.drawSnap,f=a.drawCancel,g=i.map,m=i.draw,v=o.dispatch,b=o.feature,S=o.tempFeature;c.onClick=function(){m.changeMode("disabled"),v({type:"SET_MODE",payload:null}),v({type:"SET_FEATURE",payload:{feature:null,tempFeature:null}}),s.emit("draw:done",{newFeature:S})},f.onClick=function(){m.delete(S.id),b&&m.add(b),m.changeMode("disabled"),v({type:"SET_MODE",payload:null}),v({type:"SET_FEATURE",payload:{feature:null,tempFeature:null}}),s.emit("draw:cancel",{originalFeature:b})};var x=null;h.onClick=function(){if(!x){x=setTimeout(function(){x=null},100);var e=!o.snap;v({type:"TOGGLE_SNAP"}),i.snapEnabled=e;var t=y(g);if(t)if("function"==typeof t.setSnapStatus&&t.setSnapStatus(e),e)t._originalLayers&&t.options&&(t.options.layers=t._originalLayers);else{var r;t._originalLayers||(t._originalLayers=(null===(r=t.options)||void 0===r?void 0:r.layers)||[]),t.options&&(t.options.layers=[]),w(t)}e?g.getLayer("snap-helper-circle")&&g.setLayoutProperty("snap-helper-circle","visibility","visible"):E(t,g)}};var M=function(){var e,t=g.getStyle().layers||[];0===t.length||null!==(e=t[t.length-1].source)&&void 0!==e&&e.startsWith("mapbox-gl-draw")||t.filter(function(e){var t;return null===(t=e.source)||void 0===t?void 0:t.startsWith("mapbox-gl-draw")}).forEach(function(e){return g.moveLayer(e.id)})};g.on("styledata",function(){return M()});var P=function(e){var o=e.features[0];v({type:"SET_FEATURE",payload:{tempFeature:o}}),s.emit("draw:create",e),v({type:"SET_MODE",payload:"edit_vertex"}),setTimeout(function(){m.changeMode("edit_vertex",{container:t.layoutRefs.viewportRef.current,deleteVertexButtonId:"".concat(r.id,"-draw-delete-point"),isPanEnabled:"keyboard"!==t.interfaceType,interfaceType:t.interfaceType,scale:{small:1,medium:1.5,large:2}[n.mapSize],featureId:o.id,getSnapEnabled:function(){return!0===i.snapEnabled}})},0)};g.on("draw.create",P);var I=function(e){v({type:"SET_SELECTED_VERTEX_INDEX",payload:e}),s.emit("draw:vertexselection",e)};return g.on("draw.vertexselection",I),function(){c.onClick=null,u.onClick=null,l.onClick=null,d.onClick=null,p.onClick=null,h.onClick=null,f.onClick=null,g.off("styledata",M),g.off("draw.create",P),g.off("draw.vertexselection",I)}}({appState:t,appConfig:r,mapState:n,mapProvider:s,buttonConfig:c,pluginState:i,events:u,eventBus:l});return function(){return e()}}},[s,t,i])},buttons:[Po({id:"drawDone",label:"Done",variant:"primary",hiddenWhen:function(e){var t=e.appState,r=e.pluginState;return!r.mode||"mouse"!==t.interfaceType&&"edit_vertex"!==r.mode},enableWhen:function(e){return!!e.pluginState.tempFeature}},To(!0)),Po({id:"drawAddPoint",label:"Add point",variant:"primary",hiddenWhen:function(e){var t=e.appState;return"draw_vertex"!==e.pluginState.mode||"mouse"===t.interfaceType}},To(!0)),Po({id:"drawUndo",label:"Undo",iconId:"undo",variant:"tertiary",hiddenWhen:function(e){return!e.pluginState.mode},enableWhen:function(e){return e.pluginState,!1}},To(!1)),Po({id:"drawFinish",label:"Close shape",iconId:"check",variant:"tertiary",hiddenWhen:function(e){return"draw_vertex"!==e.pluginState.mode},enableWhen:function(e){return e.pluginState.numVertecies>3}},To(!1)),Po({id:"drawDeletePoint",label:"Delete point",iconId:"close",variant:"tertiary",enableWhen:function(e){var t=e.pluginState;return t.selectedVertexIndex>=0&&t.numVertecies>3},hiddenWhen:function(e){var t=e.pluginState;return!["simple_select","edit_vertex"].includes(t.mode)}},To(!1)),Po({id:"drawSnap",label:"Snap to point",iconId:"magnet",variant:"tertiary",hiddenWhen:function(e){return!e.pluginState.mode},pressedWhen:function(e){return!!e.pluginState.snap}},To(!1)),Po({id:"drawCancel",label:"Cancel",variant:"tertiary",hiddenWhen:function(e){return!e.pluginState.mode}},To(!0))],keyboardShortcuts:[{id:"drawStart",group:"Drawing",title:"Edit vertex",command:"<kbd>Spacebar</kbd></dd>"}],icons:[{id:"check",svgContent:'<path d="M20 6 9 17l-5-5"/>'},{id:"undo",svgContent:'<path d="M3 7v6h6"/><path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"/>'},{id:"magnet",svgContent:'<path d="m12 15 4 4"/><path d="M2.352 10.648a1.205 1.205 0 0 0 0 1.704l2.296 2.296a1.205 1.205 0 0 0 1.704 0l6.029-6.029a1 1 0 1 1 3 3l-6.029 6.029a1.205 1.205 0 0 0 0 1.704l2.296 2.296a1.205 1.205 0 0 0 1.704 0l6.365-6.367A1 1 0 0 0 8.716 4.282z"/><path d="m5 8 4 4"/>'}],api:{newPolygon:function(e,t){var r=e.appState,n=e.appConfig,o=e.pluginState,i=e.mapProvider,a=o.dispatch,s=i.draw;s&&(s.changeMode("draw_vertex",{container:r.layoutRefs.viewportRef.current,vertexMarkerId:"".concat(n.id,"-cross-hair"),addVertexButtonId:"".concat(n.id,"-draw-add-point"),interfaceType:r.interfaceType,featureId:t,getSnapEnabled:function(){return!0===i.snapEnabled}}),a({type:"SET_MODE",payload:"draw_vertex"}))},editFeature:function(e,t){var r=e.appState,n=e.appConfig,o=e.mapState,i=e.pluginState,a=e.mapProvider,s=i.dispatch,c=a.draw;if(c){c.changeMode("edit_vertex",{container:r.layoutRefs.viewportRef.current,deleteVertexButtonId:"".concat(n.id,"-draw-delete-point"),isPanEnabled:"keyboard"!==r.interfaceType,interfaceType:r.interfaceType,scale:{small:1,medium:1.5,large:2}[o.mapSize],featureId:t,getSnapEnabled:function(){return!0===a.snapEnabled}});var u=c.get(t);s({type:"SET_FEATURE",payload:{feature:u,tempFeature:u}}),s({type:"SET_MODE",payload:"edit_vertex"})}},addFeature:function(e,t){var r=e.mapProvider,n=e.services,o=r.draw,i=n.eventBus;o&&(o.add(t),o.changeMode("disabled"),i.emit("draw:add",t))},deleteFeature:function(e,t){var r=e.mapProvider,n=e.services,o=r.draw,i=n.eventBus;o&&(o.delete(t),i.emit("draw:delete",{featureId:t}))}}}},609:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(339);function o(e,t,r){if(null!==e)for(var n,i,a,s,c,u,l,d,p=0,h=0,f=e.type,g="FeatureCollection"===f,y="Feature"===f,m=g?e.features.length:1,v=0;v<m;v++){c=(d=!!(l=g?e.features[v].geometry:y?e.geometry:e)&&"GeometryCollection"===l.type)?l.geometries.length:1;for(var b=0;b<c;b++){var E=0,w=0;if(null!==(s=d?l.geometries[b]:l)){u=s.coordinates;var S=s.type;switch(p=!r||"Polygon"!==S&&"MultiPolygon"!==S?0:1,S){case null:break;case"Point":if(!1===t(u,h,v,E,w))return!1;h++,E++;break;case"LineString":case"MultiPoint":for(n=0;n<u.length;n++){if(!1===t(u[n],h,v,E,w))return!1;h++,"MultiPoint"===S&&E++}"LineString"===S&&E++;break;case"Polygon":case"MultiLineString":for(n=0;n<u.length;n++){for(i=0;i<u[n].length-p;i++){if(!1===t(u[n][i],h,v,E,w))return!1;h++}"MultiLineString"===S&&E++,"Polygon"===S&&w++}"Polygon"===S&&E++;break;case"MultiPolygon":for(n=0;n<u.length;n++){for(w=0,i=0;i<u[n].length;i++){for(a=0;a<u[n][i].length-p;a++){if(!1===t(u[n][i][a],h,v,E,w))return!1;h++}w++}E++}break;case"GeometryCollection":for(n=0;n<s.geometries.length;n++)if(!1===o(s.geometries[n],t,r))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function i(e,t){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&!1!==t(e.features[r].properties,r);r++);break;case"Feature":t(e.properties,0)}}function a(e,t){if("Feature"===e.type)t(e,0);else if("FeatureCollection"===e.type)for(var r=0;r<e.features.length&&!1!==t(e.features[r],r);r++);}function s(e,t){var r,n,o,i,a,s,c,u,l,d,p=0,h="FeatureCollection"===e.type,f="Feature"===e.type,g=h?e.features.length:1;for(r=0;r<g;r++){for(s=h?e.features[r].geometry:f?e.geometry:e,u=h?e.features[r].properties:f?e.properties:{},l=h?e.features[r].bbox:f?e.bbox:void 0,d=h?e.features[r].id:f?e.id:void 0,a=(c=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,o=0;o<a;o++)if(null!==(i=c?s.geometries[o]:s))switch(i.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(i,p,u,l,d))return!1;break;case"GeometryCollection":for(n=0;n<i.geometries.length;n++)if(!1===t(i.geometries[n],p,u,l,d))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,p,u,l,d))return!1;p++}}function c(e,t){s(e,function(e,r,o,i,a){var s,c=null===e?null:e.type;switch(c){case null:case"Point":case"LineString":case"Polygon":return!1!==t(n.feature(e,o,{bbox:i,id:a}),r,0)&&void 0}switch(c){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var u=0;u<e.coordinates.length;u++){var l={type:s,coordinates:e.coordinates[u]};if(!1===t(n.feature(l,o),r,u))return!1}})}function u(e,t){c(e,function(e,r,i){var a=0;if(e.geometry){var s=e.geometry.type;if("Point"!==s&&"MultiPoint"!==s){var c,u=0,l=0,d=0;return!1!==o(e,function(o,s,p,h,f){if(void 0===c||r>u||h>l||f>d)return c=o,u=r,l=h,d=f,void(a=0);var g=n.lineString([c,o],e.properties);if(!1===t(g,r,i,f,a))return!1;a++,c=o})&&void 0}}})}function l(e,t){if(!e)throw new Error("geojson is required");c(e,function(e,r,o){if(null!==e.geometry){var i=e.geometry.type,a=e.geometry.coordinates;switch(i){case"LineString":if(!1===t(e,r,o,0,0))return!1;break;case"Polygon":for(var s=0;s<a.length;s++)if(!1===t(n.lineString(a[s],e.properties),r,o,s))return!1}}})}t.coordAll=function(e){var t=[];return o(e,function(e){t.push(e)}),t},t.coordEach=o,t.coordReduce=function(e,t,r,n){var i=r;return o(e,function(e,n,o,a,s){i=0===n&&void 0===r?e:t(i,e,n,o,a,s)},n),i},t.featureEach=a,t.featureReduce=function(e,t,r){var n=r;return a(e,function(e,o){n=0===o&&void 0===r?e:t(n,e,o)}),n},t.findPoint=function(e,t){if(t=t||{},!n.isObject(t))throw new Error("options is invalid");var r,o=t.featureIndex||0,i=t.multiFeatureIndex||0,a=t.geometryIndex||0,s=t.coordIndex||0,c=t.properties;switch(e.type){case"FeatureCollection":o<0&&(o=e.features.length+o),c=c||e.features[o].properties,r=e.features[o].geometry;break;case"Feature":c=c||e.properties,r=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":r=e;break;default:throw new Error("geojson is invalid")}if(null===r)return null;var u=r.coordinates;switch(r.type){case"Point":return n.point(u,c,t);case"MultiPoint":return i<0&&(i=u.length+i),n.point(u[i],c,t);case"LineString":return s<0&&(s=u.length+s),n.point(u[s],c,t);case"Polygon":return a<0&&(a=u.length+a),s<0&&(s=u[a].length+s),n.point(u[a][s],c,t);case"MultiLineString":return i<0&&(i=u.length+i),s<0&&(s=u[i].length+s),n.point(u[i][s],c,t);case"MultiPolygon":return i<0&&(i=u.length+i),a<0&&(a=u[i].length+a),s<0&&(s=u[i][a].length-s),n.point(u[i][a][s],c,t)}throw new Error("geojson is invalid")},t.findSegment=function(e,t){if(t=t||{},!n.isObject(t))throw new Error("options is invalid");var r,o=t.featureIndex||0,i=t.multiFeatureIndex||0,a=t.geometryIndex||0,s=t.segmentIndex||0,c=t.properties;switch(e.type){case"FeatureCollection":o<0&&(o=e.features.length+o),c=c||e.features[o].properties,r=e.features[o].geometry;break;case"Feature":c=c||e.properties,r=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":r=e;break;default:throw new Error("geojson is invalid")}if(null===r)return null;var u=r.coordinates;switch(r.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=u.length+s-1),n.lineString([u[s],u[s+1]],c,t);case"Polygon":return a<0&&(a=u.length+a),s<0&&(s=u[a].length+s-1),n.lineString([u[a][s],u[a][s+1]],c,t);case"MultiLineString":return i<0&&(i=u.length+i),s<0&&(s=u[i].length+s-1),n.lineString([u[i][s],u[i][s+1]],c,t);case"MultiPolygon":return i<0&&(i=u.length+i),a<0&&(a=u[i].length+a),s<0&&(s=u[i][a].length-s-1),n.lineString([u[i][a][s],u[i][a][s+1]],c,t)}throw new Error("geojson is invalid")},t.flattenEach=c,t.flattenReduce=function(e,t,r){var n=r;return c(e,function(e,o,i){n=0===o&&0===i&&void 0===r?e:t(n,e,o,i)}),n},t.geomEach=s,t.geomReduce=function(e,t,r){var n=r;return s(e,function(e,o,i,a,s){n=0===o&&void 0===r?e:t(n,e,o,i,a,s)}),n},t.lineEach=l,t.lineReduce=function(e,t,r){var n=r;return l(e,function(e,o,i,a){n=0===o&&void 0===r?e:t(n,e,o,i,a)}),n},t.propEach=i,t.propReduce=function(e,t,r){var n=r;return i(e,function(e,o){n=0===o&&void 0===r?e:t(n,e,o)}),n},t.segmentEach=u,t.segmentReduce=function(e,t,r){var n=r,o=!1;return u(e,function(e,i,a,s,c){n=!1===o&&void 0===r?e:t(n,e,i,a,s,c),o=!0}),n}},628:e=>{e.exports.RADIUS=6378137,e.exports.FLATTENING=1/298.257223563,e.exports.POLAR_RADIUS=6356752.3142},778:(e,t,r)=>{var n=r(628);function o(e){var t=0;if(e&&e.length>0){t+=Math.abs(i(e[0]));for(var r=1;r<e.length;r++)t-=Math.abs(i(e[r]))}return t}function i(e){var t,r,o,i,s,c,u=0,l=e.length;if(l>2){for(c=0;c<l;c++)c===l-2?(o=l-2,i=l-1,s=0):c===l-1?(o=l-1,i=0,s=1):(o=c,i=c+1,s=c+2),t=e[o],r=e[i],u+=(a(e[s][0])-a(t[0]))*Math.sin(a(r[1]));u=u*n.RADIUS*n.RADIUS/2}return u}function a(e){return e*Math.PI/180}e.exports.geometry=function e(t){var r,n=0;switch(t.type){case"Polygon":return o(t.coordinates);case"MultiPolygon":for(r=0;r<t.coordinates.length;r++)n+=o(t.coordinates[r]);return n;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(r=0;r<t.geometries.length;r++)n+=e(t.geometries[r]);return n}},e.exports.ring=i},846:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=6371008.8,n={centimeters:637100880,centimetres:637100880,degrees:360/(2*Math.PI),feet:20902260.511392,inches:39.37*r,kilometers:6371.0088,kilometres:6371.0088,meters:r,metres:r,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:r/1852,radians:1,yards:6967335.223679999},o={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:2.9155334959812285e-7,millimeters:1e6,millimetres:1e6,yards:1.195990046};function i(e,t,r={}){const n={type:"Feature"};return(0===r.id||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=t||{},n.geometry=e,n}function a(e,t,r={}){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!y(e[0])||!y(e[1]))throw new Error("coordinates must contain numbers");return i({type:"Point",coordinates:e},t,r)}function s(e,t,r={}){for(const t of e){if(t.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(t[t.length-1].length!==t[0].length)throw new Error("First and last Position are not equivalent.");for(let e=0;e<t[t.length-1].length;e++)if(t[t.length-1][e]!==t[0][e])throw new Error("First and last Position are not equivalent.")}return i({type:"Polygon",coordinates:e},t,r)}function c(e,t,r={}){if(e.length<2)throw new Error("coordinates must be an array of two or more positions");return i({type:"LineString",coordinates:e},t,r)}function u(e,t={}){const r={type:"FeatureCollection"};return t.id&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.features=e,r}function l(e,t,r={}){return i({type:"MultiLineString",coordinates:e},t,r)}function d(e,t,r={}){return i({type:"MultiPoint",coordinates:e},t,r)}function p(e,t,r={}){return i({type:"MultiPolygon",coordinates:e},t,r)}function h(e,t="kilometers"){const r=n[t];if(!r)throw new Error(t+" units is invalid");return e*r}function f(e,t="kilometers"){const r=n[t];if(!r)throw new Error(t+" units is invalid");return e/r}function g(e){return e%(2*Math.PI)*180/Math.PI}function y(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}t.areaFactors=o,t.azimuthToBearing=function(e){return(e%=360)>180?e-360:e<-180?e+360:e},t.bearingToAzimuth=function(e){let t=e%360;return t<0&&(t+=360),t},t.convertArea=function(e,t="meters",r="kilometers"){if(!(e>=0))throw new Error("area must be a positive number");const n=o[t];if(!n)throw new Error("invalid original units");const i=o[r];if(!i)throw new Error("invalid final units");return e/n*i},t.convertLength=function(e,t="kilometers",r="kilometers"){if(!(e>=0))throw new Error("length must be a positive number");return h(f(e,t),r)},t.degreesToRadians=function(e){return e%360*Math.PI/180},t.earthRadius=r,t.factors=n,t.feature=i,t.featureCollection=u,t.geometry=function(e,t,r={}){switch(e){case"Point":return a(t).geometry;case"LineString":return c(t).geometry;case"Polygon":return s(t).geometry;case"MultiPoint":return d(t).geometry;case"MultiLineString":return l(t).geometry;case"MultiPolygon":return p(t).geometry;default:throw new Error(e+" is invalid")}},t.geometryCollection=function(e,t,r={}){return i({type:"GeometryCollection",geometries:e},t,r)},t.isNumber=y,t.isObject=function(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)},t.lengthToDegrees=function(e,t){return g(f(e,t))},t.lengthToRadians=f,t.lineString=c,t.lineStrings=function(e,t,r={}){return u(e.map(e=>c(e,t)),r)},t.multiLineString=l,t.multiPoint=d,t.multiPolygon=p,t.point=a,t.points=function(e,t,r={}){return u(e.map(e=>a(e,t)),r)},t.polygon=s,t.polygons=function(e,t,r={}){return u(e.map(e=>s(e,t)),r)},t.radiansToDegrees=g,t.radiansToLength=h,t.round=function(e,t=0){if(t&&!(t>=0))throw new Error("precision must be a positive number");const r=Math.pow(10,t||0);return Math.round(e*r)/r},t.validateBBox=function(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(4!==e.length&&6!==e.length)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(e=>{if(!y(e))throw new Error("bbox must only contain numbers")})},t.validateId=function(e){if(!e)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof e))throw new Error("id must be a number or a string")}},945:(e,t,r)=>{var n=r(341),o=r(339),i=r(609),a=r(368).Ay,s=i.featureEach,c=(i.coordEach,o.polygon,o.featureCollection);function u(e){var t=new n(e);return t.insert=function(e){if("Feature"!==e.type)throw new Error("invalid feature");return e.bbox=e.bbox?e.bbox:a(e),n.prototype.insert.call(this,e)},t.load=function(e){var t=[];return Array.isArray(e)?e.forEach(function(e){if("Feature"!==e.type)throw new Error("invalid features");e.bbox=e.bbox?e.bbox:a(e),t.push(e)}):s(e,function(e){if("Feature"!==e.type)throw new Error("invalid features");e.bbox=e.bbox?e.bbox:a(e),t.push(e)}),n.prototype.load.call(this,t)},t.remove=function(e,t){if("Feature"!==e.type)throw new Error("invalid feature");return e.bbox=e.bbox?e.bbox:a(e),n.prototype.remove.call(this,e,t)},t.clear=function(){return n.prototype.clear.call(this)},t.search=function(e){var t=n.prototype.search.call(this,this.toBBox(e));return c(t)},t.collides=function(e){return n.prototype.collides.call(this,this.toBBox(e))},t.all=function(){var e=n.prototype.all.call(this);return c(e)},t.toJSON=function(){return n.prototype.toJSON.call(this)},t.fromJSON=function(e){return n.prototype.fromJSON.call(this,e)},t.toBBox=function(e){var t;if(e.bbox)t=e.bbox;else if(Array.isArray(e)&&4===e.length)t=e;else if(Array.isArray(e)&&6===e.length)t=[e[0],e[1],e[3],e[4]];else if("Feature"===e.type)t=a(e);else{if("FeatureCollection"!==e.type)throw new Error("invalid geojson");t=a(e)}return{minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]}},t}e.exports=u,e.exports.default=u}}]);
export const __webpack_id__="im-draw-ml-plugin";export const __webpack_ids__=["im-draw-ml-plugin"];export const __webpack_modules__={"./node_modules/@mapbox/geojson-area/index.js":(e,t,n)=>{var r=n("./node_modules/wgs84/index.js");function o(e){var t=0;if(e&&e.length>0){t+=Math.abs(i(e[0]));for(var n=1;n<e.length;n++)t-=Math.abs(i(e[n]))}return t}function i(e){var t,n,o,i,s,c,u=0,l=e.length;if(l>2){for(c=0;c<l;c++)c===l-2?(o=l-2,i=l-1,s=0):c===l-1?(o=l-1,i=0,s=1):(o=c,i=c+1,s=c+2),t=e[o],n=e[i],u+=(a(e[s][0])-a(t[0]))*Math.sin(a(n[1]));u=u*r.RADIUS*r.RADIUS/2}return u}function a(e){return e*Math.PI/180}e.exports.geometry=function e(t){var n,r=0;switch(t.type){case"Polygon":return o(t.coordinates);case"MultiPolygon":for(n=0;n<t.coordinates.length;n++)r+=o(t.coordinates[n]);return r;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(n=0;n<t.geometries.length;n++)r+=e(t.geometries[n]);return r}},e.exports.ring=i},"./node_modules/@mapbox/geojson-normalize/index.js":e=>{e.exports=function(e){if(!e||!e.type)return null;var n=t[e.type];return n?"geometry"===n?{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:e}]}:"feature"===n?{type:"FeatureCollection",features:[e]}:"featurecollection"===n?e:void 0:null};var t={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"}},"./node_modules/fast-deep-equal/index.js":e=>{e.exports=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var r,o,i;if(Array.isArray(t)){if((r=t.length)!=n.length)return!1;for(o=r;0!==o--;)if(!e(t[o],n[o]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((r=(i=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(o=r;0!==o--;)if(!Object.prototype.hasOwnProperty.call(n,i[o]))return!1;for(o=r;0!==o--;){var a=i[o];if(!e(t[a],n[a]))return!1}return!0}return t!=t&&n!=n}},"./node_modules/wgs84/index.js":e=>{e.exports.RADIUS=6378137,e.exports.FLATTENING=1/298.257223563,e.exports.POLAR_RADIUS=6356752.3142},"./plugins/draw-ml/src/manifest.js":(e,t,n)=>{n.r(t),n.d(t,{manifest:()=>yr});var r={};n.r(r),n.d(r,{LAT_MAX:()=>C,LAT_MIN:()=>I,LAT_RENDERED_MAX:()=>_,LAT_RENDERED_MIN:()=>O,LNG_MAX:()=>P,LNG_MIN:()=>M,activeStates:()=>T,classes:()=>f,cursors:()=>y,events:()=>b,geojsonTypes:()=>v,interactions:()=>w,meta:()=>x,modes:()=>E,sources:()=>g,types:()=>m,updateActions:()=>S});var o={};n.r(o),n.d(o,{isActiveFeature:()=>Ie,isEnterKey:()=>Ae,isEscapeKey:()=>Le,isFeature:()=>_e,isInactiveFeature:()=>Oe,isOfMetaType:()=>Te,isShiftDown:()=>Pe,isShiftMousedown:()=>we,isTrue:()=>Ne,isVertex:()=>Me,noTarget:()=>Ce});var i={};function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach(function(t){u(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function u(e,t,n){return(t=function(e){var t=function(e){if("object"!=a(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==a(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.r(i),n.d(i,{CommonSelectors:()=>o,ModeHandler:()=>p,StringSet:()=>V,constrainFeatureMovement:()=>qe,createMidPoint:()=>De,createSupplementaryPoints:()=>Re,createVertex:()=>Ve,doubleClickZoom:()=>je,euclideanDistance:()=>B,featuresAt:()=>R,getFeatureAtAndSetCursors:()=>U,isClick:()=>H,isEventAtCoordinates:()=>nt,isTap:()=>W,mapEventToBoundingBox:()=>F,moveFeatures:()=>Ye,sortFeatures:()=>N,stringSetsAreEqual:()=>ht,theme:()=>xe,toDenseArray:()=>he});var l={SET_MODE:function(e,t){return c(c({},e),{},{mode:t})},SET_FEATURE:function(e,t){return c(c({},e),{},{feature:void 0===t.feature?e.feature:t.feature,tempFeature:void 0===t.tempFeature?e.tempFeature:t.tempFeature})},SET_SELECTED_VERTEX_INDEX:function(e,t){return c(c({},e),{},{selectedVertexIndex:t.index,numVertecies:t.numVertecies})},TOGGLE_SNAP:function(e){return c(c({},e),{},{snap:!e.snap})}},d=n("react");const p=function(e,t){const n={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},r={on(e,t,r){if(void 0===n[e])throw new Error(`Invalid event type: ${e}`);n[e].push({selector:t,fn:r})},render(e){t.store.featureChanged(e)}},o=function(e,o){const i=n[e];let a=i.length;for(;a--;){const e=i[a];if(e.selector(o)){e.fn.call(r,o)||t.store.render(),t.ui.updateMapClasses();break}}};return e.start.call(r),{render:e.render,stop(){e.stop&&e.stop()},trash(){e.trash&&(e.trash(),t.store.render())},combineFeatures(){e.combineFeatures&&e.combineFeatures()},uncombineFeatures(){e.uncombineFeatures&&e.uncombineFeatures()},drag(e){o("drag",e)},click(e){o("click",e)},mousemove(e){o("mousemove",e)},mousedown(e){o("mousedown",e)},mouseup(e){o("mouseup",e)},mouseout(e){o("mouseout",e)},keydown(e){o("keydown",e)},keyup(e){o("keyup",e)},touchstart(e){o("touchstart",e)},touchmove(e){o("touchmove",e)},touchend(e){o("touchend",e)},tap(e){o("tap",e)}}};var h=n("./node_modules/@mapbox/geojson-area/index.js");const f={CANVAS:"mapboxgl-canvas",CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},g={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},y={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},m={POLYGON:"polygon",LINE:"line_string",POINT:"point"},v={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},E={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select"},b={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},S={MOVE:"move",CHANGE_PROPERTIES:"change_properties",CHANGE_COORDINATES:"change_coordinates"},x={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},T={ACTIVE:"true",INACTIVE:"false"},w=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],I=-90,O=-85,C=90,_=85,M=-270,P=270,L={Point:0,LineString:1,MultiLineString:1,Polygon:2};function A(e,t){const n=L[e.geometry.type]-L[t.geometry.type];return 0===n&&e.geometry.type===v.POLYGON?e.area-t.area:n}const N=function(e){return e.map(e=>(e.geometry.type===v.POLYGON&&(e.area=h.geometry({type:v.FEATURE,property:{},geometry:e.geometry})),e)).sort(A).map(e=>(delete e.area,e))},F=function(e,t=0){return[[e.point.x-t,e.point.y-t],[e.point.x+t,e.point.y+t]]};function k(e){if(this._items={},this._nums={},this._length=e?e.length:0,e)for(let t=0,n=e.length;t<n;t++)this.add(e[t]),void 0!==e[t]&&("string"==typeof e[t]?this._items[e[t]]=t:this._nums[e[t]]=t)}k.prototype.add=function(e){return this.has(e)||(this._length++,"string"==typeof e?this._items[e]=this._length:this._nums[e]=this._length),this},k.prototype.delete=function(e){return!1===this.has(e)||(this._length--,delete this._items[e],delete this._nums[e]),this},k.prototype.has=function(e){return!("string"!=typeof e&&"number"!=typeof e||void 0===this._items[e]&&void 0===this._nums[e])},k.prototype.values=function(){const e=[];return Object.keys(this._items).forEach(t=>{e.push({k:t,v:this._items[t]})}),Object.keys(this._nums).forEach(t=>{e.push({k:JSON.parse(t),v:this._nums[t]})}),e.sort((e,t)=>e.v-t.v).map(e=>e.k)},k.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};const V=k,D=[x.FEATURE,x.MIDPOINT,x.VERTEX],R={click:function(e,t,n){return j(e,t,n,n.options.clickBuffer)},touch:function(e,t,n){return j(e,t,n,n.options.touchBuffer)}};function j(e,t,n,r){if(null===n.map)return[];const o=e?F(e,r):t,i={};n.options.styles&&(i.layers=n.options.styles.map(e=>e.id).filter(e=>null!=n.map.getLayer(e)));const a=n.map.queryRenderedFeatures(o,i).filter(e=>-1!==D.indexOf(e.properties.meta)),s=new V,c=[];return a.forEach(e=>{const t=e.properties.id;s.has(t)||(s.add(t),c.push(e))}),N(c)}function U(e,t){const n=R.click(e,null,t),r={mouse:y.NONE};return n[0]&&(r.mouse=n[0].properties.active===T.ACTIVE?y.MOVE:y.POINTER,r.feature=n[0].properties.meta),-1!==t.events.currentModeName().indexOf("draw")&&(r.mouse=y.ADD),t.ui.queueMapClasses(r),t.ui.updateMapClasses(),n[0]}function B(e,t){const n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)}const G=4,$=12,J=500;function H(e,t,n={}){const r=null!=n.fineTolerance?n.fineTolerance:G,o=null!=n.grossTolerance?n.grossTolerance:$,i=null!=n.interval?n.interval:J;e.point=e.point||t.point,e.time=e.time||t.time;const a=B(e.point,t.point);return a<r||a<o&&t.time-e.time<i}const q=25,Y=250;function W(e,t,n={}){const r=null!=n.tolerance?n.tolerance:q,o=null!=n.interval?n.interval:Y;return e.point=e.point||t.point,e.time=e.time||t.time,B(e.point,t.point)<r&&t.time-e.time<o}const X=((e,t=21)=>(n=t)=>{let r="",o=0|n;for(;o--;)r+=e[Math.random()*e.length|0];return r})("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",32);function K(){return X()}const Z=function(e,t){this.ctx=e,this.properties=t.properties||{},this.coordinates=t.geometry.coordinates,this.id=t.id||K(),this.type=t.geometry.type};Z.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},Z.prototype.incomingCoords=function(e){this.setCoordinates(e)},Z.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()},Z.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},Z.prototype.setProperty=function(e,t){this.properties[e]=t},Z.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:v.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},Z.prototype.internal=function(e){const t={id:this.id,meta:x.FEATURE,"meta:type":this.type,active:T.INACTIVE,mode:e};if(this.ctx.options.userProperties)for(const e in this.properties)t[`user_${e}`]=this.properties[e];return{type:v.FEATURE,properties:t,geometry:{coordinates:this.getCoordinates(),type:this.type}}};const z=Z,Q=function(e,t){z.call(this,e,t)};(Q.prototype=Object.create(z.prototype)).isValid=function(){return"number"==typeof this.coordinates[0]&&"number"==typeof this.coordinates[1]},Q.prototype.updateCoordinate=function(e,t,n){this.coordinates=3===arguments.length?[t,n]:[e,t],this.changed()},Q.prototype.getCoordinate=function(){return this.getCoordinates()};const ee=Q,te=function(e,t){z.call(this,e,t)};(te.prototype=Object.create(z.prototype)).isValid=function(){return this.coordinates.length>1},te.prototype.addCoordinate=function(e,t,n){this.changed();const r=parseInt(e,10);this.coordinates.splice(r,0,[t,n])},te.prototype.getCoordinate=function(e){const t=parseInt(e,10);return JSON.parse(JSON.stringify(this.coordinates[t]))},te.prototype.removeCoordinate=function(e){this.changed(),this.coordinates.splice(parseInt(e,10),1)},te.prototype.updateCoordinate=function(e,t,n){const r=parseInt(e,10);this.coordinates[r]=[t,n],this.changed()};const ne=te,re=function(e,t){z.call(this,e,t),this.coordinates=this.coordinates.map(e=>e.slice(0,-1))};(re.prototype=Object.create(z.prototype)).isValid=function(){return 0!==this.coordinates.length&&this.coordinates.every(e=>e.length>2)},re.prototype.incomingCoords=function(e){this.coordinates=e.map(e=>e.slice(0,-1)),this.changed()},re.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()},re.prototype.addCoordinate=function(e,t,n){this.changed();const r=e.split(".").map(e=>parseInt(e,10));this.coordinates[r[0]].splice(r[1],0,[t,n])},re.prototype.removeCoordinate=function(e){this.changed();const t=e.split(".").map(e=>parseInt(e,10)),n=this.coordinates[t[0]];n&&(n.splice(t[1],1),n.length<3&&this.coordinates.splice(t[0],1))},re.prototype.getCoordinate=function(e){const t=e.split(".").map(e=>parseInt(e,10)),n=this.coordinates[t[0]];return JSON.parse(JSON.stringify(n[t[1]]))},re.prototype.getCoordinates=function(){return this.coordinates.map(e=>e.concat([e[0]]))},re.prototype.updateCoordinate=function(e,t,n){this.changed();const r=e.split("."),o=parseInt(r[0],10),i=parseInt(r[1],10);void 0===this.coordinates[o]&&(this.coordinates[o]=[]),this.coordinates[o][i]=[t,n]};const oe=re,ie={MultiPoint:ee,MultiLineString:ne,MultiPolygon:oe},ae=(e,t,n,r,o)=>{const i=n.split("."),a=parseInt(i[0],10),s=i[1]?i.slice(1).join("."):null;return e[a][t](s,r,o)},se=function(e,t){if(z.call(this,e,t),delete this.coordinates,this.model=ie[t.geometry.type],void 0===this.model)throw new TypeError(`${t.geometry.type} is not a valid type`);this.features=this._coordinatesToFeatures(t.geometry.coordinates)};(se.prototype=Object.create(z.prototype))._coordinatesToFeatures=function(e){const t=this.model.bind(this);return e.map(e=>new t(this.ctx,{id:K(),type:v.FEATURE,properties:{},geometry:{coordinates:e,type:this.type.replace("Multi","")}}))},se.prototype.isValid=function(){return this.features.every(e=>e.isValid())},se.prototype.setCoordinates=function(e){this.features=this._coordinatesToFeatures(e),this.changed()},se.prototype.getCoordinate=function(e){return ae(this.features,"getCoordinate",e)},se.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(e=>e.type===v.POLYGON?e.getCoordinates():e.coordinates)))},se.prototype.updateCoordinate=function(e,t,n){ae(this.features,"updateCoordinate",e,t,n),this.changed()},se.prototype.addCoordinate=function(e,t,n){ae(this.features,"addCoordinate",e,t,n),this.changed()},se.prototype.removeCoordinate=function(e){ae(this.features,"removeCoordinate",e),this.changed()},se.prototype.getFeatures=function(){return this.features};const ce=se;function ue(e){this.map=e.map,this.drawConfig=JSON.parse(JSON.stringify(e.options||{})),this._ctx=e}ue.prototype.setSelected=function(e){return this._ctx.store.setSelected(e)},ue.prototype.setSelectedCoordinates=function(e){this._ctx.store.setSelectedCoordinates(e),e.reduce((e,t)=>(void 0===e[t.feature_id]&&(e[t.feature_id]=!0,this._ctx.store.get(t.feature_id).changed()),e),{})},ue.prototype.getSelected=function(){return this._ctx.store.getSelected()},ue.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},ue.prototype.isSelected=function(e){return this._ctx.store.isSelected(e)},ue.prototype.getFeature=function(e){return this._ctx.store.get(e)},ue.prototype.select=function(e){return this._ctx.store.select(e)},ue.prototype.deselect=function(e){return this._ctx.store.deselect(e)},ue.prototype.deleteFeature=function(e,t={}){return this._ctx.store.delete(e,t)},ue.prototype.addFeature=function(e,t={}){return this._ctx.store.add(e,t)},ue.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},ue.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},ue.prototype.setActionableState=function(e={}){const t={trash:e.trash||!1,combineFeatures:e.combineFeatures||!1,uncombineFeatures:e.uncombineFeatures||!1};return this._ctx.events.actionable(t)},ue.prototype.changeMode=function(e,t={},n={}){return this._ctx.events.changeMode(e,t,n)},ue.prototype.fire=function(e,t){return this._ctx.events.fire(e,t)},ue.prototype.updateUIClasses=function(e){return this._ctx.ui.queueMapClasses(e)},ue.prototype.activateUIButton=function(e){return this._ctx.ui.setActiveButton(e)},ue.prototype.featuresAt=function(e,t,n="click"){if("click"!==n&&"touch"!==n)throw new Error("invalid buffer type");return R[n](e,t,this._ctx)},ue.prototype.newFeature=function(e){const t=e.geometry.type;return t===v.POINT?new ee(this._ctx,e):t===v.LINE_STRING?new ne(this._ctx,e):t===v.POLYGON?new oe(this._ctx,e):new ce(this._ctx,e)},ue.prototype.isInstanceOf=function(e,t){if(e===v.POINT)return t instanceof ee;if(e===v.LINE_STRING)return t instanceof ne;if(e===v.POLYGON)return t instanceof oe;if("MultiFeature"===e)return t instanceof ce;throw new Error(`Unknown feature class: ${e}`)},ue.prototype.doRender=function(e){return this._ctx.store.featureChanged(e)};const le=ue;ue.prototype.onSetup=function(){},ue.prototype.onDrag=function(){},ue.prototype.onClick=function(){},ue.prototype.onMouseMove=function(){},ue.prototype.onMouseDown=function(){},ue.prototype.onMouseUp=function(){},ue.prototype.onMouseOut=function(){},ue.prototype.onKeyUp=function(){},ue.prototype.onKeyDown=function(){},ue.prototype.onTouchStart=function(){},ue.prototype.onTouchMove=function(){},ue.prototype.onTouchEnd=function(){},ue.prototype.onTap=function(){},ue.prototype.onStop=function(){},ue.prototype.onTrash=function(){},ue.prototype.onCombineFeature=function(){},ue.prototype.onUncombineFeature=function(){},ue.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};const de={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},pe=Object.keys(de);const he=function(e){return[].concat(e).filter(e=>void 0!==e)};function fe(){const e=this;if(!e.ctx.map||void 0===e.ctx.map.getSource(g.HOT))return s();const t=e.ctx.events.currentModeName();e.ctx.ui.queueMapClasses({mode:t});let n=[],r=[];e.isDirty?r=e.getAllIds():(n=e.getChangedIds().filter(t=>void 0!==e.get(t)),r=e.sources.hot.filter(t=>t.properties.id&&-1===n.indexOf(t.properties.id)&&void 0!==e.get(t.properties.id)).map(e=>e.properties.id)),e.sources.hot=[];const o=e.sources.cold.length;e.sources.cold=e.isDirty?[]:e.sources.cold.filter(e=>{const t=e.properties.id||e.properties.parent;return-1===n.indexOf(t)});const i=o!==e.sources.cold.length||r.length>0;function a(n,r){const o=e.get(n).internal(t);e.ctx.events.currentModeRender(o,n=>{n.properties.mode=t,e.sources[r].push(n)})}function s(){e.isDirty=!1,e.clearChangedIds()}n.forEach(e=>a(e,"hot")),r.forEach(e=>a(e,"cold")),i&&e.ctx.map.getSource(g.COLD).setData({type:v.FEATURE_COLLECTION,features:e.sources.cold}),e.ctx.map.getSource(g.HOT).setData({type:v.FEATURE_COLLECTION,features:e.sources.hot}),s()}function ge(e){let t;this._features={},this._featureIds=new V,this._selectedFeatureIds=new V,this._selectedCoordinates=[],this._changedFeatureIds=new V,this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=e,this.sources={hot:[],cold:[]},this.render=()=>{t||(t=requestAnimationFrame(()=>{t=null,fe.call(this),this._emitSelectionChange&&(this.ctx.events.fire(b.SELECTION_CHANGE,{features:this.getSelected().map(e=>e.toGeoJSON()),points:this.getSelectedCoordinates().map(e=>({type:v.FEATURE,properties:{},geometry:{type:v.POINT,coordinates:e.coordinates}}))}),this._emitSelectionChange=!1),this.ctx.events.fire(b.RENDER,{})}))},this.isDirty=!1}function ye(e,t={}){const n=e._selectedCoordinates.filter(t=>e._selectedFeatureIds.has(t.feature_id));e._selectedCoordinates.length===n.length||t.silent||(e._emitSelectionChange=!0),e._selectedCoordinates=n}ge.prototype.createRenderBatch=function(){const e=this.render;let t=0;return this.render=function(){t++},()=>{this.render=e,t>0&&this.render()}},ge.prototype.setDirty=function(){return this.isDirty=!0,this},ge.prototype.featureCreated=function(e,t={}){if(this._changedFeatureIds.add(e),!0!==(null!=t.silent?t.silent:this.ctx.options.suppressAPIEvents)){const t=this.get(e);this.ctx.events.fire(b.CREATE,{features:[t.toGeoJSON()]})}return this},ge.prototype.featureChanged=function(e,t={}){return this._changedFeatureIds.add(e),!0!==(null!=t.silent?t.silent:this.ctx.options.suppressAPIEvents)&&this.ctx.events.fire(b.UPDATE,{action:t.action?t.action:S.CHANGE_COORDINATES,features:[this.get(e).toGeoJSON()]}),this},ge.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},ge.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},ge.prototype.getAllIds=function(){return this._featureIds.values()},ge.prototype.add=function(e,t={}){return this._features[e.id]=e,this._featureIds.add(e.id),this.featureCreated(e.id,{silent:t.silent}),this},ge.prototype.delete=function(e,t={}){const n=[];return he(e).forEach(e=>{this._featureIds.has(e)&&(this._featureIds.delete(e),this._selectedFeatureIds.delete(e),t.silent||-1===n.indexOf(this._features[e])&&n.push(this._features[e].toGeoJSON()),delete this._features[e],this.isDirty=!0)}),n.length&&this.ctx.events.fire(b.DELETE,{features:n}),ye(this,t),this},ge.prototype.get=function(e){return this._features[e]},ge.prototype.getAll=function(){return Object.keys(this._features).map(e=>this._features[e])},ge.prototype.select=function(e,t={}){return he(e).forEach(e=>{this._selectedFeatureIds.has(e)||(this._selectedFeatureIds.add(e),this._changedFeatureIds.add(e),t.silent||(this._emitSelectionChange=!0))}),this},ge.prototype.deselect=function(e,t={}){return he(e).forEach(e=>{this._selectedFeatureIds.has(e)&&(this._selectedFeatureIds.delete(e),this._changedFeatureIds.add(e),t.silent||(this._emitSelectionChange=!0))}),ye(this,t),this},ge.prototype.clearSelected=function(e={}){return this.deselect(this._selectedFeatureIds.values(),{silent:e.silent}),this},ge.prototype.setSelected=function(e,t={}){return e=he(e),this.deselect(this._selectedFeatureIds.values().filter(t=>-1===e.indexOf(t)),{silent:t.silent}),this.select(e.filter(e=>!this._selectedFeatureIds.has(e)),{silent:t.silent}),this},ge.prototype.setSelectedCoordinates=function(e){return this._selectedCoordinates=e,this._emitSelectionChange=!0,this},ge.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},ge.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},ge.prototype.getSelected=function(){return this.getSelectedIds().map(e=>this.get(e))},ge.prototype.getSelectedCoordinates=function(){return this._selectedCoordinates.map(e=>({coordinates:this.get(e.feature_id).getCoordinate(e.coord_path)}))},ge.prototype.isSelected=function(e){return this._selectedFeatureIds.has(e)},ge.prototype.setFeatureProperty=function(e,t,n,r={}){this.get(e).setProperty(t,n),this.featureChanged(e,{silent:r.silent,action:S.CHANGE_PROPERTIES})},ge.prototype.storeMapConfig=function(){w.forEach(e=>{this.ctx.map[e]&&(this._mapInitialConfig[e]=this.ctx.map[e].isEnabled())})},ge.prototype.restoreMapConfig=function(){Object.keys(this._mapInitialConfig).forEach(e=>{this._mapInitialConfig[e]?this.ctx.map[e].enable():this.ctx.map[e].disable()})},ge.prototype.getInitialConfigValue=function(e){return void 0===this._mapInitialConfig[e]||this._mapInitialConfig[e]};const me=["mode","feature","mouse"];function ve(e){let t=null,n=null;const r={onRemove(){return e.map.off("load",r.connect),clearInterval(n),r.removeLayers(),e.store.restoreMapConfig(),e.ui.removeButtons(),e.events.removeEventListeners(),e.ui.clearMapClasses(),e.boxZoomInitial&&e.map.boxZoom.enable(),e.map=null,e.container=null,e.store=null,t&&t.parentNode&&t.parentNode.removeChild(t),t=null,this},connect(){e.map.off("load",r.connect),clearInterval(n),r.addLayers(),e.store.storeMapConfig(),e.events.addEventListeners()},onAdd(o){if(e.map=o,e.events=function(e){const t=Object.keys(e.options.modes).reduce((t,n)=>(t[n]=function(e){const t=Object.keys(e);return function(n,r={}){let o={};const i=t.reduce((t,n)=>(t[n]=e[n],t),new le(n));return{start(){o=i.onSetup(r),pe.forEach(t=>{const n=de[t];let r=()=>!1;var a;e[n]&&(r=()=>!0),this.on(t,r,(a=n,e=>i[a](o,e)))})},stop(){i.onStop(o)},trash(){i.onTrash(o)},combineFeatures(){i.onCombineFeatures(o)},uncombineFeatures(){i.onUncombineFeatures(o)},render(e,t){i.toDisplayFeatures(o,e,t)}}}}(e.options.modes[n]),t),{});let n={},r={};const o={};let i=null,a=null;o.drag=function(t,n){n({point:t.point,time:(new Date).getTime()})?(e.ui.queueMapClasses({mouse:y.DRAG}),a.drag(t)):t.originalEvent.stopPropagation()},o.mousedrag=function(e){o.drag(e,e=>!H(n,e))},o.touchdrag=function(e){o.drag(e,e=>!W(r,e))},o.mousemove=function(t){if(1===(void 0!==t.originalEvent.buttons?t.originalEvent.buttons:t.originalEvent.which))return o.mousedrag(t);const n=U(t,e);t.featureTarget=n,a.mousemove(t)},o.mousedown=function(t){n={time:(new Date).getTime(),point:t.point};const r=U(t,e);t.featureTarget=r,a.mousedown(t)},o.mouseup=function(t){const r=U(t,e);t.featureTarget=r,H(n,{point:t.point,time:(new Date).getTime()})?a.click(t):a.mouseup(t)},o.mouseout=function(e){a.mouseout(e)},o.touchstart=function(t){if(!e.options.touchEnabled)return;r={time:(new Date).getTime(),point:t.point};const n=R.touch(t,null,e)[0];t.featureTarget=n,a.touchstart(t)},o.touchmove=function(t){if(e.options.touchEnabled)return a.touchmove(t),o.touchdrag(t)},o.touchend=function(t){if(t.originalEvent.preventDefault(),!e.options.touchEnabled)return;const n=R.touch(t,null,e)[0];t.featureTarget=n,W(r,{time:(new Date).getTime(),point:t.point})?a.tap(t):a.touchend(t)};const s=e=>!(8===e||46===e||e>=48&&e<=57);function c(n,r,o={}){a.stop();const s=t[n];if(void 0===s)throw new Error(`${n} is not valid`);i=n;const c=s(e,r);a=p(c,e),o.silent||e.map.fire(b.MODE_CHANGE,{mode:n}),e.store.setDirty(),e.store.render()}o.keydown=function(t){(t.srcElement||t.target).classList.contains(f.CANVAS)&&(8!==t.keyCode&&46!==t.keyCode||!e.options.controls.trash?s(t.keyCode)?a.keydown(t):49===t.keyCode&&e.options.controls.point?c(E.DRAW_POINT):50===t.keyCode&&e.options.controls.line_string?c(E.DRAW_LINE_STRING):51===t.keyCode&&e.options.controls.polygon&&c(E.DRAW_POLYGON):(t.preventDefault(),a.trash()))},o.keyup=function(e){s(e.keyCode)&&a.keyup(e)},o.zoomend=function(){e.store.changeZoom()},o.data=function(t){if("style"===t.dataType){const{setup:t,map:n,options:r,store:o}=e;r.styles.some(e=>n.getLayer(e.id))||(t.addLayers(),o.setDirty(),o.render())}};const u={trash:!1,combineFeatures:!1,uncombineFeatures:!1},l={start(){i=e.options.defaultMode,a=p(t[i](e),e)},changeMode:c,actionable:function(t){let n=!1;Object.keys(t).forEach(e=>{if(void 0===u[e])throw new Error("Invalid action type");u[e]!==t[e]&&(n=!0),u[e]=t[e]}),n&&e.map.fire(b.ACTIONABLE,{actions:u})},currentModeName:()=>i,currentModeRender:(e,t)=>a.render(e,t),fire(t,n){e.map&&e.map.fire(t,n)},addEventListeners(){e.map.on("mousemove",o.mousemove),e.map.on("mousedown",o.mousedown),e.map.on("mouseup",o.mouseup),e.map.on("data",o.data),e.map.on("touchmove",o.touchmove),e.map.on("touchstart",o.touchstart),e.map.on("touchend",o.touchend),e.container.addEventListener("mouseout",o.mouseout),e.options.keybindings&&(e.container.addEventListener("keydown",o.keydown),e.container.addEventListener("keyup",o.keyup))},removeEventListeners(){e.map.off("mousemove",o.mousemove),e.map.off("mousedown",o.mousedown),e.map.off("mouseup",o.mouseup),e.map.off("data",o.data),e.map.off("touchmove",o.touchmove),e.map.off("touchstart",o.touchstart),e.map.off("touchend",o.touchend),e.container.removeEventListener("mouseout",o.mouseout),e.options.keybindings&&(e.container.removeEventListener("keydown",o.keydown),e.container.removeEventListener("keyup",o.keyup))},trash(e){a.trash(e)},combineFeatures(){a.combineFeatures()},uncombineFeatures(){a.uncombineFeatures()},getMode:()=>i};return l}(e),e.ui=function(e){const t={};let n=null,r={mode:null,feature:null,mouse:null},o={mode:null,feature:null,mouse:null};function i(e){o=Object.assign(o,e)}function a(){if(!e.container)return;const t=[],n=[];me.forEach(e=>{o[e]!==r[e]&&(t.push(`${e}-${r[e]}`),null!==o[e]&&n.push(`${e}-${o[e]}`))}),t.length>0&&e.container.classList.remove(...t),n.length>0&&e.container.classList.add(...n),r=Object.assign(r,o)}function s(e,t={}){const r=document.createElement("button");return r.className=`${f.CONTROL_BUTTON} ${t.className}`,r.setAttribute("title",t.title),t.container.appendChild(r),r.addEventListener("click",r=>{if(r.preventDefault(),r.stopPropagation(),r.target===n)return c(),void t.onDeactivate();u(e),t.onActivate()},!0),r}function c(){n&&(n.classList.remove(f.ACTIVE_BUTTON),n=null)}function u(e){c();const r=t[e];r&&r&&"trash"!==e&&(r.classList.add(f.ACTIVE_BUTTON),n=r)}return{setActiveButton:u,queueMapClasses:i,updateMapClasses:a,clearMapClasses:function(){i({mode:null,feature:null,mouse:null}),a()},addButtons:function(){const n=e.options.controls,r=document.createElement("div");return r.className=`${f.CONTROL_GROUP} ${f.CONTROL_BASE}`,n?(n[m.LINE]&&(t[m.LINE]=s(m.LINE,{container:r,className:f.CONTROL_BUTTON_LINE,title:"LineString tool "+(e.options.keybindings?"(l)":""),onActivate:()=>e.events.changeMode(E.DRAW_LINE_STRING),onDeactivate:()=>e.events.trash()})),n[m.POLYGON]&&(t[m.POLYGON]=s(m.POLYGON,{container:r,className:f.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(e.options.keybindings?"(p)":""),onActivate:()=>e.events.changeMode(E.DRAW_POLYGON),onDeactivate:()=>e.events.trash()})),n[m.POINT]&&(t[m.POINT]=s(m.POINT,{container:r,className:f.CONTROL_BUTTON_POINT,title:"Marker tool "+(e.options.keybindings?"(m)":""),onActivate:()=>e.events.changeMode(E.DRAW_POINT),onDeactivate:()=>e.events.trash()})),n.trash&&(t.trash=s("trash",{container:r,className:f.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:()=>{e.events.trash()}})),n.combine_features&&(t.combine_features=s("combineFeatures",{container:r,className:f.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:()=>{e.events.combineFeatures()}})),n.uncombine_features&&(t.uncombine_features=s("uncombineFeatures",{container:r,className:f.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:()=>{e.events.uncombineFeatures()}})),r):r},removeButtons:function(){Object.keys(t).forEach(e=>{const n=t[e];n.parentNode&&n.parentNode.removeChild(n),delete t[e]})}}}(e),e.container=o.getContainer(),e.store=new ge(e),t=e.ui.addButtons(),e.options.boxSelect){e.boxZoomInitial=o.boxZoom.isEnabled(),o.boxZoom.disable();const t=o.dragPan.isEnabled();o.dragPan.disable(),o.dragPan.enable(),t||o.dragPan.disable()}return o.loaded()?r.connect():(o.on("load",r.connect),n=setInterval(()=>{o.loaded()&&r.connect()},16)),e.events.start(),t},addLayers(){e.map.addSource(g.COLD,{data:{type:v.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.map.addSource(g.HOT,{data:{type:v.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.options.styles.forEach(t=>{e.map.addLayer(t)}),e.store.setDirty(!0),e.store.render()},removeLayers(){e.options.styles.forEach(t=>{e.map.getLayer(t.id)&&e.map.removeLayer(t.id)}),e.map.getSource(g.COLD)&&e.map.removeSource(g.COLD),e.map.getSource(g.HOT)&&e.map.removeSource(g.HOT)}};return e.setup=r,r}const Ee="#3bb2d0",be="#fbb03b",Se="#fff",xe=[{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"]],paint:{"fill-color":["case",["==",["get","active"],"true"],be,Ee],"fill-opacity":.1}},{id:"gl-draw-lines",type:"line",filter:["any",["==","$type","LineString"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["case",["==",["get","active"],"true"],be,Ee],"line-dasharray":["case",["==",["get","active"],"true"],[.2,2],[2,0]],"line-width":2}},{id:"gl-draw-point-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":Se}},{id:"gl-draw-point-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":["case",["==",["get","active"],"true"],be,Ee]}},{id:"gl-draw-vertex-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":Se}},{id:"gl-draw-vertex-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":be}},{id:"gl-draw-midpoint",type:"circle",filter:["all",["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":be}}];function Te(e){return function(t){const n=t.featureTarget;return!!n&&!!n.properties&&n.properties.meta===e}}function we(e){return!!e.originalEvent&&!!e.originalEvent.shiftKey&&0===e.originalEvent.button}function Ie(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.active===T.ACTIVE&&e.featureTarget.properties.meta===x.FEATURE}function Oe(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.active===T.INACTIVE&&e.featureTarget.properties.meta===x.FEATURE}function Ce(e){return void 0===e.featureTarget}function _e(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.meta===x.FEATURE}function Me(e){const t=e.featureTarget;return!!t&&!!t.properties&&t.properties.meta===x.VERTEX}function Pe(e){return!!e.originalEvent&&!0===e.originalEvent.shiftKey}function Le(e){return 27===e.keyCode}function Ae(e){return 13===e.keyCode}function Ne(){return!0}function Fe(e,t){this.x=e,this.y=t}Fe.prototype={clone(){return new Fe(this.x,this.y)},add(e){return this.clone()._add(e)},sub(e){return this.clone()._sub(e)},multByPoint(e){return this.clone()._multByPoint(e)},divByPoint(e){return this.clone()._divByPoint(e)},mult(e){return this.clone()._mult(e)},div(e){return this.clone()._div(e)},rotate(e){return this.clone()._rotate(e)},rotateAround(e,t){return this.clone()._rotateAround(e,t)},matMult(e){return this.clone()._matMult(e)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(e){return this.x===e.x&&this.y===e.y},dist(e){return Math.sqrt(this.distSqr(e))},distSqr(e){const t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith(e){return this.angleWithSep(e.x,e.y)},angleWithSep(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult(e){const t=e[0]*this.x+e[1]*this.y,n=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=n,this},_add(e){return this.x+=e.x,this.y+=e.y,this},_sub(e){return this.x-=e.x,this.y-=e.y,this},_mult(e){return this.x*=e,this.y*=e,this},_div(e){return this.x/=e,this.y/=e,this},_multByPoint(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint(e){return this.x/=e.x,this.y/=e.y,this},_unit(){return this._div(this.mag()),this},_perp(){const e=this.y;return this.y=this.x,this.x=-e,this},_rotate(e){const t=Math.cos(e),n=Math.sin(e),r=t*this.x-n*this.y,o=n*this.x+t*this.y;return this.x=r,this.y=o,this},_rotateAround(e,t){const n=Math.cos(e),r=Math.sin(e),o=t.x+n*(this.x-t.x)-r*(this.y-t.y),i=t.y+r*(this.x-t.x)+n*(this.y-t.y);return this.x=o,this.y=i,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Fe},Fe.convert=function(e){if(e instanceof Fe)return e;if(Array.isArray(e))return new Fe(+e[0],+e[1]);if(void 0!==e.x&&void 0!==e.y)return new Fe(+e.x,+e.y);throw new Error("Expected [x, y] or {x, y} point format")};const ke=function(e,t){const n=t.getBoundingClientRect();return new Fe(e.clientX-n.left-(t.clientLeft||0),e.clientY-n.top-(t.clientTop||0))};function Ve(e,t,n,r){return{type:v.FEATURE,properties:{meta:x.VERTEX,parent:e,coord_path:n,active:r?T.ACTIVE:T.INACTIVE},geometry:{type:v.POINT,coordinates:t}}}function De(e,t,n){const r=t.geometry.coordinates,o=n.geometry.coordinates;if(r[1]>_||r[1]<O||o[1]>_||o[1]<O)return null;const i={lng:(r[0]+o[0])/2,lat:(r[1]+o[1])/2};return{type:v.FEATURE,properties:{meta:x.MIDPOINT,parent:e,lng:i.lng,lat:i.lat,coord_path:n.properties.coord_path},geometry:{type:v.POINT,coordinates:[i.lng,i.lat]}}}const Re=function e(t,n={},r=null){const{type:o,coordinates:i}=t.geometry,a=t.properties&&t.properties.id;let s=[];function c(e,t){let r="",o=null;e.forEach((e,i)=>{const c=null!=t?`${t}.${i}`:String(i),l=Ve(a,e,c,u(c));if(n.midpoints&&o){const e=De(a,o,l);e&&s.push(e)}o=l;const d=JSON.stringify(e);r!==d&&s.push(l),0===i&&(r=d)})}function u(e){return!!n.selectedPaths&&-1!==n.selectedPaths.indexOf(e)}return o===v.POINT?s.push(Ve(a,i,r,u(r))):o===v.POLYGON?i.forEach((e,t)=>{c(e,null!==r?`${r}.${t}`:String(t))}):o===v.LINE_STRING?c(i,r):0===o.indexOf(v.MULTI_PREFIX)&&function(){const r=o.replace(v.MULTI_PREFIX,"");i.forEach((o,i)=>{const a={type:v.FEATURE,properties:t.properties,geometry:{type:r,coordinates:o}};s=s.concat(e(a,n,i))})}(),s},je={enable(e){setTimeout(()=>{e.map&&e.map.doubleClickZoom&&e._ctx&&e._ctx.store&&e._ctx.store.getInitialConfigValue&&e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()},0)},disable(e){setTimeout(()=>{e.map&&e.map.doubleClickZoom&&e.map.doubleClickZoom.disable()},0)}},{LAT_MIN:Ue,LAT_MAX:Be,LAT_RENDERED_MIN:Ge,LAT_RENDERED_MAX:$e,LNG_MIN:Je,LNG_MAX:He}=r;function qe(e,t){let n=Ue,r=Be,o=Ue,i=Be,a=He,s=Je;e.forEach(e=>{const t=function(e){const t={Point:0,LineString:1,Polygon:2,MultiPoint:1,MultiLineString:2,MultiPolygon:3}[e.geometry.type],n=[e.geometry.coordinates].flat(t),r=n.map(e=>e[0]),o=n.map(e=>e[1]),i=e=>Math.min.apply(null,e),a=e=>Math.max.apply(null,e);return[i(r),i(o),a(r),a(o)]}(e),c=t[1],u=t[3],l=t[0],d=t[2];c>n&&(n=c),u<r&&(r=u),u>o&&(o=u),c<i&&(i=c),l<a&&(a=l),d>s&&(s=d)});const c=t;return n+c.lat>$e&&(c.lat=$e-n),o+c.lat>Be&&(c.lat=Be-o),r+c.lat<Ge&&(c.lat=Ge-r),i+c.lat<Ue&&(c.lat=Ue-i),a+c.lng<=Je&&(c.lng+=360*Math.ceil(Math.abs(c.lng)/360)),s+c.lng>=He&&(c.lng-=360*Math.ceil(Math.abs(c.lng)/360)),c}function Ye(e,t){const n=qe(e.map(e=>e.toGeoJSON()),t);e.forEach(e=>{const t=e.getCoordinates(),r=e=>{const t={lng:e[0]+n.lng,lat:e[1]+n.lat};return[t.lng,t.lat]},o=e=>e.map(e=>r(e));let i;e.type===v.POINT?i=r(t):e.type===v.LINE_STRING||e.type===v.MULTI_POINT?i=t.map(r):e.type===v.POLYGON||e.type===v.MULTI_LINE_STRING?i=t.map(o):e.type===v.MULTI_POLYGON&&(i=t.map(e=>e.map(e=>o(e)))),e.incomingCoords(i)})}const We={onSetup:function(e){const t={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initialDragPanState:this.map.dragPan.isEnabled(),initiallySelectedFeatureIds:e.featureIds||[]};return this.setSelected(t.initiallySelectedFeatureIds.filter(e=>void 0!==this.getFeature(e))),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),t},fireUpdate:function(){this.fire(b.UPDATE,{action:S.MOVE,features:this.getSelected().map(e=>e.toGeoJSON())})},fireActionable:function(){const e=this.getSelected(),t=e.filter(e=>this.isInstanceOf("MultiFeature",e));let n=!1;if(e.length>1){n=!0;const t=e[0].type.replace("Multi","");e.forEach(e=>{e.type.replace("Multi","")!==t&&(n=!1)})}const r=t.length>0,o=e.length>0;this.setActionableState({combineFeatures:n,uncombineFeatures:r,trash:o})},getUniqueIds:function(e){return e.length?e.map(e=>e.properties.id).filter(e=>void 0!==e).reduce((e,t)=>(e.add(t),e),new V).values():[]},stopExtendedInteractions:function(e){e.boxSelectElement&&(e.boxSelectElement.parentNode&&e.boxSelectElement.parentNode.removeChild(e.boxSelectElement),e.boxSelectElement=null),(e.canDragMove||e.canBoxSelect)&&!0===e.initialDragPanState&&this.map.dragPan.enable(),e.boxSelecting=!1,e.canBoxSelect=!1,e.dragMoving=!1,e.canDragMove=!1},onStop:function(){je.enable(this)},onMouseMove:function(e,t){return _e(t)&&e.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(e),!0},onMouseOut:function(e){return!e.dragMoving||this.fireUpdate()}};We.onTap=We.onClick=function(e,t){return Ce(t)?this.clickAnywhere(e,t):Te(x.VERTEX)(t)?this.clickOnVertex(e,t):_e(t)?this.clickOnFeature(e,t):void 0},We.clickAnywhere=function(e){const t=this.getSelectedIds();t.length&&(this.clearSelectedFeatures(),t.forEach(e=>this.doRender(e))),je.enable(this),this.stopExtendedInteractions(e)},We.clickOnVertex=function(e,t){this.changeMode(E.DIRECT_SELECT,{featureId:t.featureTarget.properties.parent,coordPath:t.featureTarget.properties.coord_path,startPos:t.lngLat}),this.updateUIClasses({mouse:y.MOVE})},We.startOnActiveFeature=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),this.doRender(t.featureTarget.properties.id),e.canDragMove=!0,e.dragMoveLocation=t.lngLat},We.clickOnFeature=function(e,t){je.disable(this),this.stopExtendedInteractions(e);const n=Pe(t),r=this.getSelectedIds(),o=t.featureTarget.properties.id,i=this.isSelected(o);if(!n&&i&&this.getFeature(o).type!==v.POINT)return this.changeMode(E.DIRECT_SELECT,{featureId:o});i&&n?(this.deselect(o),this.updateUIClasses({mouse:y.POINTER}),1===r.length&&je.enable(this)):!i&&n?(this.select(o),this.updateUIClasses({mouse:y.MOVE})):i||n||(r.forEach(e=>this.doRender(e)),this.setSelected(o),this.updateUIClasses({mouse:y.MOVE})),this.doRender(o)},We.onMouseDown=function(e,t){return e.initialDragPanState=this.map.dragPan.isEnabled(),Ie(t)?this.startOnActiveFeature(e,t):this.drawConfig.boxSelect&&we(t)?this.startBoxSelect(e,t):void 0},We.startBoxSelect=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),e.boxSelectStartLocation=ke(t.originalEvent,this.map.getContainer()),e.canBoxSelect=!0},We.onTouchStart=function(e,t){if(Ie(t))return this.startOnActiveFeature(e,t)},We.onDrag=function(e,t){return e.canDragMove?this.dragMove(e,t):this.drawConfig.boxSelect&&e.canBoxSelect?this.whileBoxSelect(e,t):void 0},We.whileBoxSelect=function(e,t){e.boxSelecting=!0,this.updateUIClasses({mouse:y.ADD}),e.boxSelectElement||(e.boxSelectElement=document.createElement("div"),e.boxSelectElement.classList.add(f.BOX_SELECT),this.map.getContainer().appendChild(e.boxSelectElement));const n=ke(t.originalEvent,this.map.getContainer()),r=Math.min(e.boxSelectStartLocation.x,n.x),o=Math.max(e.boxSelectStartLocation.x,n.x),i=Math.min(e.boxSelectStartLocation.y,n.y),a=Math.max(e.boxSelectStartLocation.y,n.y),s=`translate(${r}px, ${i}px)`;e.boxSelectElement.style.transform=s,e.boxSelectElement.style.WebkitTransform=s,e.boxSelectElement.style.width=o-r+"px",e.boxSelectElement.style.height=a-i+"px"},We.dragMove=function(e,t){e.dragMoving=!0,t.originalEvent.stopPropagation();const n={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};Ye(this.getSelected(),n),e.dragMoveLocation=t.lngLat},We.onTouchEnd=We.onMouseUp=function(e,t){if(e.dragMoving)this.fireUpdate();else if(e.boxSelecting){const n=[e.boxSelectStartLocation,ke(t.originalEvent,this.map.getContainer())],r=this.featuresAt(null,n,"click"),o=this.getUniqueIds(r).filter(e=>!this.isSelected(e));o.length&&(this.select(o),o.forEach(e=>this.doRender(e)),this.updateUIClasses({mouse:y.MOVE}))}this.stopExtendedInteractions(e)},We.toDisplayFeatures=function(e,t,n){t.properties.active=this.isSelected(t.properties.id)?T.ACTIVE:T.INACTIVE,n(t),this.fireActionable(),t.properties.active===T.ACTIVE&&t.geometry.type!==v.POINT&&Re(t).forEach(n)},We.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},We.onCombineFeatures=function(){const e=this.getSelected();if(0===e.length||e.length<2)return;const t=[],n=[],r=e[0].type.replace("Multi","");for(let o=0;o<e.length;o++){const i=e[o];if(i.type.replace("Multi","")!==r)return;i.type.includes("Multi")?i.getCoordinates().forEach(e=>{t.push(e)}):t.push(i.getCoordinates()),n.push(i.toGeoJSON())}if(n.length>1){const e=this.newFeature({type:v.FEATURE,properties:n[0].properties,geometry:{type:`Multi${r}`,coordinates:t}});this.addFeature(e),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([e.id]),this.fire(b.COMBINE_FEATURES,{createdFeatures:[e.toGeoJSON()],deletedFeatures:n})}this.fireActionable()},We.onUncombineFeatures=function(){const e=this.getSelected();if(0===e.length)return;const t=[],n=[];for(let r=0;r<e.length;r++){const o=e[r];this.isInstanceOf("MultiFeature",o)&&(o.getFeatures().forEach(e=>{this.addFeature(e),e.properties=o.properties,t.push(e.toGeoJSON()),this.select([e.id])}),this.deleteFeature(o.id,{silent:!0}),n.push(o.toGeoJSON()))}t.length>1&&this.fire(b.UNCOMBINE_FEATURES,{createdFeatures:t,deletedFeatures:n}),this.fireActionable()};const Xe=We,Ke=Te(x.VERTEX),Ze=Te(x.MIDPOINT),ze={fireUpdate:function(){this.fire(b.UPDATE,{action:S.CHANGE_COORDINATES,features:this.getSelected().map(e=>e.toGeoJSON())})},fireActionable:function(e){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:e.selectedCoordPaths.length>0})},startDragging:function(e,t){e.initialDragPanState=this.map.dragPan.isEnabled(),this.map.dragPan.disable(),e.canDragMove=!0,e.dragMoveLocation=t.lngLat},stopDragging:function(e){e.canDragMove&&!0===e.initialDragPanState&&this.map.dragPan.enable(),e.dragMoving=!1,e.canDragMove=!1,e.dragMoveLocation=null},onVertex:function(e,t){this.startDragging(e,t);const n=t.featureTarget.properties,r=e.selectedCoordPaths.indexOf(n.coord_path);Pe(t)||-1!==r?Pe(t)&&-1===r&&e.selectedCoordPaths.push(n.coord_path):e.selectedCoordPaths=[n.coord_path];const o=this.pathsToCoordinates(e.featureId,e.selectedCoordPaths);this.setSelectedCoordinates(o)},onMidpoint:function(e,t){this.startDragging(e,t);const n=t.featureTarget.properties;e.feature.addCoordinate(n.coord_path,n.lng,n.lat),this.fireUpdate(),e.selectedCoordPaths=[n.coord_path]},pathsToCoordinates:function(e,t){return t.map(t=>({feature_id:e,coord_path:t}))},onFeature:function(e,t){0===e.selectedCoordPaths.length?this.startDragging(e,t):this.stopDragging(e)},dragFeature:function(e,t,n){Ye(this.getSelected(),n),e.dragMoveLocation=t.lngLat},dragVertex:function(e,t,n){const r=e.selectedCoordPaths.map(t=>e.feature.getCoordinate(t)),o=qe(r.map(e=>({type:v.FEATURE,properties:{},geometry:{type:v.POINT,coordinates:e}})),n);for(let t=0;t<r.length;t++){const n=r[t];e.feature.updateCoordinate(e.selectedCoordPaths[t],n[0]+o.lng,n[1]+o.lat)}},clickNoTarget:function(){this.changeMode(E.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(E.SIMPLE_SELECT)},clickActiveFeature:function(e){e.selectedCoordPaths=[],this.clearSelectedCoordinates(),e.feature.changed()},onSetup:function(e){const t=e.featureId,n=this.getFeature(t);if(!n)throw new Error("You must provide a featureId to enter direct_select mode");if(n.type===v.POINT)throw new TypeError("direct_select mode doesn't handle point features");const r={featureId:t,feature:n,dragMoveLocation:e.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:e.coordPath?[e.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(t,r.selectedCoordPaths)),this.setSelected(t),je.disable(this),this.setActionableState({trash:!0}),r},onStop:function(){je.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(e,t,n){e.featureId===t.properties.id?(t.properties.active=T.ACTIVE,n(t),Re(t,{map:this.map,midpoints:!0,selectedPaths:e.selectedCoordPaths}).forEach(n)):(t.properties.active=T.INACTIVE,n(t)),this.fireActionable(e)},onTrash:function(e){e.selectedCoordPaths.sort((e,t)=>t.localeCompare(e,"en",{numeric:!0})).forEach(t=>e.feature.removeCoordinate(t)),this.fireUpdate(),e.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(e),!1===e.feature.isValid()&&(this.deleteFeature([e.featureId]),this.changeMode(E.SIMPLE_SELECT,{}))},onMouseMove:function(e,t){const n=Ie(t),r=Ke(t),o=Ze(t),i=0===e.selectedCoordPaths.length;return n&&i||r&&!i?this.updateUIClasses({mouse:y.MOVE}):this.updateUIClasses({mouse:y.NONE}),(r||n||o)&&e.dragMoving&&this.fireUpdate(),this.stopDragging(e),!0},onMouseOut:function(e){return e.dragMoving&&this.fireUpdate(),!0}};ze.onTouchStart=ze.onMouseDown=function(e,t){return Ke(t)?this.onVertex(e,t):Ie(t)?this.onFeature(e,t):Ze(t)?this.onMidpoint(e,t):void 0},ze.onDrag=function(e,t){if(!0!==e.canDragMove)return;e.dragMoving=!0,t.originalEvent.stopPropagation();const n={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};e.selectedCoordPaths.length>0?this.dragVertex(e,t,n):this.dragFeature(e,t,n),e.dragMoveLocation=t.lngLat},ze.onClick=function(e,t){return Ce(t)?this.clickNoTarget(e,t):Ie(t)?this.clickActiveFeature(e,t):Oe(t)?this.clickInactive(e,t):void this.stopDragging(e)},ze.onTap=function(e,t){return Ce(t)?this.clickNoTarget(e,t):Ie(t)?this.clickActiveFeature(e,t):Oe(t)?this.clickInactive(e,t):void 0},ze.onTouchEnd=ze.onMouseUp=function(e){e.dragMoving&&this.fireUpdate(),this.stopDragging(e)};const Qe=ze,et={onSetup:function(){const e=this.newFeature({type:v.FEATURE,properties:{},geometry:{type:v.POINT,coordinates:[]}});return this.addFeature(e),this.clearSelectedFeatures(),this.updateUIClasses({mouse:y.ADD}),this.activateUIButton(m.POINT),this.setActionableState({trash:!0}),{point:e}},stopDrawingAndRemove:function(e){this.deleteFeature([e.point.id],{silent:!0}),this.changeMode(E.SIMPLE_SELECT)}};et.onTap=et.onClick=function(e,t){this.updateUIClasses({mouse:y.MOVE}),e.point.updateCoordinate("",t.lngLat.lng,t.lngLat.lat),this.fire(b.CREATE,{features:[e.point.toGeoJSON()]}),this.changeMode(E.SIMPLE_SELECT,{featureIds:[e.point.id]})},et.onStop=function(e){this.activateUIButton(),e.point.getCoordinate().length||this.deleteFeature([e.point.id],{silent:!0})},et.toDisplayFeatures=function(e,t,n){const r=t.properties.id===e.point.id;if(t.properties.active=r?T.ACTIVE:T.INACTIVE,!r)return n(t)},et.onTrash=et.stopDrawingAndRemove,et.onKeyUp=function(e,t){if(Le(t)||Ae(t))return this.stopDrawingAndRemove(e,t)};const tt=et,nt=function(e,t){return!!e.lngLat&&e.lngLat.lng===t[0]&&e.lngLat.lat===t[1]},rt={onSetup:function(){const e=this.newFeature({type:v.FEATURE,properties:{},geometry:{type:v.POLYGON,coordinates:[[]]}});return this.addFeature(e),this.clearSelectedFeatures(),je.disable(this),this.updateUIClasses({mouse:y.ADD}),this.activateUIButton(m.POLYGON),this.setActionableState({trash:!0}),{polygon:e,currentVertexPosition:0}},clickAnywhere:function(e,t){if(e.currentVertexPosition>0&&nt(t,e.polygon.coordinates[0][e.currentVertexPosition-1]))return this.changeMode(E.SIMPLE_SELECT,{featureIds:[e.polygon.id]});this.updateUIClasses({mouse:y.ADD}),e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat),e.currentVertexPosition++,e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat)},clickOnVertex:function(e){return this.changeMode(E.SIMPLE_SELECT,{featureIds:[e.polygon.id]})},onMouseMove:function(e,t){e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat),Me(t)&&this.updateUIClasses({mouse:y.POINTER})}};rt.onTap=rt.onClick=function(e,t){return Me(t)?this.clickOnVertex(e,t):this.clickAnywhere(e,t)},rt.onKeyUp=function(e,t){Le(t)?(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(E.SIMPLE_SELECT)):Ae(t)&&this.changeMode(E.SIMPLE_SELECT,{featureIds:[e.polygon.id]})},rt.onStop=function(e){this.updateUIClasses({mouse:y.NONE}),je.enable(this),this.activateUIButton(),void 0!==this.getFeature(e.polygon.id)&&(e.polygon.removeCoordinate(`0.${e.currentVertexPosition}`),e.polygon.isValid()?this.fire(b.CREATE,{features:[e.polygon.toGeoJSON()]}):(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(E.SIMPLE_SELECT,{},{silent:!0})))},rt.toDisplayFeatures=function(e,t,n){const r=t.properties.id===e.polygon.id;if(t.properties.active=r?T.ACTIVE:T.INACTIVE,!r)return n(t);if(0===t.geometry.coordinates.length)return;const o=t.geometry.coordinates[0].length;if(!(o<3)){if(t.properties.meta=x.FEATURE,n(Ve(e.polygon.id,t.geometry.coordinates[0][0],"0.0",!1)),o>3){const r=t.geometry.coordinates[0].length-3;n(Ve(e.polygon.id,t.geometry.coordinates[0][r],`0.${r}`,!1))}if(o<=4){const e=[[t.geometry.coordinates[0][0][0],t.geometry.coordinates[0][0][1]],[t.geometry.coordinates[0][1][0],t.geometry.coordinates[0][1][1]]];if(n({type:v.FEATURE,properties:t.properties,geometry:{coordinates:e,type:v.LINE_STRING}}),3===o)return}return n(t)}},rt.onTrash=function(e){this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(E.SIMPLE_SELECT)};const ot=rt,it={onSetup:function(e){const t=(e=e||{}).featureId;let n,r,o="forward";if(t){if(n=this.getFeature(t),!n)throw new Error("Could not find a feature with the provided featureId");let i=e.from;if(i&&"Feature"===i.type&&i.geometry&&"Point"===i.geometry.type&&(i=i.geometry),i&&"Point"===i.type&&i.coordinates&&2===i.coordinates.length&&(i=i.coordinates),!i||!Array.isArray(i))throw new Error("Please use the `from` property to indicate which point to continue the line from");const a=n.coordinates.length-1;if(n.coordinates[a][0]===i[0]&&n.coordinates[a][1]===i[1])r=a+1,n.addCoordinate(r,...n.coordinates[a]);else{if(n.coordinates[0][0]!==i[0]||n.coordinates[0][1]!==i[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");o="backwards",r=0,n.addCoordinate(r,...n.coordinates[0])}}else n=this.newFeature({type:v.FEATURE,properties:{},geometry:{type:v.LINE_STRING,coordinates:[]}}),r=0,this.addFeature(n);return this.clearSelectedFeatures(),je.disable(this),this.updateUIClasses({mouse:y.ADD}),this.activateUIButton(m.LINE),this.setActionableState({trash:!0}),{line:n,currentVertexPosition:r,direction:o}},clickAnywhere:function(e,t){if(e.currentVertexPosition>0&&nt(t,e.line.coordinates[e.currentVertexPosition-1])||"backwards"===e.direction&&nt(t,e.line.coordinates[e.currentVertexPosition+1]))return this.changeMode(E.SIMPLE_SELECT,{featureIds:[e.line.id]});this.updateUIClasses({mouse:y.ADD}),e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),"forward"===e.direction?(e.currentVertexPosition++,e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)):e.line.addCoordinate(0,t.lngLat.lng,t.lngLat.lat)},clickOnVertex:function(e){return this.changeMode(E.SIMPLE_SELECT,{featureIds:[e.line.id]})},onMouseMove:function(e,t){e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),Me(t)&&this.updateUIClasses({mouse:y.POINTER})}};it.onTap=it.onClick=function(e,t){if(Me(t))return this.clickOnVertex(e,t);this.clickAnywhere(e,t)},it.onKeyUp=function(e,t){Ae(t)?this.changeMode(E.SIMPLE_SELECT,{featureIds:[e.line.id]}):Le(t)&&(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(E.SIMPLE_SELECT))},it.onStop=function(e){je.enable(this),this.activateUIButton(),void 0!==this.getFeature(e.line.id)&&(e.line.removeCoordinate(`${e.currentVertexPosition}`),e.line.isValid()?this.fire(b.CREATE,{features:[e.line.toGeoJSON()]}):(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(E.SIMPLE_SELECT,{},{silent:!0})))},it.onTrash=function(e){this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(E.SIMPLE_SELECT)},it.toDisplayFeatures=function(e,t,n){const r=t.properties.id===e.line.id;if(t.properties.active=r?T.ACTIVE:T.INACTIVE,!r)return n(t);t.geometry.coordinates.length<2||(t.properties.meta=x.FEATURE,n(Ve(e.line.id,t.geometry.coordinates["forward"===e.direction?t.geometry.coordinates.length-2:1],""+("forward"===e.direction?t.geometry.coordinates.length-2:1),!1)),n(t))};const at={simple_select:Xe,direct_select:Qe,draw_point:tt,draw_polygon:ot,draw_line_string:it},st={defaultMode:E.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:xe,modes:at,controls:{},userProperties:!1,suppressAPIEvents:!0},ct={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},ut={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function lt(e,t){return e.map(e=>e.source?e:Object.assign({},e,{id:`${e.id}.${t}`,source:"hot"===t?g.HOT:g.COLD}))}var dt=n("./node_modules/fast-deep-equal/index.js"),pt=n("./node_modules/@mapbox/geojson-normalize/index.js");function ht(e,t){return e.length===t.length&&JSON.stringify(e.map(e=>e).sort())===JSON.stringify(t.map(e=>e).sort())}const ft={Polygon:oe,LineString:ne,Point:ee,MultiPolygon:ce,MultiLineString:ce,MultiPoint:ce};function gt(e){!function(e,t){const n={options:e=function(e={}){let t=Object.assign({},e);return e.controls||(t.controls={}),!1===e.displayControlsDefault?t.controls=Object.assign({},ut,e.controls):t.controls=Object.assign({},ct,e.controls),t=Object.assign({},st,t),t.styles=lt(t.styles,"cold").concat(lt(t.styles,"hot")),t}(e)};t=function(e,t){t.modes=E;const n=void 0===e.options.suppressAPIEvents||!!e.options.suppressAPIEvents;return t.getFeatureIdsAt=function(t){return R.click({point:t},null,e).map(e=>e.properties.id)},t.getSelectedIds=function(){return e.store.getSelectedIds()},t.getSelected=function(){return{type:v.FEATURE_COLLECTION,features:e.store.getSelectedIds().map(t=>e.store.get(t)).map(e=>e.toGeoJSON())}},t.getSelectedPoints=function(){return{type:v.FEATURE_COLLECTION,features:e.store.getSelectedCoordinates().map(e=>({type:v.FEATURE,properties:{},geometry:{type:v.POINT,coordinates:e.coordinates}}))}},t.set=function(n){if(void 0===n.type||n.type!==v.FEATURE_COLLECTION||!Array.isArray(n.features))throw new Error("Invalid FeatureCollection");const r=e.store.createRenderBatch();let o=e.store.getAllIds().slice();const i=t.add(n),a=new V(i);return o=o.filter(e=>!a.has(e)),o.length&&t.delete(o),r(),i},t.add=function(t){const r=JSON.parse(JSON.stringify(pt(t))).features.map(t=>{if(t.id=t.id||K(),null===t.geometry)throw new Error("Invalid geometry: null");if(void 0===e.store.get(t.id)||e.store.get(t.id).type!==t.geometry.type){const r=ft[t.geometry.type];if(void 0===r)throw new Error(`Invalid geometry type: ${t.geometry.type}.`);const o=new r(e,t);e.store.add(o,{silent:n})}else{const r=e.store.get(t.id),o=r.properties;r.properties=t.properties,dt(o,t.properties)||e.store.featureChanged(r.id,{silent:n}),dt(r.getCoordinates(),t.geometry.coordinates)||r.incomingCoords(t.geometry.coordinates)}return t.id});return e.store.render(),r},t.get=function(t){const n=e.store.get(t);if(n)return n.toGeoJSON()},t.getAll=function(){return{type:v.FEATURE_COLLECTION,features:e.store.getAll().map(e=>e.toGeoJSON())}},t.delete=function(r){return e.store.delete(r,{silent:n}),t.getMode()!==E.DIRECT_SELECT||e.store.getSelectedIds().length?e.store.render():e.events.changeMode(E.SIMPLE_SELECT,void 0,{silent:n}),t},t.deleteAll=function(){return e.store.delete(e.store.getAllIds(),{silent:n}),t.getMode()===E.DIRECT_SELECT?e.events.changeMode(E.SIMPLE_SELECT,void 0,{silent:n}):e.store.render(),t},t.changeMode=function(r,o={}){return r===E.SIMPLE_SELECT&&t.getMode()===E.SIMPLE_SELECT?(ht(o.featureIds||[],e.store.getSelectedIds())||(e.store.setSelected(o.featureIds,{silent:n}),e.store.render()),t):(r===E.DIRECT_SELECT&&t.getMode()===E.DIRECT_SELECT&&o.featureId===e.store.getSelectedIds()[0]||e.events.changeMode(r,o,{silent:n}),t)},t.getMode=function(){return e.events.getMode()},t.trash=function(){return e.events.trash({silent:n}),t},t.combineFeatures=function(){return e.events.combineFeatures({silent:n}),t},t.uncombineFeatures=function(){return e.events.uncombineFeatures({silent:n}),t},t.setFeatureProperty=function(r,o,i){return e.store.setFeatureProperty(r,o,i,{silent:n}),t},t}(n,t),n.api=t;const r=ve(n);t.onAdd=r.onAdd,t.onRemove=r.onRemove,t.types=m,t.options=e}(e,this)}gt.modes=at,gt.constants=r,gt.lib=i;const yt=gt;var mt={onSetup:function(){return{}},onClick:function(){return!1},onKeyUp:function(){return!1},onDrag:function(){return!1},toDisplayFeatures:function(e,t,n){t.properties.active="false",n(t)}};function vt(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return[...e.geometry.coordinates];if("Point"===e.type)return[...e.coordinates]}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return[...e];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Et(e){return"Feature"===e.type?e.geometry:e}function bt(e,t,n={}){const r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function St(e,t,n={}){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!It(e[0])||!It(e[1]))throw new Error("coordinates must contain numbers");return bt({type:"Point",coordinates:e},t,n)}function xt(e,t,n={}){for(const t of e){if(t.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(t[t.length-1].length!==t[0].length)throw new Error("First and last Position are not equivalent.");for(let e=0;e<t[t.length-1].length;e++)if(t[t.length-1][e]!==t[0][e])throw new Error("First and last Position are not equivalent.")}return bt({type:"Polygon",coordinates:e},t,n)}function Tt(e,t,n={}){if(e.length<2)throw new Error("coordinates must be an array of two or more positions");return bt({type:"LineString",coordinates:e},t,n)}function wt(e,t={}){const n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function It(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}Math.PI;const Ot=11102230246251565e-32,Ct=134217729,_t=(3+8*Ot)*Ot;function Mt(e,t,n,r,o){let i,a,s,c,u=t[0],l=r[0],d=0,p=0;l>u==l>-u?(i=u,u=t[++d]):(i=l,l=r[++p]);let h=0;if(d<e&&p<n)for(l>u==l>-u?(a=u+i,s=i-(a-u),u=t[++d]):(a=l+i,s=i-(a-l),l=r[++p]),i=a,0!==s&&(o[h++]=s);d<e&&p<n;)l>u==l>-u?(a=i+u,c=a-i,s=i-(a-c)+(u-c),u=t[++d]):(a=i+l,c=a-i,s=i-(a-c)+(l-c),l=r[++p]),i=a,0!==s&&(o[h++]=s);for(;d<e;)a=i+u,c=a-i,s=i-(a-c)+(u-c),u=t[++d],i=a,0!==s&&(o[h++]=s);for(;p<n;)a=i+l,c=a-i,s=i-(a-c)+(l-c),l=r[++p],i=a,0!==s&&(o[h++]=s);return 0===i&&0!==h||(o[h++]=i),h}function Pt(e){return new Float64Array(e)}const Lt=Pt(4),At=Pt(8),Nt=Pt(12),Ft=Pt(16),kt=Pt(4);function Vt(e,t,n,r,o,i){const a=(t-i)*(n-o),s=(e-o)*(r-i),c=a-s,u=Math.abs(a+s);return Math.abs(c)>=33306690738754716e-32*u?c:-function(e,t,n,r,o,i,a){let s,c,u,l,d,p,h,f,g,y,m,v,E,b,S,x,T,w;const I=e-o,O=n-o,C=t-i,_=r-i;b=I*_,p=Ct*I,h=p-(p-I),f=I-h,p=Ct*_,g=p-(p-_),y=_-g,S=f*y-(b-h*g-f*g-h*y),x=C*O,p=Ct*C,h=p-(p-C),f=C-h,p=Ct*O,g=p-(p-O),y=O-g,T=f*y-(x-h*g-f*g-h*y),m=S-T,d=S-m,Lt[0]=S-(m+d)+(d-T),v=b+m,d=v-b,E=b-(v-d)+(m-d),m=E-x,d=E-m,Lt[1]=E-(m+d)+(d-x),w=v+m,d=w-v,Lt[2]=v-(w-d)+(m-d),Lt[3]=w;let M=function(e,t){let n=t[0];for(let e=1;e<4;e++)n+=t[e];return n}(0,Lt),P=22204460492503146e-32*a;if(M>=P||-M>=P)return M;if(d=e-I,s=e-(I+d)+(d-o),d=n-O,u=n-(O+d)+(d-o),d=t-C,c=t-(C+d)+(d-i),d=r-_,l=r-(_+d)+(d-i),0===s&&0===c&&0===u&&0===l)return M;if(P=11093356479670487e-47*a+_t*Math.abs(M),M+=I*l+_*s-(C*u+O*c),M>=P||-M>=P)return M;b=s*_,p=Ct*s,h=p-(p-s),f=s-h,p=Ct*_,g=p-(p-_),y=_-g,S=f*y-(b-h*g-f*g-h*y),x=c*O,p=Ct*c,h=p-(p-c),f=c-h,p=Ct*O,g=p-(p-O),y=O-g,T=f*y-(x-h*g-f*g-h*y),m=S-T,d=S-m,kt[0]=S-(m+d)+(d-T),v=b+m,d=v-b,E=b-(v-d)+(m-d),m=E-x,d=E-m,kt[1]=E-(m+d)+(d-x),w=v+m,d=w-v,kt[2]=v-(w-d)+(m-d),kt[3]=w;const L=Mt(4,Lt,4,kt,At);b=I*l,p=Ct*I,h=p-(p-I),f=I-h,p=Ct*l,g=p-(p-l),y=l-g,S=f*y-(b-h*g-f*g-h*y),x=C*u,p=Ct*C,h=p-(p-C),f=C-h,p=Ct*u,g=p-(p-u),y=u-g,T=f*y-(x-h*g-f*g-h*y),m=S-T,d=S-m,kt[0]=S-(m+d)+(d-T),v=b+m,d=v-b,E=b-(v-d)+(m-d),m=E-x,d=E-m,kt[1]=E-(m+d)+(d-x),w=v+m,d=w-v,kt[2]=v-(w-d)+(m-d),kt[3]=w;const A=Mt(L,At,4,kt,Nt);b=s*l,p=Ct*s,h=p-(p-s),f=s-h,p=Ct*l,g=p-(p-l),y=l-g,S=f*y-(b-h*g-f*g-h*y),x=c*u,p=Ct*c,h=p-(p-c),f=c-h,p=Ct*u,g=p-(p-u),y=u-g,T=f*y-(x-h*g-f*g-h*y),m=S-T,d=S-m,kt[0]=S-(m+d)+(d-T),v=b+m,d=v-b,E=b-(v-d)+(m-d),m=E-x,d=E-m,kt[1]=E-(m+d)+(d-x),w=v+m,d=w-v,kt[2]=v-(w-d)+(m-d),kt[3]=w;const N=Mt(A,Nt,4,kt,Ft);return Ft[N-1]}(e,t,n,r,o,i,u)}function Dt(e,t){var n,r,o,i,a,s,c,u,l,d=0,p=e[0],h=e[1],f=t.length;for(n=0;n<f;n++){r=0;var g=t[n],y=g.length-1;if((u=g[0])[0]!==g[y][0]&&u[1]!==g[y][1])throw new Error("First and last coordinates in a ring must be the same");for(i=u[0]-p,a=u[1]-h;r<y;r++){if(s=(l=g[r+1])[0]-p,c=l[1]-h,0===a&&0===c){if(s<=0&&i>=0||i<=0&&s>=0)return 0}else if(c>=0&&a<=0||c<=0&&a>=0){if(0===(o=Vt(i,s,a,c,0,0)))return 0;(o>0&&c>0&&a<=0||o<0&&c<=0&&a>0)&&d++}u=l,a=c,i=s}}return d%2!=0}function Rt(e,t,n={}){if(!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");const r=vt(e),o=Et(t),i=o.type,a=t.bbox;let s=o.coordinates;if(a&&!1===function(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}(r,a))return!1;"Polygon"===i&&(s=[s]);let c=!1;for(var u=0;u<s.length;++u){const e=Dt(r,s[u]);if(0===e)return!n.ignoreBoundary;e&&(c=!0)}return c}Pt(4),Pt(4),Pt(4),Pt(4),Pt(4),Pt(4),Pt(4),Pt(4),Pt(4),Pt(8),Pt(8),Pt(8),Pt(4),Pt(8),Pt(8),Pt(8),Pt(12),Pt(192),Pt(192),Pt(4),Pt(4),Pt(4),Pt(4),Pt(4),Pt(4),Pt(4),Pt(4),Pt(8),Pt(8),Pt(8),Pt(8),Pt(8),Pt(8),Pt(8),Pt(8),Pt(8),Pt(4),Pt(4),Pt(4),Pt(8),Pt(16),Pt(16),Pt(16),Pt(32),Pt(32),Pt(48),Pt(64),Pt(1152),Pt(1152),Pt(4),Pt(4),Pt(4),Pt(4),Pt(4),Pt(4),Pt(4),Pt(4),Pt(4),Pt(4),Pt(24),Pt(24),Pt(24),Pt(24),Pt(24),Pt(24),Pt(24),Pt(24),Pt(24),Pt(24),Pt(1152),Pt(1152),Pt(1152),Pt(1152),Pt(1152),Pt(2304),Pt(2304),Pt(3456),Pt(5760),Pt(8),Pt(8),Pt(8),Pt(16),Pt(24),Pt(48),Pt(48),Pt(96),Pt(192),Pt(384),Pt(384),Pt(384),Pt(768),Pt(96),Pt(96),Pt(96),Pt(1152);class jt{constructor(e=[],t=Ut){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:n}=this,r=t[e];for(;e>0;){const o=e-1>>1,i=t[o];if(n(r,i)>=0)break;t[e]=i,e=o}t[e]=r}_down(e){const{data:t,compare:n}=this,r=this.length>>1,o=t[e];for(;e<r;){let r=1+(e<<1),i=t[r];const a=r+1;if(a<this.length&&n(t[a],i)<0&&(r=a,i=t[a]),n(i,o)>=0)break;t[e]=i,e=r}t[e]=o}}function Ut(e,t){return e<t?-1:e>t?1:0}function Bt(e,t){return e.p.x>t.p.x?1:e.p.x<t.p.x?-1:e.p.y!==t.p.y?e.p.y>t.p.y?1:-1:1}function Gt(e,t){return e.rightSweepEvent.p.x>t.rightSweepEvent.p.x?1:e.rightSweepEvent.p.x<t.rightSweepEvent.p.x?-1:e.rightSweepEvent.p.y!==t.rightSweepEvent.p.y?e.rightSweepEvent.p.y<t.rightSweepEvent.p.y?1:-1:1}class $t{constructor(e,t,n,r){this.p={x:e[0],y:e[1]},this.featureId=t,this.ringId=n,this.eventId=r,this.otherEvent=null,this.isLeftEndpoint=null}isSamePoint(e){return this.p.x===e.p.x&&this.p.y===e.p.y}}let Jt=0,Ht=0,qt=0;function Yt(e,t){const n="Feature"===e.type?e.geometry:e;let r=n.coordinates;"Polygon"!==n.type&&"MultiLineString"!==n.type||(r=[r]),"LineString"===n.type&&(r=[[r]]);for(let e=0;e<r.length;e++)for(let n=0;n<r[e].length;n++){let o=r[e][n][0],i=null;Ht+=1;for(let a=0;a<r[e][n].length-1;a++){i=r[e][n][a+1];const s=new $t(o,Jt,Ht,qt),c=new $t(i,Jt,Ht,qt+1);s.otherEvent=c,c.otherEvent=s,Bt(s,c)>0?(c.isLeftEndpoint=!0,s.isLeftEndpoint=!1):(s.isLeftEndpoint=!0,c.isLeftEndpoint=!1),t.push(s),t.push(c),o=i,qt+=1}}Jt+=1}class Wt{constructor(e){this.leftSweepEvent=e,this.rightSweepEvent=e.otherEvent}}function Xt(e,t){if(null===e||null===t)return!1;if(e.leftSweepEvent.ringId===t.leftSweepEvent.ringId&&(e.rightSweepEvent.isSamePoint(t.leftSweepEvent)||e.rightSweepEvent.isSamePoint(t.leftSweepEvent)||e.rightSweepEvent.isSamePoint(t.rightSweepEvent)||e.leftSweepEvent.isSamePoint(t.leftSweepEvent)||e.leftSweepEvent.isSamePoint(t.rightSweepEvent)))return!1;const n=e.leftSweepEvent.p.x,r=e.leftSweepEvent.p.y,o=e.rightSweepEvent.p.x,i=e.rightSweepEvent.p.y,a=t.leftSweepEvent.p.x,s=t.leftSweepEvent.p.y,c=t.rightSweepEvent.p.x,u=t.rightSweepEvent.p.y,l=(u-s)*(o-n)-(c-a)*(i-r);if(0===l)return!1;const d=((c-a)*(r-s)-(u-s)*(n-a))/l,p=((o-n)*(r-s)-(i-r)*(n-a))/l;return d>=0&&d<=1&&p>=0&&p<=1&&[n+d*(o-n),r+d*(i-r)]}function Kt(e,t,n={}){const{removeDuplicates:r=!0,ignoreSelfIntersections:o=!0}=n;let i=[];"FeatureCollection"===e.type?i=i.concat(e.features):"Feature"===e.type?i.push(e):"LineString"!==e.type&&"Polygon"!==e.type&&"MultiLineString"!==e.type&&"MultiPolygon"!==e.type||i.push(bt(e)),"FeatureCollection"===t.type?i=i.concat(t.features):"Feature"===t.type?i.push(t):"LineString"!==t.type&&"Polygon"!==t.type&&"MultiLineString"!==t.type&&"MultiPolygon"!==t.type||i.push(bt(t));const a=function(e,t){const n=new jt([],Bt);return function(e,t){if("FeatureCollection"===e.type){const n=e.features;for(let e=0;e<n.length;e++)Yt(n[e],t)}else Yt(e,t)}(e,n),function(e,t){t=t||!1;const n=[],r=new jt([],Gt);for(;e.length;){const o=e.pop();if(o.isLeftEndpoint){const e=new Wt(o);for(let i=0;i<r.data.length;i++){const a=r.data[i];if(t&&a.leftSweepEvent.featureId===o.featureId)continue;const s=Xt(e,a);!1!==s&&n.push(s)}r.push(e)}else!1===o.isLeftEndpoint&&r.pop()}return n}(n,t)}(wt(i),o);let s=[];if(r){const e={};a.forEach(t=>{const n=t.join(",");e[n]||(e[n]=!0,s.push(t))})}else s=a;return wt(s.map(e=>St(e)))}function Zt(e,t){var n,r,o,i,a,s,c,u,l,d,p=0,h="FeatureCollection"===e.type,f="Feature"===e.type,g=h?e.features.length:1;for(n=0;n<g;n++){for(s=h?e.features[n].geometry:f?e.geometry:e,u=h?e.features[n].properties:f?e.properties:{},l=h?e.features[n].bbox:f?e.bbox:void 0,d=h?e.features[n].id:f?e.id:void 0,a=(c=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,o=0;o<a;o++)if(null!==(i=c?s.geometries[o]:s))switch(i.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(i,p,u,l,d))return!1;break;case"GeometryCollection":for(r=0;r<i.geometries.length;r++)if(!1===t(i.geometries[r],p,u,l,d))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,p,u,l,d))return!1;p++}}function zt(e,t){Zt(e,function(e,n,r,o,i){var a,s=null===e?null:e.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return!1!==t(bt(e,r,{bbox:o,id:i}),n,0)&&void 0}switch(s){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon"}for(var c=0;c<e.coordinates.length;c++){var u=e.coordinates[c];if(!1===t(bt({type:a,coordinates:u},r),n,c))return!1}})}function Qt(e,t={}){const n=Et(e);switch(t.properties||"Feature"!==e.type||(t.properties=e.properties),n.type){case"Polygon":return function(e,t={}){return en(Et(e).coordinates,t.properties?t.properties:"Feature"===e.type?e.properties:{})}(n,t);case"MultiPolygon":return function(e,t={}){const n=Et(e).coordinates,r=t.properties?t.properties:"Feature"===e.type?e.properties:{},o=[];return n.forEach(e=>{o.push(en(e,r))}),wt(o)}(n,t);default:throw new Error("invalid poly")}}function en(e,t){return e.length>1?function(e,t,n={}){return bt({type:"MultiLineString",coordinates:e},t,n)}(e,t):Tt(e[0],t)}function tn(e,t,{ignoreSelfIntersections:n=!0}={ignoreSelfIntersections:!0}){let r=!0;return zt(e,e=>{zt(t,t=>{if(!1===r)return!1;r=function(e,t,n){switch(e.type){case"Point":switch(t.type){case"Point":return r=e.coordinates,o=t.coordinates,!(r[0]===o[0]&&r[1]===o[1]);case"LineString":return!nn(t,e);case"Polygon":return!Rt(e,t)}break;case"LineString":switch(t.type){case"Point":return!nn(e,t);case"LineString":return!function(e,t,n){return Kt(e,t,{ignoreSelfIntersections:n}).features.length>0}(e,t,n);case"Polygon":return!rn(t,e,n)}break;case"Polygon":switch(t.type){case"Point":return!Rt(t,e);case"LineString":return!rn(e,t,n);case"Polygon":return!function(e,t,n){for(const n of e.coordinates[0])if(Rt(n,t))return!0;for(const n of t.coordinates[0])if(Rt(n,e))return!0;return Kt(Qt(e),Qt(t),{ignoreSelfIntersections:n}).features.length>0}(t,e,n)}}var r,o;return!1}(e.geometry,t.geometry,n)})}),r}function nn(e,t){for(let n=0;n<e.coordinates.length-1;n++)if(on(e.coordinates[n],e.coordinates[n+1],t.coordinates))return!0;return!1}function rn(e,t,n){for(const n of t.coordinates)if(Rt(n,e))return!0;return Kt(t,Qt(e),{ignoreSelfIntersections:n}).features.length>0}function on(e,t,n){const r=n[0]-e[0],o=n[1]-e[1],i=t[0]-e[0],a=t[1]-e[1];return 0===r*a-o*i&&(Math.abs(i)>=Math.abs(a)?i>0?e[0]<=n[0]&&n[0]<=t[0]:t[0]<=n[0]&&n[0]<=e[0]:a>0?e[1]<=n[1]&&n[1]<=t[1]:t[1]<=n[1]&&n[1]<=e[1])}function an(e,t){var n=Et(e),r=Et(t),o=n.type,i=r.type;switch(o){case"MultiPoint":switch(i){case"LineString":return sn(n,r);case"Polygon":return un(n,r);default:throw new Error("feature2 "+i+" geometry not supported")}case"LineString":switch(i){case"MultiPoint":return sn(r,n);case"LineString":return function(e,t){if(Kt(e,t).features.length>0)for(var n=0;n<e.coordinates.length-1;n++)for(var r=0;r<t.coordinates.length-1;r++){var o=!0;if(0!==r&&r!==t.coordinates.length-2||(o=!1),ln(e.coordinates[n],e.coordinates[n+1],t.coordinates[r],o))return!0}return!1}(n,r);case"Polygon":return cn(n,r);default:throw new Error("feature2 "+i+" geometry not supported")}case"Polygon":switch(i){case"MultiPoint":return un(r,n);case"LineString":return cn(r,n);default:throw new Error("feature2 "+i+" geometry not supported")}default:throw new Error("feature1 "+o+" geometry not supported")}}function sn(e,t){for(var n=!1,r=!1,o=e.coordinates.length,i=0;i<o&&!n&&!r;){for(var a=0;a<t.coordinates.length-1;a++){var s=!0;0!==a&&a!==t.coordinates.length-2||(s=!1),ln(t.coordinates[a],t.coordinates[a+1],e.coordinates[i],s)?n=!0:r=!0}i++}return n&&r}function cn(e,t){return Kt(e,Qt(t)).features.length>0}function un(e,t){var n=!1,r=!1,o=e.coordinates.length;for(let i=0;i<o&&(!n||!r);i++)Rt(St(e.coordinates[i]),t)?n=!0:r=!0;return r&&n}function ln(e,t,n,r){var o=n[0]-e[0],i=n[1]-e[1],a=t[0]-e[0],s=t[1]-e[1];return 0===o*s-i*a&&(r?Math.abs(a)>=Math.abs(s)?a>0?e[0]<=n[0]&&n[0]<=t[0]:t[0]<=n[0]&&n[0]<=e[0]:s>0?e[1]<=n[1]&&n[1]<=t[1]:t[1]<=n[1]&&n[1]<=e[1]:Math.abs(a)>=Math.abs(s)?a>0?e[0]<n[0]&&n[0]<t[0]:t[0]<n[0]&&n[0]<e[0]:s>0?e[1]<n[1]&&n[1]<t[1]:t[1]<n[1]&&n[1]<e[1])}function dn(e,t,n={}){const r=vt(e),o=function(e){if(Array.isArray(e))return e;if("Feature"===e.type){if(null!==e.geometry)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}(t);for(let e=0;e<o.length-1;e++){let t=!1;if(n.ignoreEndVertices&&(0===e&&(t="start"),e===o.length-2&&(t="end"),0===e&&e+1===o.length-1&&(t="both")),pn(o[e],o[e+1],r,t,void 0===n.epsilon?null:n.epsilon))return!0}return!1}function pn(e,t,n,r,o){const i=n[0],a=n[1],s=e[0],c=e[1],u=t[0],l=t[1],d=u-s,p=l-c,h=(n[0]-s)*p-(n[1]-c)*d;if(null!==o){if(Math.abs(h)>o)return!1}else if(0!==h)return!1;return Math.abs(d)===Math.abs(p)&&0===Math.abs(d)?!r&&n[0]===e[0]&&n[1]===e[1]:r?"start"===r?Math.abs(d)>=Math.abs(p)?d>0?s<i&&i<=u:u<=i&&i<s:p>0?c<a&&a<=l:l<=a&&a<c:"end"===r?Math.abs(d)>=Math.abs(p)?d>0?s<=i&&i<u:u<i&&i<=s:p>0?c<=a&&a<l:l<a&&a<=c:"both"===r&&(Math.abs(d)>=Math.abs(p)?d>0?s<i&&i<u:u<i&&i<s:p>0?c<a&&a<l:l<a&&a<c):Math.abs(d)>=Math.abs(p)?d>0?s<=i&&i<=u:u<=i&&i<=s:p>0?c<=a&&a<=l:l<=a&&a<=c}function hn(e){return e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]}function fn(e){for(var t=0;t<e.length-1;t++)for(var n=e[t],r=t+1;r<e.length-2;r++)if(dn(n,Tt([e[r],e[r+1]])))return!0;return!1}function gn(e,t,n){for(var r=xt(e),o=n+1;o<t.length;o++)if(!tn(r,xt(t[o]))&&an(r,Tt(t[o][0])))return!1;return!0}function yn(e){let t=0;if(e&&e.length>0){t+=Math.abs(En(e[0]));for(let n=1;n<e.length;n++)t-=Math.abs(En(e[n]))}return t}var mn=20294876564838.72,vn=Math.PI/180;function En(e){const t=e.length-1;if(t<=2)return 0;let n=0,r=0;for(;r<t;){const o=e[r],i=e[r+1===t?0:r+1],a=e[r+2>=t?(r+2)%t:r+2],s=o[0]*vn,c=i[1]*vn;n+=(a[0]*vn-s)*Math.sin(c),r++}return n*mn}var bn=function(e){return function(e){var t=0;return Zt(e,function(e,n,r,o,i){t=t+function(e){let t,n=0;switch(e.type){case"Polygon":return yn(e.coordinates);case"MultiPolygon":for(t=0;t<e.coordinates.length;t++)n+=yn(e.coordinates[t]);return n;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}(e)}),t}(e)};function Sn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,s=[],c=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||xn(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xn(e,t){if(e){if("string"==typeof e)return Tn(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Tn(e,t):void 0}}function Tn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var wn=function(e,t){var n=Sn(e,2),r=n[0],o=n[1],i=Sn(t,2),a=i[0],s=i[1],c=function(e){return e*Math.PI/180},u=c(s-o),l=c(a-r),d=Math.pow(Math.sin(u/2),2)+Math.cos(c(o))*Math.cos(c(s))*Math.pow(Math.sin(l/2),2);return 12742e3*Math.atan2(Math.sqrt(d),Math.sqrt(1-d))},In=function(e){if(e[0].length<=1||function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01;if(e[0].length<=1)return!0;if(e[0].length<=3)for(var n=0;n<e[0].length;n++)for(var r=n+1;r<e[0].length;r++)if(wn(e[0][n],e[0][r])<t)return!1;return!0}(e))return!0;if(!Array.isArray(e)||e.length<4)return!1;var t=e[0],n=e[e.length-1];if(t[0]!==n[0]||t[1]!==n[1])return!1;var r=xt([e]);return!(!function(e){if(!e.type)return!1;const t=Et(e),n=t.type,r=t.coordinates;switch(n){case"Point":return r.length>1;case"MultiPoint":for(var o=0;o<r.length;o++)if(r[o].length<2)return!1;return!0;case"LineString":if(r.length<2)return!1;for(o=0;o<r.length;o++)if(r[o].length<2)return!1;return!0;case"MultiLineString":if(r.length<2)return!1;for(o=0;o<r.length;o++)if(r[o].length<2)return!1;return!0;case"Polygon":for(o=0;o<t.coordinates.length;o++){if(r[o].length<4)return!1;if(!hn(r[o]))return!1;if(fn(r[o]))return!1;if(o>0&&Kt(xt([r[0]]),xt([r[o]])).features.length>1)return!1}return!0;case"MultiPolygon":for(o=0;o<t.coordinates.length;o++)for(var i=t.coordinates[o],a=0;a<i.length;a++){if(i[a].length<4)return!1;if(!hn(i[a]))return!1;if(fn(i[a]))return!1;if(0===a&&!gn(i,t.coordinates,o))return!1;if(a>0&&Kt(xt([i[0]]),xt([i[a]])).features.length>1)return!1}return!0;default:return!1}}(r)||bn(r)<=0)},On=function(e,t,n){var r=t.filter(function(t,r){var o=Math.abs(t[0]-e[0]),i=Math.abs(t[1]-e[1]);return("ArrowUp"===n?t[1]<=e[1]&&i>=o:"ArrowDown"===n?t[1]>e[1]&&i>=o:"ArrowLeft"===n?t[0]<=e[0]&&i<o:"ArrowRight"!==n||t[0]>e[0]&&i<o)&&JSON.stringify(t)!==JSON.stringify(e)});r.length||r.push(e);var o,i=r.map(function(t){return n=Math.abs(e[0]-t[0]),r=Math.abs(e[1]-t[1]),Math.sqrt(Math.pow(n,2)+Math.pow(r,2));var n,r}),a=r[i.indexOf(Math.min.apply(Math,(o=i,function(e){if(Array.isArray(e))return Tn(e)}(o)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(o)||xn(o)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())))];return t.findIndex(function(e){return JSON.stringify(e)===JSON.stringify(a)})};function Cn(e){return Cn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Cn(e)}function _n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,s=[],c=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||Pn(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Mn(e){return function(e){if(Array.isArray(e))return Ln(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Pn(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Pn(e,t){if(e){if("string"==typeof e)return Ln(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ln(e,t):void 0}}function Ln(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function An(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Nn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?An(Object(n),!0).forEach(function(t){Fn(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):An(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function Fn(e,t,n){return(t=function(e){var t=function(e){if("object"!=Cn(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Cn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Cn(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var kn=["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"],Vn=function(e,t){return Object.keys(e).reduce(function(n,r){return n[r]=e[r]*t,n},{})},Dn=Nn(Nn({},Qe),{},{onSetup:function(e){var t=Qe.onSetup.call(this,e),n=e.container,r=e.featureId,o=e.selectedVertexIndex,i=e.selectedVertexType,a=e.isPanEnabled,s=e.deleteVertexButtonId,c=e.interfaceType,u=e.scale;return Object.assign(t,{container:n,interfaceType:c,deleteVertexButtonId:s,isPanEnabled:a,featureId:t.featureId||r,selectedVertexIndex:null!=o?o:-1,selectedVertexType:i,scale:u}),t.vertecies=this.getVerticies(t.featureId),t.midpoints=this.getMidpoints(t.featureId),this.setupEventListeners(t),"midpoint"===i&&this.updateMidpoint(t.midpoints[o-t.vertecies.length]),this.addTouchVertexTarget(t),t},setupEventListeners:function(e){var t=this,n=function(n){return function(r){return n.call(t,e,r)}};this.handlers={keydown:n(this.onKeydown),keyup:n(this.onKeyup),pointerdown:n(this.onPointerevent),pointermove:n(this.onPointerevent),pointerup:n(this.onPointerevent),click:n(this.onVertexButtonClick),touchstart:n(this.onTouchstart),touchmove:n(this.onTouchmove),selectionchange:n(this.onSelectionChange),scalechange:n(this.onScaleChange),update:n(this.onUpdate),move:n(this.onMove)};var r=this.handlers;window.addEventListener("keydown",r.keydown,{capture:!0}),window.addEventListener("keyup",r.keyup,{capture:!0}),window.addEventListener("click",r.click),e.container.addEventListener("pointerdown",r.pointerdown),e.container.addEventListener("pointermove",r.pointermove),e.container.addEventListener("pointerup",r.pointerup),e.container.addEventListener("touchstart",r.touchstart,{passive:!1}),e.container.addEventListener("touchmove",r.touchmove,{passive:!1}),this.map.on("draw.selectionchange",r.selectionchange),this.map.on("draw.scalechange",r.scalechange),this.map.on("draw.update",r.update),this.map.on("move",r.move)},onSelectionChange:function(e,t){e.featureId,e.vertecies;var n,r,o=e.interfaceType,i=null===(n=t.points[t.points.length-1])||void 0===n?void 0:n.geometry.coordinates,a=t.features[0].geometry.coordinates.flat(1).findIndex(function(e){return i&&e[0]===i[0]&&e[1]===i[1]});e.selectedVertexIndex="keyboard"===o?e.selectedVertexIndex:a,null!==(r=e.selectedVertexType)&&void 0!==r||(e.selectedVertexType=a>=0?"vertex":null),this.map.fire("draw.vertexselection",{index:"vertex"===e.selectedVertexType?e.selectedVertexIndex:-1,numVertecies:e.vertecies.length});var s=i?Vn(this.map.project(i),e.scale):null;this.updateTouchVertexTarget(e,s)},onScaleChange:function(e,t){e.scale=t.scale},onUpdate:function(e,t){var n,r=e.vertecies.length,o=new Set(e.vertecies.map(function(e){return JSON.stringify(e)}));r!==e.vertecies.length&&(e.vertecies.find(function(e){return!o.has(JSON.stringify(e))}),e.selectedVertexIndex=e.vertecies.findIndex(function(e){return!o.has(JSON.stringify(e))}),null!==(n=e.selectedVertexType)&&void 0!==n||(e.selectedVertexType=e.selectedVertexIndex>=0?"vertex":null))},onKeydown:function(e,t){return e.interfaceType="keyboard",this.hideTouchVertexIndicator(e)," "===t.key&&e.selectedVertexIndex<0?(e.isPanEnabled=!1,this.updateVertex(e)):!t.altKey&&kn.includes(t.key)&&e.selectedVertexIndex>=0?(t.preventDefault(),t.stopPropagation(),"midpoint"===e.selectedVertexType?this.insertVertex(e,t):this.moveVertex(e,this.getNewCoord(e,t))):t.altKey&&kn.includes(t.key)&&e.selectedVertexIndex>=0?this.updateVertex(e,t.key):void("Escape"===t.key&&this.changeMode(e,{isPanEnabled:!0,selectedVertexIndex:-1,selectedVertexType:null}))},onKeyup:function(e,t){e.interfaceType="keyboard",kn.includes(t.key)&&e.selectedVertexIndex>=0&&t.stopPropagation(),"Delete"===t.key&&this.deleteVertex(e)},onMouseDown:function(e,t){var n,r,o;["vertex","midpoint"].includes(null===(n=t.featureTarget)||void 0===n?void 0:n.properties.meta)&&Qe.onMouseDown.call(this,e,t),"midpoint"===(null===(r=t.featureTarget)||void 0===r?void 0:r.properties.meta)&&(e.selectedVertexIndex=this.getVertexIndexFromMidpoint(e.vertecies,null===(o=t.featureTarget)||void 0===o?void 0:o.properties.coord_path),e.selectedVertexType="vertex",this.map.fire("draw.vertexselection",{index:e.selectedVertexIndex,numVertecies:e.vertecies.length}))},onPointerevent:function(e,t){e.interfaceType="touch"===t.pointerType?"touch":"pointer",e.isPanEnabled=!0;var n=t.target.parentNode,r=n instanceof window.SVGElement||n.ownerSVGElement;"touch"!==t.pointerType||"pointermove"!==t.type||r||this.changeMode(e,{selectedVertexIndex:-1,selectedVertexType:null,coordPath:null})},onTouchStart:function(e,t){},onTouchMove:function(e,t){},onTouchEnd:function(e,t){},clickNoTarget:function(e,t){this.changeMode(e,{selectedVertexIndex:-1,selectedVertexType:null,isPanEnabled:!0})},onTap:function(e,t){var n,r,o=null===(n=t.featureTarget)||void 0===n?void 0:n.properties.meta,i=null===(r=t.featureTarget)||void 0===r?void 0:r.properties.coord_path;if("vertex"===o){var a=parseInt(i.split(".")[1],10);this.changeMode(e,{selectedVertexIndex:a,selectedVertexType:"vertex",coordPath:i})}else if("midpoint"===o){var s=this.getVertexIndexFromMidpoint(e.vertecies,i);this.insertVertex(Nn(Nn({},e),{},{selectedVertexIndex:s,selectedVertexType:"midpoint"}))}else this.clickNoTarget(e,t)},onTouchstart:function(e,t){var n=t.target.parentNode,r=n instanceof window.SVGElement||n.ownerSVGElement;if(!(e.selectedVertexIndex<0)&&r){var o=t.touches[0].clientX,i=t.touches[0].clientY,a=window.getComputedStyle(e.touchVertexTarget);e.deltaTarget={x:o-parseFloat(a.left),y:i-parseFloat(a.top)};var s=this.map.project(e.vertecies[e.selectedVertexIndex]);e.deltaVertex={x:o/e.scale-s.x,y:i/e.scale-s.y}}},onTouchmove:function(e,t){var n=t.target.parentNode,r=n instanceof window.SVGElement||n.ownerSVGElement;if(!(e.selectedVertexIndex<0)&&r){var o=t.touches[0].clientX,i=t.touches[0].clientY;this.moveVertex(e,this.map.unproject({x:o/e.scale-e.deltaVertex.x,y:i/e.scale-e.deltaVertex.y})),this.updateTouchVertexTarget(e,{x:o-e.deltaTarget.x,y:i-e.deltaTarget.y})}},onDrag:function(e,t){"touch"!==e.interfaceType&&Qe.onDrag.call(this,e,t)},onMove:function(e,t){var n=e.vertecies[e.selectedVertexIndex];if(n){var r=Vn(this.map.project(n),e.scale);this.updateTouchVertexTarget(e,r)}},onVertexButtonClick:function(e,t){t.target.closest("#".concat(e.deleteVertexButtonId))&&"vertex"===e.selectedVertexType&&this.deleteVertex(e)},getVerticies:function(e){var t;return(null===(t=this.getFeature(e))||void 0===t||null===(t=t.coordinates)||void 0===t?void 0:t.flat(1))||[]},getMidpoints:function(e){var t=this.getFeature(e);if(!t)return[];var n=t.coordinates.flat(1);return n.map(function(e,t){var r=n[(t+1)%n.length];return[(e[0]+r[0])/2,(e[1]+r[1])/2]})},getVertexOrMidpoint:function(e,t){var n=this,r=function(e){return Object.values(n.map.project(e))},o=[].concat(Mn(e.vertecies.map(r)),Mn(e.midpoints.map(r))),i=o[e.selectedVertexIndex]||Object.values(this.map.project(this.map.getCenter())),a=On(i,o,t);return[a,a<e.vertecies.length?"vertex":"midpoint"]},getVertexIndexFromMidpoint:function(e,t){var n=parseInt(t.split(".")[1],10),r=e.length;return r+(n-1+r)%r},addTouchVertexTarget:function(e){var t=e.container.querySelector("[data-touch-vertex-target]");t||(e.container.insertAdjacentHTML("beforeend","\n  <svg width='48' height='48' viewBox='0 0 48 48' fill-rule='evenodd' style='display:none;position:absolute;top:50%;left:50%;margin:24px 0 0 -24px' class='touch-vertex-target' data-touch-vertex-target>\n    <circle cx='24' cy='24' r='24' fill='currentColor'/>\n    <path d=\"M37.543 25H34a1 1 0 1 1 0-2h3.629l-.836-.837a1 1 0 0 1 1.414-1.414l2.5 2.501A1 1 0 0 1 41 24a1 1 0 0 1-.487.858l-2.306 2.306a1 1 0 0 1-1.414-1.414l.75-.75zM23 10.414l-.793.793a1 1 0 0 1-1.414-1.414l2.5-2.5C23.481 7.105 23.734 7 24 7s.519.105.707.293l2.5 2.5a1 1 0 0 1-1.414 1.414L25 10.414V14a1 1 0 1 1-2 0v-3.586zM7 24a1 1 0 0 1 .293-.75l2.5-2.501a1 1 0 0 1 1.414 1.414l-.836.837H14a1 1 0 1 1 0 2h-3.543l.75.75a1 1 0 0 1-1.414 1.414l-2.306-2.306A1 1 0 0 1 7 24zm16.293 16.707l-2.5-2.5a1 1 0 0 1 1.414-1.414l.793.793V34a1 1 0 1 1 2 0v3.586l.793-.793a1 1 0 0 1 1.414 1.414l-2.5 2.5c-.188.188-.441.293-.707.293s-.519-.105-.707-.293zM24 20c2.208 0 4 1.792 4 4s-1.792 4-4 4-4-1.792-4-4 1.792-4 4-4z\" fill=\"#fff\"/>\n  </svg>\n"),t=e.container.querySelector("[data-touch-vertex-target]")),e.touchVertexTarget=t},updateTouchVertexTarget:function(e,t){t&&"touch"===e.interfaceType&&e.selectedVertexIndex>=0?this.showTouchVertexIndicator(e,t):this.hideTouchVertexIndicator(e)},updateMidpoint:function(e){var t=this;setTimeout(function(){t.map.getSource("mapbox-gl-draw-hot").setData({type:"Feature",properties:{meta:"midpoint",active:"true",id:"active-midpoint"},geometry:{type:"Point",coordinates:e}})},0)},updateVertex:function(e,t){var n=_n(this.getVertexOrMidpoint(e,t),2),r=n[0],o=n[1];this.changeMode(e,Nn({selectedVertexIndex:r,selectedVertexType:o},"vertex"===o&&{coordPath:"0.".concat(r)}))},getOffset:function(e,t){var n=this.map.project(e),r=null!=t&&t.shiftKey?1:5,o=_n(t?{ArrowUp:[0,-r],ArrowDown:[0,r],ArrowLeft:[-r,0],ArrowRight:[r,0]}[t.key]:[0,0],2),i=o[0],a=o[1];return this.map.unproject({x:n.x+i,y:n.y+a})},insertVertex:function(e,t){var n=this.getFeature(e.featureId),r=e.selectedVertexIndex-e.vertecies.length,o=this.getOffset(e.midpoints[r],t),i=n.toGeoJSON();("Polygon"===i.geometry.type?i.geometry.coordinates[0]:i.geometry.coordinates).splice(r+1,0,[o.lng,o.lat]),this._ctx.api.add(i),this.changeMode(e,{selectedVertexIndex:r+1,selectedVertexType:"vertex",coordPath:"0.".concat(r+1)})},getNewCoord:function(e,t){return this.getOffset(this.getFeature(e.featureId).coordinates.flat(1)[e.selectedVertexIndex],t)},moveVertex:function(e,t){var n=this.getFeature(e.featureId).toGeoJSON();"Polygon"===n.geometry.type&&(n.geometry.coordinates[0][e.selectedVertexIndex]=[t.lng,t.lat]),this._ctx.api.add(n)},deleteVertex:function(e){var t="Polygon"===this.getFeature(e.featureId).type?3:2;if(!(e.vertecies.length<=t)){var n=e.selectedVertexIndex>=e.vertecies.length-1?0:e.selectedVertexIndex;this._ctx.api.trash(),this.changeMode(e,{selectedVertexIndex:n,selectedVertexType:"vertex",coordPath:"0.".concat(n)})}},changeMode:function(e,t){this._ctx.api.changeMode("edit_vertex",Nn(Nn({},e),t))},showTouchVertexIndicator:function(e,t){Object.assign(e.touchVertexTarget.style,{display:"block",top:"".concat(t.y,"px"),left:"".concat(t.x,"px")})},hideTouchVertexIndicator:function(e){e.touchVertexTarget.style.display="none"},onStop:function(e){var t=this.handlers;e.container.removeEventListener("pointerdown",t.pointerdown),e.container.removeEventListener("pointermove",t.pointermove),e.container.removeEventListener("pointerup",t.pointerup),e.container.removeEventListener("touchstart",t.touchstart),e.container.removeEventListener("touchmove",t.touchmove),this.map.off("draw.selectionchange",t.selectionchange),this.map.off("draw.scalechange",t.scalechange),this.map.off("draw.update",t.update),this.map.off("move",t.move),this.map.dragPan.enable(),window.removeEventListener("click",t.click),window.removeEventListener("keydown",t.keydown,{capture:!0}),window.removeEventListener("keyup",t.keyup,{capture:!0}),this.hideTouchVertexIndicator(e)}});function Rn(e){return Rn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Rn(e)}function jn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,s=[],c=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Un(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Un(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Un(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Bn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Gn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Bn(Object(n),!0).forEach(function(t){$n(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Bn(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function $n(e,t,n){return(t=function(e){var t=function(e){if("object"!=Rn(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Rn(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Rn(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Jn=Gn(Gn({},ot),{},{onSetup:function(e){var t=this,n=this.map,r=Gn(Gn({},ot.onSetup.call(this,e)),e),o=r.container,i=r.interfaceType,a=r.vertexMarkerId,s=o.querySelector("#".concat(a));s.style.display=["touch","keyboard"].includes(i)?"block":"none",r.vertexMarker=s;var c={keydownHandler:this.onKeydown,keyupHandler:this.onKeyup,focusHandler:this.onFocus,blurHandler:this.onBlur,createHandler:this.onCreate,moveHandler:this.onMove,pointerdownHandler:this.onPointerdown,pointermoveHandler:this.onPointermove,pointerupHandler:this.onPointerup,vertexButtonClickHandler:this.onVertexButtonClick};return Object.entries(c).forEach(function(e){var n,o,i=jn(e,2);return n=i[0],o=i[1],t[n]=o.bind(t,r)}),this._listeners=[[window,"keydown",this.keydownHandler],[window,"keyup",this.keyupHandler],[window,"click",this.vertexButtonClickHandler],[o,"focus",this.focusHandler],[o,"blur",this.blurHandler],[o,"pointermove",this.pointermoveHandler],[o,"pointerup",this.pointerupHandler],[n,"pointerdown",this.pointerdownHandler],[n,"draw.create",this.createHandler],[n,"move",this.moveHandler]],this._listeners.forEach(function(e){var t=jn(e,3),n=t[0],r=t[1],o=t[2];return n.addEventListener?n.addEventListener(r,o):n.on(r,o)}),r},onClick:function(e,t){t.originalEvent.button>0||ot.onClick.call(this,e,t)},onTap:function(){},doClick:function(e){var t=e.polygon.coordinates;this.dispatchVertexChange(t[0]),In(t)&&this._simulateMouse("click",ot.onClick,e)},dispatchVertexChange:function(e){this.map.fire("draw.vertexchange",{numVertecies:e.length})},_simulateMouse:function(e,t,n){var r=this.map,o=r.getCenter(),i=r.project(o);t.call(this,n,{lngLat:o,point:i,originalEvent:new MouseEvent(e,{clientX:i.x,clientY:i.y,bubbles:!0,cancelable:!0})}),this._ctx.store.render()},_setInterface:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e.interfaceType=t,n&&(e.vertexMarker.style.display="block")},onCreate:function(e,t){var n=this._ctx.api,r=t.features[0];n.delete(r.id),r.id=e.featureId,n.add(r)},onVertexButtonClick:function(e,t){t.target.closest("#".concat(e.addVertexButtonId))&&this.doClick(e)},onTouchStart:function(e,t){this._setInterface(e,"touch"),this.onMove(e,t)},onTouchEnd:function(e,t){this._setInterface(e,"touch"),this.onMove(e,t)},onKeydown:function(e,t){if(document.activeElement===e.container){if("Escape"===t.key)return t.preventDefault();"Enter"===t.key&&(e.isActive=!0),this._setInterface(e,"keyboard"),this.onMove(e,t)}},onKeyup:function(e,t){"Escape"!==t.key&&(this._setInterface(e,"keyboard"),this.onMove(e,t),"Enter"===t.key&&e.isActive&&this.doClick(e))},onFocus:function(e){var t=e.vertexMarker,n=e.interfaceType;t.style.display=["touch","keyboard"].includes(n)?"block":"none"},onBlur:function(e,t){t.target!==e.container&&(e.vertexMarker.style.display="none")},onMove:function(e){["touch","keyboard"].includes(e.interfaceType)&&this._simulateMouse("mousemove",ot.onMouseMove,e)},onPointerdown:function(e,t){"touch"!==t.pointerType&&this._setInterface(e,"pointer",!1)},onPointermove:function(e,t){"touch"!==t.pointerType&&(e.vertexMarker.style.display="none")},onPointerup:function(e){this.dispatchVertexChange(e.polygon.coordinates[0])},toDisplayFeatures:function(e,t,n){if(ot.toDisplayFeatures.call(this,e,t,n),"Polygon"===t.geometry.type)for(var r=t.geometry.coordinates[0],o=1;o<r.length-2;o++)n(Ve(t.id,r[o],"0.".concat(o)))},onStop:function(e){ot.onStop.call(this,e),this._listeners.forEach(function(e){var t=jn(e,3),n=t[0],r=t[1],o=t[2];return n.removeEventListener?n.removeEventListener(r,o):n.off(r,o)}),e.vertexMarker.style.display="none"}});function Hn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}var qn="#0b0c0c",Yn="#ffffff",Wn=function(e){return{id:"fill-active",type:"fill",filter:["all",["==","$type","Polygon"],["==","active","true"]],paint:{"fill-color":e,"fill-opacity":.1}}},Xn=function(e){return{id:"stroke-active",type:"line",filter:["all",["==","$type","Polygon"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":e,"line-width":2,"line-opacity":1}}},Kn=function(e){return{id:"stroke-inactive",type:"line",filter:["all",["==","$type","Polygon"],["==","active","false"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":e,"line-width":2,"line-opacity":.8}}},Zn=function(e){return{id:"stroke-preview-line",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":e,"line-width":2,"line-dasharray":[.2,2],"line-opacity":1}}},zn=function(e){return{id:"vertex",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"]],paint:{"circle-radius":7,"circle-color":e}}},Qn=function(e,t){return{id:"vertex-halo",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["==","active","true"]],paint:{"circle-radius":9,"circle-stroke-width":3,"circle-color":e,"circle-stroke-color":t}}},er=function(e){return{id:"vertex-active",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["==","active","true"]],paint:{"circle-radius":7,"circle-color":e}}},tr=function(e){return{id:"midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":5,"circle-color":e}}},nr=function(e,t){return{id:"midpoint-halo",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":7,"circle-stroke-width":3,"circle-color":e,"circle-stroke-color":t}}},rr=function(e){return{id:"midpoint-active",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":e}}},or=function(e){return{id:"circle",type:"line",filter:["==","id","circle"],paint:{"line-color":e,"line-width":2,"line-opacity":.8}}},ir=function(e){var t="dark"===e?Yn:qn,n="dark"===e?qn:Yn,r="dark"===e?Yn:qn;return[Wn(t),Xn(t),Kn(t),Zn(t),tr(t),nr(n,r),rr(t),zn(t),Qn(n,r),er(t),or(t),{id:"touch-vertex-indicator",type:"circle",filter:["all",["==","$type","Point"],["==","meta","touch-vertex-indicator"]],paint:{"circle-radius":30,"circle-color":"#3bb2d0","circle-stroke-width":3,"circle-stroke-color":"#ffffff","circle-opacity":.9}}]};function ar(e){return ar="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ar(e)}function sr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function cr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?sr(Object(n),!0).forEach(function(t){ur(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sr(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function ur(e,t,n){return(t=function(e){var t=function(e){if("object"!=ar(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=ar(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ar(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var lr=function(e){var t=e.colorScheme,n=e.mapProvider,r=e.events,o=e.eventBus,i=n.map;yt.constants.classes.CONTROL_BASE="maplibregl-ctrl",yt.constants.classes.CONTROL_PREFIX="maplibregl-ctrl-",yt.constants.classes.CONTROL_GROUP="maplibregl-ctrl-group";var a=cr(cr({},yt.modes),{},{disabled:mt,edit_vertex:Dn,draw_vertex:Jn}),s=new yt({modes:a,styles:ir(t),displayControlsDefault:!1,userProperties:!0,defaultMode:"disabled"});i.addControl(s),n.draw=s;var c=function(e){i.once("idle",function(){!function(e,t){ir(t).forEach(function(t){Object.entries(t.paint).forEach(function(n){var r=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,s=[],c=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Hn(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Hn(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(n,2),o=r[0],i=r[1];e.getLayer("".concat(t.id,".cold"))&&e.setPaintProperty("".concat(t.id,".cold"),o,i),e.getLayer("".concat(t.id,".hot"))&&e.setPaintProperty("".concat(t.id,".hot"),o,i)})})}(i,e.mapColorScheme)})};return o.on(r.MAP_SET_STYLE,c),o.on(r.MAP_SET_SIZE,function(e){i.fire("draw.scalechange",{scale:{small:1,medium:1.5,large:2}[e]})}),{draw:s,remove:function(){o.off(r.MAP_SET_STYLE,c),s.deleteAll(),s.changeMode("disabled"),i.removeControl(s)}}};function dr(e){return dr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dr(e)}function pr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function hr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pr(Object(n),!0).forEach(function(t){fr(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pr(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function fr(e,t,n){return(t=function(e){var t=function(e){if("object"!=dr(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=dr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==dr(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var gr=function(e){return{mobile:{slot:"actions",showLabel:e},tablet:{slot:"actions",showLabel:e},desktop:{slot:"actions",showLabel:e}}},yr={reducer:{initialState:{mode:null,feature:null,tempFeature:null,selectedVertexIndex:-1,numVertecies:null,snap:!1},actions:l},InitComponent:function(e){var t=e.appState,n=e.appConfig,r=e.mapState,o=e.pluginConfig,i=e.pluginState,a=e.services,s=e.mapProvider,c=e.buttonConfig,u=a.events,l=a.eventBus;(0,d.useEffect)(function(){var e,n,i,a,c=null===(e=null===(n=o.includeModes)||void 0===n?void 0:n.includes(t.mode))||void 0===e||e,d=null!==(i=null===(a=o.excludeModes)||void 0===a?void 0:a.includes(t.mode))&&void 0!==i&&i;if(r.isMapReady&&c&&!d){var p=lr({colorScheme:r.mapStyle.mapColorScheme,mapProvider:s,events:u,eventBus:l}).remove;return l.emit("draw:ready"),function(){return p()}}},[r.isMapReady,t.mode]),(0,d.useEffect)(function(){if(s.draw){var e=function(e){var t=e.appState,n=e.appConfig,r=e.mapState,o=e.pluginState,i=e.mapProvider,a=e.buttonConfig,s=e.eventBus,c=a.drawDone,u=a.drawAddPoint,l=a.drawUndo,d=a.drawFinish,p=a.drawDeletePoint,h=a.drawSnap,f=a.drawCancel,g=i.map,y=i.draw,m=o.dispatch,v=o.feature,E=o.tempFeature;c.onClick=function(){y.changeMode("disabled"),m({type:"SET_MODE",payload:null}),m({type:"SET_FEATURE",payload:{feature:null,tempFeature:null}}),s.emit("draw:done",{newFeature:E})},f.onClick=function(){y.delete(E.id),v&&y.add(v),y.changeMode("disabled"),m({type:"SET_MODE",payload:null}),m({type:"SET_FEATURE",payload:{feature:null,tempFeature:null}}),s.emit("draw:cancel",{originalFeature:v})},h.onClick=function(){m({type:"TOGGLE_SNAP"})};var b=function(){var e,t=g.getStyle().layers||[];0===t.length||null!==(e=t[t.length-1].source)&&void 0!==e&&e.startsWith("mapbox-gl-draw")||t.filter(function(e){var t;return null===(t=e.source)||void 0===t?void 0:t.startsWith("mapbox-gl-draw")}).forEach(function(e){return g.moveLayer(e.id)})};g.on("styledata",function(){return b()});var S=function(e){var o=e.features[0];m({type:"SET_FEATURE",payload:{tempFeature:o}}),s.emit("draw:create",e),m({type:"SET_MODE",payload:"edit_vertex"}),setTimeout(function(){y.changeMode("edit_vertex",{container:t.layoutRefs.viewportRef.current,deleteVertexButtonId:"".concat(n.id,"-draw-delete-point"),isPanEnabled:"keyboard"!==t.interfaceType,interfaceType:t.interfaceType,scale:{small:1,medium:1.5,large:2}[r.mapSize],featureId:o.id})},0)};g.on("draw.create",S);var x=function(e){m({type:"SET_SELECTED_VERTEX_INDEX",payload:e}),s.emit("draw:vertexselection",e)};return g.on("draw.vertexselection",x),function(){c.onClick=null,u.onClick=null,l.onClick=null,d.onClick=null,p.onClick=null,h.onClick=null,f.onClick=null,g.off("styledata",b),g.off("draw.create",S),g.off("draw.vertexselection",x)}}({appState:t,appConfig:n,mapState:r,mapProvider:s,buttonConfig:c,pluginState:i,events:u,eventBus:l});return function(){return e()}}},[s,t,i])},buttons:[hr({id:"drawDone",label:"Done",variant:"primary",hiddenWhen:function(e){var t=e.appState,n=e.pluginState;return!n.mode||"mouse"!==t.interfaceType&&"edit_vertex"!==n.mode},enableWhen:function(e){return!!e.pluginState.tempFeature}},gr(!0)),hr({id:"drawAddPoint",label:"Add point",variant:"primary",hiddenWhen:function(e){var t=e.appState;return"draw_vertex"!==e.pluginState.mode||"mouse"===t.interfaceType}},gr(!0)),hr({id:"drawUndo",label:"Undo",iconId:"undo",variant:"tertiary",hiddenWhen:function(e){return!e.pluginState.mode},enableWhen:function(e){return e.pluginState,!1}},gr(!1)),hr({id:"drawFinish",label:"Close shape",iconId:"check",variant:"tertiary",hiddenWhen:function(e){return"draw_vertex"!==e.pluginState.mode},enableWhen:function(e){return e.pluginState.numVertecies>3}},gr(!1)),hr({id:"drawDeletePoint",label:"Delete point",iconId:"close",variant:"tertiary",enableWhen:function(e){var t=e.pluginState;return t.selectedVertexIndex>=0&&t.numVertecies>3},hiddenWhen:function(e){var t=e.pluginState;return!["simple_select","edit_vertex"].includes(t.mode)}},gr(!1)),hr({id:"drawSnap",label:"Snap to point",iconId:"magnet",variant:"tertiary",hiddenWhen:function(e){return!e.pluginState.mode},pressedWhen:function(e){return!!e.pluginState.snap}},gr(!1)),hr({id:"drawCancel",label:"Cancel",variant:"tertiary",hiddenWhen:function(e){return!e.pluginState.mode}},gr(!0))],keyboardShortcuts:[{id:"drawStart",group:"Drawing",title:"Edit vertex",command:"<kbd>Spacebar</kbd></dd>"}],icons:[{id:"check",svgContent:'<path d="M20 6 9 17l-5-5"/>'},{id:"undo",svgContent:'<path d="M3 7v6h6"/><path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"/>'},{id:"magnet",svgContent:'<path d="m12 15 4 4"/><path d="M2.352 10.648a1.205 1.205 0 0 0 0 1.704l2.296 2.296a1.205 1.205 0 0 0 1.704 0l6.029-6.029a1 1 0 1 1 3 3l-6.029 6.029a1.205 1.205 0 0 0 0 1.704l2.296 2.296a1.205 1.205 0 0 0 1.704 0l6.365-6.367A1 1 0 0 0 8.716 4.282z"/><path d="m5 8 4 4"/>'}],api:{newPolygon:function(e,t){var n=e.appState,r=e.appConfig,o=e.pluginState,i=e.mapProvider,a=o.dispatch,s=i.draw;s&&(s.changeMode("draw_vertex",{container:n.layoutRefs.viewportRef.current,vertexMarkerId:"".concat(r.id,"-cross-hair"),addVertexButtonId:"".concat(r.id,"-draw-add-point"),interfaceType:n.interfaceType,featureId:t}),a({type:"SET_MODE",payload:"draw_vertex"}))},editFeature:function(e,t){var n=e.appState,r=e.appConfig,o=e.mapState,i=e.pluginState,a=e.mapProvider,s=i.dispatch,c=a.draw;if(c){c.changeMode("edit_vertex",{container:n.layoutRefs.viewportRef.current,deleteVertexButtonId:"".concat(r.id,"-draw-delete-point"),isPanEnabled:"keyboard"!==n.interfaceType,interfaceType:n.interfaceType,scale:{small:1,medium:1.5,large:2}[o.mapSize],featureId:t});var u=c.get(t);s({type:"SET_FEATURE",payload:{feature:u,tempFeature:u}}),s({type:"SET_MODE",payload:"edit_vertex"})}},addFeature:function(e,t){var n=e.mapProvider,r=e.services,o=n.draw,i=r.eventBus;o&&(o.add(t),o.changeMode("disabled"),i.emit("draw:add",t))},deleteFeature:function(e,t){var n=e.mapProvider,r=e.services,o=n.draw,i=r.eventBus;o&&(o.delete(t),i.emit("draw:delete",{featureId:t}))}}}}};